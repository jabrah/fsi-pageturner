/*!
 * FSI Viewer JS
 * Copyright (c) 2000-2016 NeptuneLabs GmbH - All rights reserved.
 *
 * info@neptunelabs.com
 * www.neptunelabs.com
 *
 * VERSION: 1.1.3
 *
 * IMPORTANT NOTE
 * ------------------------------------------------------
 * Usage limited to the terms of the NeptuneLabs Software
 * END-USER LICENSE AGREEMENT.
 * ------------------------------------------------------
 *
 */

"use strict";
(function($FSI,undefined){if($FSI.defined!=undefined){return}$FSI.defined=true;if(typeof(console.error)!="function"){$FSI.console={};$FSI.console.log=$FSI.fnDoNothing;$FSI.console.warn=$FSI.fnDoNothing;$FSI.console.error=$FSI.fnDoNothing;$FSI.console.dir=$FSI.fnDoNothing}else{$FSI.console=console}$FSI.oSupportedViewers={};try{if(typeof(top.window.alert)=="function"){$FSI.topWindow=top.window}else{$FSI.topWindow=window}}catch(e){$FSI.console.warn("FSI: top.window is not accessible. This is likely due to cross domain security restrictions. Viewer functionality might be limited.");$FSI.topWindow=window}$FSI.oInstanceCreated={};$FSI.ClassDef=function(instance,strClassName,version,build){var self=this;this.instance=instance;this.strClassName=strClassName;this.version=version;this.build=build;var strVersionString=strClassName+" "+version+" build "+build;var getVersion=function(){return strVersionString};var getBuild=function(){return build};instance.getVersion=getVersion;instance.getBuild=getBuild;if(!$FSI.oInstanceCreated[strClassName]){$FSI.oInstanceCreated[strClassName]=true;if(instance.getBuild()!=$FSI.getBuild()){$FSI.console.error("FSI version mismatch: "+getVersion()+" and "+$FSI.getVersion())}}};var classDef=new $FSI.ClassDef($FSI,"FSI Core","2016","16.06.9");$FSI.SVGNameSpaceURL="http://www.w3.org/2000/svg";$FSI.regexPlusToSpace=/\+/g;$FSI.regExServerRenderer=/([?&])(renderer|profile)=([^&]*)/i;$FSI.nViewerInstanceID=0;$FSI.bHTTPS=(document.location.protocol=="https:");$FSI.getViewerInstanceID=function(){return ++$FSI.nViewerInstanceID};$FSI.BoolTable={"0":false,"false":false,"1":true,"true":true};$FSI.makeBool=function(value,def){var ret;var t=typeof(value);if(t=="boolean"){ret=value}else{if(t=="string"){value=value.toLowerCase()}ret=$FSI.BoolTable[value];if(ret==undefined){ret=def}}return ret};$FSI.changeRendererInURL=function(url,strRenderer){url=url.replace($FSI.regExServerRenderer,"$1renderer="+strRenderer);return url};$FSI.loadSkinCSS=function(skinName,scope,fnReady){if(typeof($FSI.iLoaderCSSSkin)!="object"){if(typeof($FSI.LoaderCSSSkin)!="function"){$FSI.console.error("Class $FSI.LoaderCSSSkin missing.");fnReady.call(scope,false);return}$FSI.iLoaderCSSSkin=new $FSI.LoaderCSSSkin()}return $FSI.iLoaderCSSSkin.load(skinName,scope,fnReady)};$FSI.addedCSSBlocks={};$FSI.cssClassExists=function(cssID){return(typeof($FSI.addedCSSBlocks[cssID])!="undefined")};$FSI.addCSSClass=function(cssID,strCode){if($FSI.cssClassExists(cssID)){return false}var node=$FSI.addCSSNode(cssID);if(node){try{node.innerHTML=strCode;$FSI.addedCSSBlocks[cssID]=node}catch(e){$FSI.console.error("FSI: addCSSClass failed")}}};$FSI.addCSSNode=function(cssID){var node=null;try{node=document.createElement("style");node.setAttribute("x-generated-by","FSI");node.setAttribute("x-generated-for",cssID);node.appendChild(document.createTextNode(""));if(document.head.firstChild){document.head.insertBefore(node,document.head.firstChild)}else{document.head.appendChild(node)}}catch(e){$FSI.console.error("FSI: FAILED to create <style> node for "+cssID);$FSI.console.error(e.message)}return node};$FSI.addCSSRule=function(selector,rules,index){if($FSI.oInsertedCSS==undefined){$FSI.oInsertedCSS=$FSI.addCSSNode("FSI.Core")}if($FSI.oInsertedCSS!=undefined){try{if($FSI.oInsertedCSS&&$FSI.oInsertedCSS.sheet){if("insertRule" in $FSI.oInsertedCSS.sheet){$FSI.oInsertedCSS.sheet.insertRule(selector+"{"+rules+"}",index)}else{if("addRule" in $FSI.oInsertedCSS.sheet){$FSI.oInsertedCSS.sheet.addRule(selector,rules,index)}}}}catch(e){$FSI.console.error("FSI: FAILED to add css rule for "+selector);$FSI.console.error(e.message)}}};$FSI.setStyleAttr=function(el,strStyle){
/*@cc_on
		@if (@_jscript_version < 9)
			el.style.setAttribute('cssText', strStyle);
		@else @*/
el.setAttribute("style",strStyle);
/*@end
		@*/
};$FSI.documentDomain=document.location.hostname;$FSI.regCors=new RegExp("//"+$FSI.documentDomain+"[:/]");$FSI.isCrossDomain=function(url){if(!url||url.indexOf("http")!=0){return false}return url.match($FSI.regCors)==null};$FSI.loadImageCors=function(img,url){if($FSI.isCrossDomain(url)){img.crossOrigin="";img.src=url}else{img.src=url}};$FSI.getSVGID=function(){return"$FSI.SVGID_"+$FSI.SVGID++};$FSI.BrowserSupports={};$FSI.BrowserSupports[false]=function(){return false};$FSI.BrowserSupports[true]=function(){return true};$FSI.osVersion=[0,0,0];$FSI.SVGID=0;$FSI.initialWindowWith=window.innerWidth;$FSI.bElementPosRespectsScroll=true;var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame||!window.cancelAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};window.cancelAnimationFrame=function(id){clearTimeout(id)}}var uagent=$FSI.userAgent=navigator.userAgent.toLowerCase();var result;if(uagent.search(/iphone|ipad|ipod|android|symbian|mobile|phone|windows ce|opera mini|opera mobi/i)>-1){result=true;if(uagent.search("android")>-1){$FSI.mobileOS="android";$FSI.isTouch=true;$FSI.noMouse=true;var t=uagent.match(/android (\S*)/);if(t&&t.length>1){t=t[1].split(".");for(var i=0;i<t.length;i++){t[i]=parseInt(t[i])}$FSI.osVersion=[].concat(t)}}else{if(uagent.indexOf("mac os")!=-1){$FSI.mobileOS="ios";$FSI.isTouch=true;$FSI.noMouse=true;var t=uagent.match(/ os (\S*)/);if(t&&t.length>1){t=t[1].split("_");for(var i=0;i<t.length;i++){t[i]=parseInt(t[i])}$FSI.osVersion=[].concat(t)}}}}else{result=false}$FSI.isMobileDevice=result;$FSI.isSmallMobileDevice=(uagent.search(/iphone|ipod|phone|mobile safari|iemobile|opera mini|opera mobi/i)>-1);$FSI.isInternetExplorer=false;if(uagent.search("msie")>-1){$FSI.isInternetExplorer=true;var t=uagent.match(/msie ([^;]*)/);if(t&&t.length>1){$FSI.versionInternetExplorer=parseFloat(t[1])}}else{if(navigator.userAgent.match(/Trident.*rv:(\d+\.)/gi)){$FSI.isInternetExplorer=true;$FSI.versionInternetExplorer=parseFloat(RegExp.$1)}else{$FSI.isInternetExplorer=(typeof(window.onmsgestureend)!="undefined");$FSI.versionInternetExplorer=12}}if(window.navigator.msPointerEnabled){$FSI.isIETouch=(window.navigator.msMaxTouchPoints>1)}if($FSI.isIETouch){$FSI.bElementPosRespectsScroll=false}if(!$FSI.isTouch){$FSI.isTouch=(window.navigator.maxTouchPoints>1||window.navigator.msMaxTouchPoints>1)}if(uagent.search("safari")>-1&&uagent.search("chrome")<1){$FSI.isSafari=true}else{if(uagent.search("firefox")>-1){$FSI.isFirefox=true}else{if(uagent.search("opera")>-1){$FSI.isOpera=true}}}if(uagent.search("mac os")>-1){$FSI.isMac=true}if(typeof(window.pageYOffset)=="number"){$FSI.getDocumentScroll=function(wnd){return{x:wnd.pageXOffset,y:wnd.pageYOffset}}}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){$FSI.getDocumentScroll=function(wnd){return{x:wnd.document.body.scrollLeft,y:wnd.document.body.scrollTop}}}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){$FSI.getDocumentScroll=function(wnd){return{x:wnd.document.documentElement.scrollLeft,y:wnd.document.documentElement.scrollTop}}}}}$FSI.getDocumentScaleNone=function(){return 1};$FSI.getCachedScrollBarWidth=function(el,oReg,w){var cst;var cssOverflowY="";try{cst=top.window.getComputedStyle(el);cssOverflowY=cst["overflow-y"]}catch(e){return 0}if(cssOverflowY=="scroll"||el.scrollHeight>top.window.innerHeight){var orgStyle=el.style.overflowY;var styleID=orgStyle;styleID="S_"+styleID;if(1==1||oReg[styleID]==undefined){el.style.overflowY="hidden";var w2=$FSI.___elementScaleCheck.offsetWidth;if(w2-w>1){oReg[styleID]=w2-w}}}if(!isNaN(oReg[styleID])){ret=oReg[styleID]}else{ret=-1}return ret};$FSI.__getMediaMinScreenWidthCount=0;$FSI.__getMediaMinScreenWidthLoopCount=0;$FSI.oMatchMedia=$FSI.topWindow.matchMedia||$FSI.topWindow.msMatchMedia;$FSI.getMediaMinScreenWidth=function(step){var init=$FSI.topWindow.document.documentElement.clientWidth;if($FSI.__LastGetMediaMinScreenWidth==$FSI.topWindow.document.documentElement.clientWidth){return $FSI.__LastGetMediaMinScreenWidthResult}$FSI.__LastGetMediaMinScreenWidth=$FSI.topWindow.document.documentElement.clientWidth;$FSI.__getMediaMinScreenWidthCount++;var step=10;while($FSI.oMatchMedia.call(window,"(min-width:"+(init+=step)+"px)")["matches"]){$FSI.__getMediaMinScreenWidthLoopCount++}init-=step;step=5;while($FSI.oMatchMedia.call(window,"(min-width:"+(init+=step)+"px)")["matches"]){$FSI.__getMediaMinScreenWidthLoopCount++}init-=step;step=1;while($FSI.oMatchMedia.call(window,"(min-width:"+(init+=step)+"px)")["matches"]){$FSI.__getMediaMinScreenWidthLoopCount++}$FSI.__LastGetMediaMinScreenWidthResult=$FSI.__getDocumentScaleReferenceWidth=init-step;return $FSI.__LastGetMediaMinScreenWidthResult};$FSI.getDocumentScaleInit=function(){$FSI.getDocumentScale=$FSI.getDocumentScaleNone;if(typeof(document.visualViewport)!="undefined"){$FSI.documentScaleMethod="visualViewport API";$FSI.getDocumentScale=function(){return document.visualViewport.pageScale};return $FSI.getDocumentScale()}if($FSI.topWindow.innerWidth==undefined){$FSI.documentScaleMethod="none";return $FSI.getDocumentScale()}if(window.orientation!=undefined){if(!window.outerWidth){$FSI.documentScaleMethod="screen.width / window.innerWidth";$FSI.getDocumentScale=function(){$FSI.__getDocumentScaleReferenceWidth=(window.orientation%180==0)?screen.width:screen.height;return $FSI.__getDocumentScaleReferenceWidth/window.innerWidth};return $FSI.getDocumentScale()}$FSI.documentScaleMethod="window.outerWidth / window.innerWidth";$FSI.getDocumentScale=function(){$FSI.__getDocumentScaleReferenceWidth=window.outerWidth;return window.outerWidth/window.innerWidth};return $FSI.getDocumentScale()}if($FSI.oMatchMedia&&$FSI.topWindow.document.documentElement.clientWidth>0){var w=$FSI.getMediaMinScreenWidth("min-width","px");if(!isNaN(w)){$FSI.documentScaleMethod="CSS Media Query";$FSI.getDocumentScale=function(){var res=$FSI.getMediaMinScreenWidth("min-width","px")/$FSI.topWindow.innerWidth;if(isNaN(res)){res=1}return res};return $FSI.getDocumentScale()}}$FSI.getDocumentScale=function(){return $FSI.topWindow.outerWidth/$FSI.topWindow.innerWidth};return $FSI.getDocumentScale()};$FSI.getDocumentScale=$FSI.getDocumentScaleInit;if(typeof(window.devicePixelRatio)!="undefined"){$FSI.getDevicePixelRatio=function(){return window.devicePixelRatio||1}}else{$FSI.getDevicePixelRatio=function(){return 1}}$FSI.getDocumentScaleWithPixelRatio=function(){return $FSI.getDocumentScale()*$FSI.getDevicePixelRatio()};$FSI.fnDoNothing=function(){};$FSI.preventDefaultEvent=function(evt){if(evt.preventDefault){evt.preventDefault()}evt.returnValue=false;return false};$FSI.getElementDimension=function(elem){return{width:elem.offsetWidth,height:elem.offsetHeight}};$FSI.getElementInnerDimension=function(elem){var ret={width:elem.clientWidth,height:elem.clientHeight};var padding=$FSI.getElementPaddings(elem);ret.width-=padding.left+padding.right;ret.height-=padding.top+padding.bottom;return ret};$FSI.getViewportSize=function(wnd){var ret;if($FSI.BrowserSupports.visualViewportAPI()){ret={width:wnd.document.visualViewport.clientWidth,height:wnd.document.visualViewport.clientHeight}}else{ret={width:wnd.innerWidth,height:wnd.innerHeight}}return ret};$FSI.mergeObjects=function(o1,o2){for(var o in o2){o1[o]=o2[o]}return o1};$FSI.cloneArray=function(ar){if(ar==undefined||ar.length==undefined){return[]}return ar.concat([])};$FSI.cloneArrayRecursive=function(ar){if(ar==undefined||ar.length==undefined){return[]}var ret=ar.concat([]);for(var i=0;i<ar.length;i++){ar[i]=$FSI.cloneValue(ar[i])}return ret};$FSI.cloneValue=function(val){var ret;switch(typeof(val)){case"object":if(val!=null&&typeof(val.push)=="function"){ret=$FSI.cloneArrayRecursive(val)}else{ret=$FSI.cloneObject(val)}break;default:ret=val}return ret};$FSI.cloneObject=function(obj){var ret={};if(typeof(obj=="object")&&typeof(obj.push)=="function"){ret=$FSI.cloneArrayRecursive(obj)}else{for(var o in obj){ret[o]=$FSI.cloneValue(obj[o])}}return ret};$FSI.cloneParameters=function(parameters){return $FSI.cloneObject(parameters)};$FSI.removeChild=function(parent,child){try{parent.removeChild(child)}catch(e){$FSI.console.error(e.message);$FSI.console.log(parent);$FSI.console.log(child)}};$FSI.oCustomEventListenerClasses={};$FSI.oCustomEventListenerInstances={};$FSI.oCustomEventListeners={};$FSI.nCustomEventListeners=0;$FSI.nCustomEventListenerID=0;$FSI.addCustomEvent=function(myObj,myEvent,myFunc,bCapturingPhase){var obj,listenerID;var listener=$FSI.oCustomEventListenerInstances[myEvent];if(!listener){if(typeof($FSI.oCustomEventListenerClasses[myEvent])=="undefined"){$FSI.console.error("$FSI.oCustomEventListenerClass for '"+myEvent+"' is undefined.");return false}listener=$FSI.oCustomEventListenerInstances[myEvent]=new $FSI.oCustomEventListenerClasses[myEvent](myObj,myFunc)}obj=listener.addListener(myObj,myFunc);if(obj!=undefined){listenerID=obj.nCustomEventListenerID=$FSI.nCustomEventListenerID++;$FSI.oCustomEventListeners[obj.nCustomEventListenerID]=obj;$FSI.nCustomEventListeners++}else{$FSI.console.error("Failed to add custom event listener: "+myEvent)}return listenerID};$FSI.removeCustomEvent=function(myObj,myEvent,myFunc,bCapturingPhase){var listener=$FSI.oCustomEventListenerInstances[myEvent];if(!listener){return false}var obj=listener.removeListener(myObj,myFunc);if(obj&&$FSI.oCustomEventListeners[obj.nCustomEventListenerID]!=undefined){delete $FSI.oCustomEventListeners[obj.nCustomEventListenerID];$FSI.nCustomEventListeners--}else{$FSI.console.error("Failed to remove custom event listener")}};$FSI.setCustomEventListenerProperty=function(listenerID,nam,val){var obj=$FSI.oCustomEventListeners[listenerID];if(!obj||!obj.instanceListener){return}obj.instanceListener.setListenerProps.call(obj.instanceListener,obj.uniqueID,nam,val)};$FSI.enableCustomEventListener=function(listenerID,bEnable){var obj=$FSI.oCustomEventListeners[listenerID];if(!obj||!obj.instanceListener){return}obj.instanceListener.enableListener.call(obj.instanceListener,obj.uniqueID,bEnable)};$FSI.pauseCustomEventListener=function(listenerID,bPause){var obj=$FSI.oCustomEventListeners[listenerID];if(!obj||!obj.instanceListener){return}obj.instanceListener.pauseListener.call(obj.instanceListener,obj.uniqueID,bPause)};$FSI.triggerCustomEvent=function(listenerID){var obj=$FSI.oCustomEventListeners[listenerID];if(!obj||!obj.instanceListener){return}obj.instanceListener.triggerEvent.call(obj.instanceListener,obj.uniqueID)};$FSI.removeEvent=function(myObj,myEvent,myFunc,bCapturingPhase){if(window.removeEventListener&&myObj){if(bCapturingPhase==undefined){bCapturingPhase=true}myObj.removeEventListener(myEvent,myFunc,bCapturingPhase)}else{if(window.detachEvent&&myObj){myObj.detachEvent("on"+myEvent,myFunc)}}};$FSI.addEvent=function(myObj,myEvent,myFunc,bCapturingPhase){if(window.addEventListener&&myObj){if(bCapturingPhase==undefined){bCapturingPhase=true}myObj.addEventListener(myEvent,myFunc,bCapturingPhase)}else{if(window.attachEvent&&myObj){myObj.attachEvent("on"+myEvent,myFunc)}}};$FSI.getScriptTagByFileName=function(strScriptName){var tag;if(typeof(document.querySelector)=="function"){var strSelector="script[src$='"+strScriptName+"']";tag=document.querySelector(strSelector)}else{var tmp=$FSI.escapeRegEx(strScriptName);var regEx=new RegExp("(^|/)"+tmp+"s*$");var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){var src=scripts[i].src;if(src.match(regEx)){tag=scripts[i];break}}}return tag};$FSI.getScriptPath=function(strScriptName,depth){var src;depth++;var ret="";var scripts=document.getElementsByTagName("script");var t="/"+strScriptName;var tag=$FSI.getScriptTagByFileName(strScriptName);if(tag){src=tag.src.split("/");src.splice(src.length-depth,depth);ret=src.join("/")}return ret};$FSI.guessFSIViewerLocation=function(strScriptName,depth){if($FSI._FSIViewerLocation!=undefined){return $FSI._FSIViewerLocation}var ret=$FSI.getScriptPath(strScriptName,depth);if(ret){$FSI._FSIViewerLocation=ret}return ret};$FSI.createJavascriptLoader=function(){if(typeof($FSI.iLoaderJavascript)!="object"){if(typeof($FSI.LoaderJavascript)!="function"){$FSI.console.error("Class $FSI.LoaderJavascript missing.");return false}$FSI.iLoaderJavascript=new $FSI.LoaderJavascript()}return true};$FSI.loadJavascript=function(strScriptPath,idInstance,argScope,fnOnLoad,oPassThroigh){if(!$FSI.createJavascriptLoader()){return false}return $FSI.iLoaderJavascript.load(strScriptPath,idInstance,argScope,fnOnLoad,oPassThroigh)};$FSI.releaseLoadJavascript=function(strScriptPath,idInstance){if(!$FSI.createJavascriptLoader()){return false}return $FSI.iLoaderJavascript.release(strScriptPath,idInstance)};$FSI.customTags={};$FSI.bCustomTagsAdded=false;$FSI.customTagDimFromAttributes=function(el){var rpl=function(nam){var tmp=el.getAttribute(nam);if(typeof(tmp)=="string"&&tmp.length>0){if(!tmp.match(/[^0-9\s]/)){tmp+="px"}el.style[nam]=tmp}};rpl("width");rpl("height")};$FSI.setParameters=function(node,parameters){if(!node||typeof(node.tagName)!="string"){return false}var t=typeof(parameters);if(t!="object"&&t!="function"){return false}node._fsi_parameters=parameters};$FSI.getParameters=function(node){if(!node||typeof(node.tagName)!="string"){return false}return node._fsi_parameters};$FSI.initCustomNode=function(node){if($FSI.BrowserSupports.registerElement()){return true}if(!node||typeof(node.tagName)!="string"){return false}var strTagName=node.tagName.toLowerCase();var oCustomTag=$FSI.customTags[strTagName];if(!oCustomTag||typeof(oCustomTag.replaceTag)!="function"){return false}if(oCustomTag.replaceTagInit){oCustomTag.replaceTagInit();delete oCustomTag.replaceTagInit}oCustomTag.replaceTag(node);return true};$FSI.initCustomTags=function(){if($FSI.BrowserSupports.registerElement()){return}for(var o in $FSI.customTags){$FSI.initCustomTag(o)}};$FSI.initCustomTag=function(strTagName){if($FSI.BrowserSupports.registerElement()){return}var oCustomTag=$FSI.customTags[strTagName];if(!oCustomTag||typeof(oCustomTag.replaceTag)!="function"){return false}var ar=document.getElementsByTagName(strTagName);if(ar&&ar.length>0){if(oCustomTag.replaceTagInit){oCustomTag.replaceTagInit();delete oCustomTag.replaceTagInit}for(var i=0;i<ar.length;i++){oCustomTag.replaceTag(ar[i])}}};$FSI.registerCustomTag=function(strTagName,oFunctions){var oCustomTag=$FSI.customTags[strTagName];if(oCustomTag){return false}oCustomTag=$FSI.customTags[strTagName]={};if($FSI.BrowserSupports.registerElement()){oCustomTag.bRegistered=true;oFunctions.registerElement()}else{oCustomTag.bRegistered=false;oCustomTag.replaceTag=oFunctions.replaceTag;if(typeof(oFunctions.replaceTagInit)=="function"){oCustomTag.replaceTagInit=oFunctions.replaceTagInit}if(!$FSI.bCustomTagsAdded){$FSI.bCustomTagsAdded=true;$FSI.addEvent(window,"DOMContentLoaded",$FSI.initCustomTags)}}return true};$FSI.attributes2parameters=function(node){var ret={};if(!node||typeof(node.attributes)!="object"){return ret}var attr;var attrs=node.attributes;for(var i=0;i<attrs.length;i++){attr=attrs[i];ret[attr.name]=attr.value}return ret};$FSI.oViewerClassCSSRules={};$FSI.addViewerClassCSSRule=function(strClass,strRule){if(typeof(strClass)!="string"||strClass.length<1){return}if(typeof(strRule)!="string"||strRule.length<1){return}var res=$FSI.oViewerClassCSSRules[strClass];if(res==strRule){return}$FSI.addCSSRule(strClass,strRule,0);$FSI.oViewerClassCSSRules[strClass]=strRule};$FSI.getWindowOffset=function(el){var ofsX=0;var ofsY=0;try{if(el.frameElement){var w=el;while(w.frameElement){var node=w.frameElement;var nodePos=$FSI.getElementPosition(node);ofsX+=nodePos.left;ofsY+=nodePos.top;w=w.parent}}}catch(e){}return{x:ofsX,y:ofsY}};$FSI.getElementPaddings=function(element){var ret={left:0,top:0,right:0,bottom:0};try{var style=window.getComputedStyle(element,null);ret.left=parseFloat(style.paddingLeft);ret.top=parseFloat(style.paddingTop);ret.right=parseFloat(style.paddingRight);ret.bottom=parseFloat(style.paddingBottom)}catch(e){}return ret};$FSI.getElementMargins=function(element){var ret={left:0,top:0,right:0,bottom:0};try{var style=window.getComputedStyle(element,null);ret.left=parseFloat(style.marginLeft);ret.top=parseFloat(style.marginTop);ret.right=parseFloat(style.marginRight);ret.bottom=parseFloat(style.marginBottom)}catch(e){}return ret};$FSI.getBoundingClientRect=function(el){var ret;try{ret=el.getBoundingClientRect()}catch(e){ret={top:0,left:0,right:0,bottom:0,width:0,height:0}}return ret};$FSI.getElementClientDim=function(element){var rc=$FSI.getBoundingClientRect(element);return{width:(rc.right-rc.left),height:(rc.bottom-rc.top)}};$FSI.getElementClientPos=function(element){return $FSI.getBoundingClientRect(element)};$FSI.getElementPosition=function(element){var node=element;var rc=$FSI.getBoundingClientRect(element);var bl=element.clientLeft;var bt=element.clientTop;var br=0;var bb=0;var pl=0;var pr=0;var pt=0;var pb=0;try{var style=window.getComputedStyle(element,null);pl=parseFloat(style.paddingLeft);pr=parseFloat(style.paddingRight);pt=parseFloat(style.paddingTop);pb=parseFloat(style.paddingBottom);bl=parseFloat(style.borderLeftWidth);br=parseFloat(style.borderRightWidth);bt=parseFloat(style.borderTopWidth);bb=parseFloat(style.borderBottomWidth)}catch(e){}var x1=rc.left+bl+pl;var y1=rc.top+bt+pt;var x2=rc.right-br-pr;var y2=rc.bottom-bb-pb;return{left:x1,top:y1,right:x2,bottom:y2}};$FSI.trim=function(s){if(!s||typeof(s)!="string"||s.length<1){return s}return s.replace(/(^\s+)|(\s+$)/g,"")};$FSI.escapeRegEx=function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};$FSI.addClass=function(el,strClass){if(!el||typeof(el.className)!="string"){return}if(typeof(strClass)!="string"){return}strClass=$FSI.trim(strClass);if(strClass.length<1){return}var needle=$FSI.escapeRegEx(strClass);var regex=new RegExp("(^|\\s+)"+needle+"(\\s+|$)");var strCurrent=$FSI.trim(el.className);var bFound=strCurrent.match(regex);if(!bFound){if(strCurrent.length>0){strCurrent+=" "+strClass}else{strCurrent+=strClass}el.className=strCurrent}};$FSI.removeClass=function(el,strClass){if(!el||typeof(el.className)!="string"){return}if(typeof(strClass)!="string"){return}strClass=$FSI.trim(strClass);if(strClass.length<1){return}var needle=$FSI.escapeRegEx(strClass);var regex=new RegExp("(^|\\s+)"+needle+"(\\s+|$)","g");var str=$FSI.trim(el.className.replace(regex," "));if(str.length>0){el.className=str}else{el.removeAttribute("class")}};$FSI.urlDecode=function(str){if(!str){return str}var ret=str.replace($FSI.regexPlusToSpace," ");try{ret=decodeURIComponent(ret)}catch(e){$FSI.console.error("Malformed URI: "+ret)}return ret};$FSI.getCSSTransformStyleName=function(){if($FSI._CSSTransformStyleName!=undefined){return $FSI._CSSTransformStyleName}var ret="transform";var ar=["transform","webkitTransform","msTransform","MozTransform","OTransform"];var div=document.createElement("DIV");for(var i=0;i<ar.length;i++){div.style[ar[i]]="translate( 0 , 0)";if(div.style[ar[i]]!="translate( 0 , 0)"){ret=ar[i];break}}div=null;$FSI._CSSTransformStyleName=ret;return ret};$FSI.getFSIServerImageDim=function(wSource,hSource,wTarget,hTarget,range,keepAspectRatio){var sourceDim={width:wSource,height:hSource};var targetDim={width:wTarget,height:hTarget};$FSI.calcFSIServerImageDim(sourceDim,targetDim,range,keepAspectRatio);return targetDim};$FSI.calcFSIServerImageDim=function(sourceDimension,targetDimension,range,keepAspectRatio){if(typeof(range)!="object"){range={left:0,top:0,width:1,height:1}}else{range.left=range.left<0?0:range.left>1?1:range.left;range.top=range.top<0?0:range.top>1?1:range.top;range.width=range.width<0?1-range.left:range.width+range.left>1?1-range.left:range.width;range.height=range.height<0?1-range.top:range.height+range.top>1?1-range.top:range.height}targetDimension.width=targetDimension.width<=0||targetDimension.width===undefined?-1:targetDimension.width;targetDimension.height=targetDimension.height<=0||targetDimension.height===undefined?-1:targetDimension.height;var scale={};if(targetDimension.width!=-1&&targetDimension.height!=-1){scale.x=targetDimension.width/(sourceDimension.width*range.width);scale.y=targetDimension.height/(sourceDimension.height*range.height)}else{if(targetDimension.height==-1){scale.x=targetDimension.width/(sourceDimension.width*range.width);scale.y=scale.x}else{scale.y=targetDimension.height/(sourceDimension.height*range.height);scale.x=scale.y}}if(targetDimension.width==-1||targetDimension.height==-1){var scaleFactor=Math.min(scale.x,scale.y);if(targetDimension.width==-1){targetDimension.width=Math.round(sourceDimension.width*range.width*scaleFactor)}else{if(targetDimension.height==-1){targetDimension.height=Math.round(sourceDimension.height*range.height*scaleFactor)}}scale.x=scaleFactor;scale.y=scaleFactor}if(keepAspectRatio&&Math.abs(scale.x-scale.y)>1e-7){if(scale.x>scale.y){var preciseTargetWidth=targetDimension.height*sourceDimension.width*range.width/(sourceDimension.height*range.height);scale.x=preciseTargetWidth/sourceDimension.width;targetDimension.width=Math.round(preciseTargetWidth)}else{var preciseTargetHeight=targetDimension.width*sourceDimension.height*range.height/(sourceDimension.width*range.width);scale.y=preciseTargetHeight/sourceDimension.height;targetDimension.height=Math.round(preciseTargetHeight)}}targetDimension.width=targetDimension.width==0?1:targetDimension.width;targetDimension.height=targetDimension.height==0?1:targetDimension.height;return scale};if(typeof(window.JSON)=="undefined"){$FSI.JSON={};$FSI.JSON._emulated=true}else{$FSI.JSON=JSON}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof $FSI.JSON.stringify!=="function"){$FSI.JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof $FSI.JSON.parse!=="function"){$FSI.JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());$FSI.BrowserSupports.visualViewportAPI=function(){var res=false;try{if(typeof(document.visualViewport)!="undefined"){res=true}}catch(e){}$FSI.BrowserSupports.visualViewportAPI=$FSI.BrowserSupports[res];return res};$FSI.BrowserSupports.registerElement=function(){var res=false;try{if(typeof(document.registerElement)=="function"){res=true}}catch(e){}$FSI.BrowserSupports.registerElement=$FSI.BrowserSupports[res];return res};$FSI.BrowserSupports.canvas=function(){var res=false;try{var cv=document.createElement("canvas");var ctx=cv.getContext("2d");if(ctx&&ctx.clearRect!=undefined){res=true}}catch(e){}$FSI.BrowserSupports.canvas=$FSI.BrowserSupports[res];return res};$FSI.BrowserSupports.cssTouchAction=function(){var res=false;try{if($FSI.isTouch){if(typeof(window.getComputedStyle)=="function"){var stl=window.getComputedStyle(document.body);res=(typeof(stl.touchAction)=="string")}}}catch(e){}$FSI.BrowserSupports.cssTouchAction=$FSI.BrowserSupports[res];return res};var ret=($FSI.isMobileDevice||$FSI.isIETouch||$FSI.isTouch||($FSI.isMac&&$FSI.isSafari))?true:false;$FSI.BrowserSupports.documentZoom=$FSI.BrowserSupports[ret]}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.Debugger!=b){return}a.EmptyDebugger=function(){this.log=this.error=this.dir=this.setPrefix=function(){};this.on=false};a.Debugger=function(){var c="FSI";this.on=true;this.doNothing=function(){};this.log=this.doNothing;this.error=this.doNothing;this.dir=this.doNothing;try{if(console&&console.log){this.log=function(e){console.log(c+e)}}if(console&&console.error){this.error=function(e){console.error(c+e)}}if(console&&console.dir){this.dir=function(e){console.dir(e)}}}catch(d){}this.setPrefix=function(e){c=e+"> "}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CORSLoader!=b){return}a.CORSLoader=function(){var h=this;var d=0;var c={};var g=false;var i;var f=null;if(a.isInternetExplorer&&a.versionInternetExplorer<10){i=function(k){var e;if(!a.isCrossDomain(k)){g=false;e=new XMLHttpRequest()}else{g=true;e=new XDomainRequest()}return e}}else{if(typeof XMLHttpRequest!="undefined"){i=function(){return new XMLHttpRequest()}}}if(!i){try{f=new ActiveXObject("Msxml2.XMLHTTP");i=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(j){try{f=new ActiveXObject("Microsoft.XMLHTTP");i=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(j){f=null;i=function(){return null}}}}this.getSupported=function(){return(i()!=null)};this.load=function(m,n,p,r){var l=i(m);if(!l){return}if(p&&l.overrideMimeType){l.overrideMimeType(p)}l._url=m;var o=d;c[d]=l;d++;var k=-1;if(g){l.onerror=function(){delete c[o];if(n==b||this.FSIaborted){return}n(this,this.responseText,r,400)};l.onload=function(){delete c[o];if(n==b||this.FSIaborted){return}var s=this.responseText;switch(this.contentType){case"application/xml":case"text/xml":try{var t=new ActiveXObject("Microsoft.XMLDOM");t.async=false;t.loadXML(s);s=this.responseXML=t}catch(u){}break}n(this,s,r,200)}}else{l.onreadystatechange=function(e){if(l.readyState!=4){return}delete c[o];if(n==b||this.FSIaborted){return}var s=(this.responseXML!=null&&this.responseXML.firstChild)?this.responseXML:this.responseText;n(this,s,r,l.status)}}try{l.open("GET",m,true);l.send(null)}catch(q){n(this,"",r,500)}return l};this.stopPendingRequests=function(){for(var k in c){var e=c[k];if(e){e.FSIaborted=true;if(e.abort){e.abort()}}}};this.destroy=function(){h.reset()};this.reset=function(){this.stopPendingRequests();c={}}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CanvasProgressBar!=b){return}a.CanvasProgressBar=function(r,l,j,d,p,e){var q=this;var r=r;if(!e){e={}}if(typeof(e.border)!="string"){e.frame="#58a8ff"}if(typeof(e.color)!="string"){e.color="#58a8ff"}if(typeof(e.background)!="string"){e.background="rgba(255,255,255,0.5)"}if(typeof(e.text)!="string"){e.text="#FFFFFF"}var o=l;var n=j;var g=p;var k=d;var h=0;this.draw=function(s){var t=k/100*s;i(o,n,k,g,h);c(o,n,t,g,h,k);f(o,n,t,g,h,k)};this.setCtx=function(s){r=s};this.setPos=function(s,t){o=s;n=t};var i=function(u,w,v,t,s){r.save();r.fillStyle=e.border;m(u-1,w-1,v+2,1,s);m(u-1,w+t,v+2,1,s);m(u-1,w-1,1,t+2,s);m(u+v,w-1,1,t+2,s);r.fillStyle=e.background;m(u,w,v,t,s);r.restore()};var c=function(v,z,w,u,t,s){r.fillStyle=e.color;m(v,z,w,u,t)};var m=function(u,w,v,t,s){r.fillRect(u,w,v,t)};var f=function(A,w,s,C,v,z){r.save();r.font="10px Arial";r.textAlign="start";r.textBaseline="alphabetic";r.fillStyle=e.text;var B=Math.floor(s/z*100)+"%";var t=r.measureText(B).width;var u=A+s-t-v/2-4;if(s<=v+t){u=A+v/2}r.fillText(B,u,w+C/2+3.25);r.restore()}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.Config!=b){return}a.Config=function(l,u){if(!u||typeof(u)!="object"){u={}}this.parameters=(l)?l:{};this.queryParameters=b;try{this.XMLSerializer=(XMLSerializer)?new XMLSerializer():b}catch(A){}this.plugins=new Object();this.arPlugins=new Array();this.nPluginToInit=-1;this.arUnrecognizedConfigNodes=new Array();this.locales=new Object();this.locales.tips=new Object();var f=false;var n=this;this.strListFilePrefix="";this.strListFileSuffix="";var m={};var y=0;var w=false;var i;var z={};var r="FSI> ";var o=new a.EmptyDebugger();var q=false;var g={};var B;var v;var s=false;this.strConfigFileExtension=".xml";n.strTemplateSuffix=".json";var t;var h=null;if(a.isInternetExplorer&&a.versionInternetExplorer<10){t=function(D){var e;if(!a.isCrossDomain(D)){s=false;e=new XMLHttpRequest()}else{s=true;e=new XDomainRequest()}return e}}else{if(typeof XMLHttpRequest!="undefined"){t=function(){return new XMLHttpRequest()}}}if(!t){try{h=new ActiveXObject("Msxml2.XMLHTTP");t=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(A){try{h=new ActiveXObject("Microsoft.XMLHTTP");t=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(A){h=null;t=function(){return null}}}}this.bForceVersion5=false;this.pluginDefaultParameters=new Object();this.pluginDefaultParameters.pages={};this.cfgAliasNames={imagesrc:"fpxsrc",imagesources:"fpxsources",imageheight:"fpxheight",imagewidth:"fpxwidth",imageservertemplate:"fpxservertemplate",renderer:"fpxservertemplate",imageinfotemplate:"fpxinfotemplate",imageservertype:"fpxservertype",imagetilepaddingx:"fpxtilepaddingx",imagetilepaddingy:"fpxtilepaddingy",imagetilewidth:"fpxtilewidth",imagetileheight:"fpxtileheight",imagetilesx:"fpxtilesx",imagetilesy:"fpxtilesy",imageserver:"fpxserver",imagepath:"fpxpath",imagetransparency:"fpxtransparency"};this.cfgAliasNamesSecondLevel={renderer:"fpxservertemplate"};this.cfg=this.cfgDefaults={defaultcfg:"_default",headers:"cors",fsibase:"config/",fpxservertemplate:"jpeg",listtemplate:"image_list"};this.init=function(D){n.reset();if(D){if(n.parameters){n.parameters=a.mergeObjects(n.parameters,D)}else{n.parameters=D}}k(n.parameters);n.getQueryParameters();n.cloneParameters(n.cfgDefaults,n.cfg);n.cloneParameters(n.queryParameters,n.cfg);n.elevateToHTTPS();p();n.BaseURL=n.getBaseURL();if(n.bForceVersion5==true){}var e=n.queryParameters.fsiviewerversion;if(n.bForceVersion5==true){e="5"}if(e!=b){if(parseInt(e)<6){n.strConfigFileExtension=".fsi"}}var E=n.queryParameters.fsiserverversion;if(n.bForceVersion5==true){E="2"}if(E!=b){if(parseInt(E)<3){n.strTemplateSuffix="_json"}}if(n.queryParameters.fsiviewerlocation!=b){n.locationFSIViewer=n.queryParameters.fsiviewerlocation}else{if(a!=b&&a._FSIViewerLocation!=b){o.log("FSI Viewer location gussed based on script location: "+a._FSIViewerLocation);n.locationFSIViewer=a._FSIViewerLocation}else{n.locationFSIViewer=n.BaseURL.split("/");if(n.locationFSIViewer.length>4){n.locationFSIViewer.splice(n.locationFSIViewer.length-3,2);n.locationFSIViewer=n.locationFSIViewer.join("/")}}}if(n.locationFSIViewer.charAt(n.locationFSIViewer.length-1)!="/"){n.locationFSIViewer+="/"}n.nextConfigURL=n.getReloadPath(n.locationFSIViewer,n.expandFSIPath(n.cfg.defaultcfg));n.checkDebug(false)};var k=this.makeObjectPropertiesLowerCase=function(e){for(var D in e){var E=D.toLowerCase();if(D!=E){if(e[E]==b){e[E]=e[D]}delete e[D]}}};var p=function(){f=n.makeBool(n.cfg.usenc,false);if(n.cfg.usencquery!=b&&n.cfg.usencquery.length>0){q=n.cfg.usencquery;f=true;n.queryToObject("?"+q,g)}};this.stopPendingRequests=function(){for(var D in m){var e=m[D];if(e){e.FSIaborted=true;if(e.abort){e.abort()}}}};this.destroy=function(){n.stopPendingRequests()};this.getBaseURL=function(){var E;var D=document.getElementsByTagName("base");if(D&&D.length>0){E=D[D.length-1].href;if(E&&E.charAt(E.length-1)!="/"){E+="/"}}else{E=document.location.href;var e=E.indexOf("?");if(e!=-1){E=E.slice(0,e)}e=E.indexOf("#");if(e!=-1){E=E.substring(0,e)}e=E.lastIndexOf("/");if(e!=-1){E=E.slice(0,e+1)}}return E};this.reset=function(){o=new a.EmptyDebugger();n.stopPendingRequests();i=Math.random();n.nIncludedConfigs=0;n.completedConfigs=new Object();n.plugins=new Object();n.cfg=new Object();n.queryParameters=b;n.arUnrecognizedConfigNodes=[]};this.getQueryParameters=function(){if(n.queryParameters!=b){return}n.queryParameters=new Object();n.cloneParameters(n.parameters,n.queryParameters)};this.makeBool=function(F,e){if(typeof(e)!="boolean"){e=false}var D=e;switch(typeof(F)){case"string":var E=a.makeBool(F);if(E!=b){D=E}break;case"number":D=Boolean(F);break;case"boolean":D=F;break}return D};this.parsePositionParameter=function(D){if(typeof(D)!="string"||D.length<3){return b}var D=D.split(",");if(D.length<3){return b}for(var e=0;e<3;e++){D[e]=parseFloat(D[e]);if(isNaN(D[e])){D[e]=0}}return{x:D[0],y:D[1],z:D[2]}};this.loadLanguageFile=function(){var D=n.cfg.language;if(D==b){D="english"}var e=n.locationFSIViewer+"/languages/"+D+".xml";var E={};n.finishRequestParams(E);Ext.Ajax.request({url:e,overrideMimeType:"application/xml",params:E,method:"GET",scope:n,success:function(F,G){n.logXMLResponseOK(F);n.onLanguageLoaded(true,F)},failure:function(F,G){n.logLoadFileFailed(F,G);n.onLanguageLoaded(false,F)}})};this.logLoadFileFailed=function(e,F){if(!o.on){return}if(e&&e.status!=b){var E="HTTP "+e.status;if(e&&e.statusText){E+=", "+e.statusText}var D=(e._url)?e._url:"";o.error("Failed to load "+D+" ("+E+")")}else{o.error("Failed loading a file");if(e&&e._url){o.error(e._url)}}};this.logXMLResponseOK=function(e){};this.parseLanguage=function(G){if(!G||!G.firstChild){return false}var e=G.firstChild.childNodes;var H,E,F;for(var D=0;D<e.length;D++){E=e[D];H=n.getAttributeValue(E,"id");if(H==b){continue}H=H.toLowerCase();if(E.childNodes.length>0){F=n.XMLChildNodesToString(E)}else{F=n.getAttributeValue(E,"txt")}n.locales.tips[H]=F}return true};this.getAttributeValue=function(D,e){if(!D){return}return D.getAttribute(e)};this.onLanguageLoaded=function(D,e){o.log("Language loaded");if(D){n.parseLanguage(e.responseXML)}n.initPagesParameters();if(u.onConfigReady){u.onConfigReady()}};this.onConfigReadyDone=function(){if(!n.readCustomPageNumbers()){n.loadImageList()}};this.swapParameters=function(E,e){E=E.toLowerCase();e=e.toLowerCase();var D=n.plugins.pages.parameters;if(D==b){return}n.swapValues(D,E,e);n.swapValues(n.cfg,"pages_"+E,"pages_"+e)};this.swapValues=function(F,E,D){var e=F[E];F[E]=F[D];F[D]=e};this.initPagesParameters=function(){n.LinkTemplates=n.getPagesParameter("LinkTemplates","").split(",");for(var e=0;e<n.LinkTemplates.length;e++){n.LinkTemplates[e]=a.urlDecode(n.LinkTemplates[e])}n.LinkTemplateData=n.getPagesParameter("LinkTemplateData","").split(",");for(var e=0;e<n.LinkTemplateData.length;e++){n.LinkTemplateData[e]=a.urlDecode(n.LinkTemplateData[e])}n.LinkTemplateCount=Math.max(n.LinkTemplates.length,n.LinkTemplateData.length)};this.getTranslation=function(D){var e=n.locales.tips[D.toLowerCase()];if(e==b){e=D}return e};this.getImageURL=function(E,e){if(E==b){return""}if(e==b){e={}}if(e.type==b){e.type="image"}if(e.renderer==b){e.renderer="jpeg"}e.source=E;for(var D in z){if(e[D]==b){e[D]=z[D]}}return n.requestBase+"?"+n.objectToQuery(e)};this.getImageInfoURL=function(D,e){if(D==b){return""}if(e==b){e={}}if(e.type==b){e.type="info"}if(e.tpl==b){if(n.cfg.fpxinfotemplate!=b){e.tpl=n.cfg.fpxinfotemplate}else{e.tpl="info.json"}}if(n.cfg.headers&&n.cfg.headers.length>0){e.headers=n.cfg.headers}if(!e.tpl.match(/.json$/)){e.tpl+=".json"}e.source=D;return n.requestBase+"?"+n.objectToQuery(e)};this.queryToObject=function(G,E){if(E==b){E={}}var F,I,H,e,D;F=G.indexOf("?");if(F!=-1){D=G.slice(F+1)}else{D=""}F=D.indexOf("#");if(F!=-1){D=D.substring(0,F)}D=D.split("&");for(F=0;F<D.length;F++){I=D[F].split("=");H=a.urlDecode(I[0]).toLowerCase();if(H.length>0){e=a.urlDecode(I[1]);E[H]=e}}return E};this.parseSceneSets=function(e,G){var N={};if(G==b){G=true}var S=[];var Q=0;var O=0;var E;var I,H,F,M,K,R;var J,L,P;var D=n.cfg.scenesets;if(e>1&&D!=b&&typeof(D)=="string"){L=D.split(";");for(I=0;I<L.length;I++){P=new Array();J=L[I].split(",");O=0;for(H=0;H<J.length;H++){R=J[H].split("-");M=K=0;if(R.length==1){M=parseInt(R[0])}else{M=parseInt(R[0]);if(isNaN(M)){M=1}E=false;if(R[1].charAt(0)==">"){R[1]=R[1].substr(1);if(!isNaN(parseInt(R[1]))){E=true}}K=parseInt(R[1]);if(isNaN(K)){K=e}if(M>0&&K>0&&M<=e&&K<=e){if(E==true||M!=K){if(E!=true){if(K<M){for(F=M;F>=K;F--){P[O]=F;O++}}else{for(F=M;F<=K;F++){P[O]=F;O++}}}else{for(F=M;F<=e;F++){P[O]=F;O++}for(F=1;F<=K;F++){P[O]=F;O++}}}}}if(M>0&&M<=e&&(K==0||K==M)){P[O]=M;O++}}if(O>0){S[Q]={};S[Q].arScenes=new Array();S[Q].arScenes=S[Q].arScenes.concat(P);Q++}}}if(Q==0){N.bDefault=true;if(G){S[0]={};S[0].arScenes=new Array();for(I=0;I<e;I++){S[0][I]=I}}}N.nSceneSets=Q;N.bHasMultipleSets=(N.nSceneSets>1);N.arSets=S;N.nCurrent=1;return N};this.objectToQuery=function(D){var e=[];if(f&&q!==false){for(var F in g){D[F]=g[F]}}for(var F in D){var E=encodeURIComponent(D[F]);e.push(encodeURIComponent(F)+"="+E)}return e.join("&")};this.loadConfigs=function(){n.loadNextConfig(true)};this.loadFile=function(D,E,G,H){if(!D||D.length<0){if(E){E(this,"",H)}return}if(G==b){G="application/json"}var e=t(D);if(!e){return}if(G&&e.overrideMimeType){e.overrideMimeType(G)}e._url=D;var F=y;m[y]=e;y++;if(s){e.onerror=function(){delete m[F];if(E==b||this.FSIaborted){return}n.logLoadFileFailed(this)};e.onload=function(){delete m[F];if(E==b||this.FSIaborted){return}var I=this.responseText;switch(this.contentType){case"application/xml":case"text/xml":try{var J=new ActiveXObject("Microsoft.XMLDOM");J.async=false;J.loadXML(I);I=this.responseXML=J}catch(K){o.log("Failed parsing XML using Microsoft.XMLDOM");o.log(D)}break;case"application/json":I={};try{I=a.JSON.parse(this.responseText)}catch(K){o.error("Failed parsing JSON from URL: "+D+" ("+K.message+")")}break}E(this,I,H)}}else{e.onreadystatechange=function(I){var J;if(e.readyState!=4){return}delete m[F];if(E==b||this.FSIaborted){return}if(this.status>299){n.logLoadFileFailed(this)}switch(G){case"application/xml":case"text/xml":J=this.responseXML;break;case"application/json":J={};try{J=a.JSON.parse(this.responseText)}catch(K){o.error("Failed parsing JSON from URL: "+D+" ("+K.message+")")}break}E(this,J,H)}}e.open("GET",D,true);e.send(null);return e};this.onConfigXMLLoaded=function(e,D){n.logXMLResponseOK(e.response);n.onConfigLoaded(e.responseXML)};this.loadNextConfig=function(E){if(n.nextConfigURL==b){n.finalCheck();return}var e=!n.makeBool(n.cfg.ConfigCaching,true);var F={};if(n.makeBool(n.cfg.debug)||(!E&&!n.makeBool(n.cfg.configcaching,true)&&n.makeBool(n.cfg.enableconfigcachingparameter))){n.addNoCacheParams(F)}n.finishRequestParams(F);var D=n.addURLParameters(n.nextConfigURL,F);o.log("LOAD CONFIG: "+D);n.loadFile(D,n.onConfigXMLLoaded,"application/xml")};this.parseMargins=function(E,D,e,F){if(e==b){e=_root._FSI.StageWidth}if(F==b){F=_root._FSI.StageHeight}E[D+"Left"]=n.getFloatParameterPercent(D+"Left",0,e);E[D+"Top"]=n.getFloatParameterPercent(D+"Top",0,F);E[D+"Right"]=n.getFloatParameterPercent(D+"Right",0,e);E[D+"Bottom"]=n.getFloatParameterPercent(D+"Bottom",0,F);E[D+"Inner"]=n.getFloatParameterPercent(D+"Inner",0,e);E[D+"Outer"]=n.getFloatParameterPercent(D+"Outer",0,e)};this.getFloatParameterPercent=function(e,D,E){return n.parseFloatPercentDef(n.getPagesParameter(e),E,D,-1000000)};this.parseFloatPercentDef=function(F,E,D,e){if(F==b||F.length<1){return D}return Math.max(e,n.parseFloatPercent(F,E))};this.parsePercentDef=function(E,e){if(E==b||E.length<1){return e}var D=parseFloat(E);if(isNaN(D)){D=0}else{if(E.indexOf("%")!=-1){D/=100}}return D};this.parseFloatPercent=function(E,D){var e=parseFloat(E);if(isNaN(e)||e<0){e=0}else{if(E.indexOf("%")!=-1){e=Math.round(e*D/100)}else{e=Math.ceil(e)}}return e};this.setDebugPrefix=function(e){r=e+"> "};this.setDebugger=function(e){o=e};this.checkDebug=function(D){var e;if(n.makeBool(n.cfg.debug)){if(!o||!o.on){o=new a.Debugger();if(u.onDebuggerChange){e=u.onDebuggerChange(o,D)}}}else{if(!o||o.on===true){o=new a.EmptyDebugger();if(u.onDebuggerChange){e=u.onDebuggerChange(o,D)}}}return e};this.onConfigLoaded=function(D){n.parseConfig(D);n.elevateToHTTPS();if(n.checkDebug(true)==true){return}p();var e;if(n.cfg.includeconfig!=b&&n.nIncludedConfigs<10){e=n.getFSIPath(n.locationFSIViewer,n.expandFSIPath(n.cfg.includeconfig));n.nIncludedConfigs++;n.cfg["includeconfig("+n.nIncludedConfigs+")"]=n.cfg.includeconfig;n.cfg.includeconfig=b}else{if(n.cfg.cfg!=b){e=n.getFSIPath(n.locationFSIViewer,n.expandFSIPath(n.cfg.cfg))}}if(e!=b&&!n.completedConfigs[e]){n.completedConfigs[e]=true;n.nextConfigURL=e;n.loadNextConfig()}else{n.evaluateQuery(n.queryParameters,n.cfg);n.finalCheck()}};this.elevateToHTTPS=function(){if(!a.bHTTPS){return}if(!n.makeBool(n.cfg.autoelevatetohttps,true)){return}d("fpxbase");d("fpxserver")};var d=function(e){if(n.cfg[e]!=b&&n.cfg[e].length>0&&n.cfg[e].indexOf("http://")==0){n.cfg[e]="https"+n.cfg[e].substr(4)}};this.evaluateQuery=function(D,e){for(var E in D){n.setConfigParamByValue(e,E.toLowerCase(),D[E])}};this.parseConfig=function(D){var M="";if(D!=b){var E=D.firstChild;if(E&&E.nodeName=="xml"){E=E.nextSibling}var L=E.childNodes;for(var I=0;I<L.length;I++){var G=L[I];if(G.nodeType!=1){continue}var J=G.nodeName.toLowerCase();M=J;var F=G.childNodes;switch(J){case"licence":break;case"plugins":for(var H=0;H<F.length;H++){n.parsePluginNode(F[H])}break;case"info":case"options":M=b;case"fpx":case"image":case"video":case"virtualspace":case"camera":case"include":for(var H=0;H<F.length;H++){var K=F[H];if(K.nodeType!=1){continue}var e=n.getValueFromXMLNode(K,M);n.setConfigParam(n.cfg,e)}break;default:n.arUnrecognizedConfigNodes.push(G)}}}};this.getData=function(){var e={};e.cfg={};for(var D in n.cfg){e.cfg[D]=n.cfg[D]}return e};this.setData=function(e){if(!e||!e.cfg){return}n.cfg={};this.setCfgValues(e.cfg)};this.setCfgValues=function(e){for(var D in e){n.cfg[D]=e[D]}c()};this.getImagesNodeList=function(E){var e=[];if(E==b){E=n.getUnrecognizedConfigNode("images")}if(E){var F=E.firstChild;while(F){if(F.nodeType==1){var D={};D.attributes={};j(F,D.attributes);D.cfg={};n.parseConfigFragment(F,D.cfg);e.push(D)}F=F.nextSibling}}return e};this.removeUnrecognizedConfigNodes=function(){n.arUnrecognizedConfigNodes=[]};this.getUnrecognizedConfigNode=function(F){var e;F=F.toLowerCase();for(var D=n.arUnrecognizedConfigNodes.length-1;D>-1;D--){var E=n.arUnrecognizedConfigNodes[D];if(E&&E.nodeName.toLowerCase()==F){e=E;break}}return e};this.parseConfigFragment=function(F,J,I){var N="";if(F!=b&&J!=b){if(I==b){I=[]}var D=F;var M=D.childNodes;for(var H=0;H<M.length;H++){var F=M[H];if(F.nodeType!=1){continue}var K=F.nodeName.toLowerCase();N=K;var E=F.childNodes;switch(K){case"info":case"options":N=b;case"fpx":case"image":case"include":for(var G=0;G<E.length;G++){var L=E[G];if(L.nodeType!=1){continue}var e=n.getValueFromXMLNode(L,N);n.setConfigParam(J,e)}break;default:I.push(F)}}}};this.findXMLNode=function(D,e){if(D==b||D.nodeType==b){return b}while(D){if(D.nodeName.toLowerCase()==e){break}if(D.firstChild!=b){D=D.firstChild}else{if(D.nextSibling!=b){D=D.nextSibling}else{D=D.parentNode.nextSibling}}}return D};this.getValueFromXMLNode=function(E,e){if(!E||E.nodeType!=1){return}var D=new Object();var F=(e)?e:"";D.name=F+E.nodeName.toLowerCase();var G=E.getAttribute("value");if(G){D.value=G;return D}D.value=n.XMLChildNodesToString(E);D.node=E;return D};this.getXMLNodeAttribute=function(F,E,e){if(!F||F.nodeType!=1||!F.getAttribute){return e}var D=F.getAttribute(E);if(D==b||D==null){D=e}return D};this.XMLChildNodesToString=function(D){if(!D||!D.firstChild){return""}var e="";if(D.childNodes.length==1&&D.firstChild.nodeType==3){e=D.firstChild.nodeValue}else{e=n._XMLChildNodesToString(D)}return e};this.hasPlugin=function(e){return(n.plugins&&n.plugins[e]!=b)};this.getPluginParameter=function(I,D,e,H){I=I.toLowerCase();D=D.toLowerCase();if(n.plugins[I]==b){o.error("CANNOT GET PLUGIN PARAMETER, because plugin not defined: "+I+"."+D);return e}var G;var F=I+"_"+D;if(n.cfg[F]!=b){G=n.cfg[F]}else{var E=n.plugins[I].parameters;if(E!=b&&E[D]!=b){G=E[D]}}if(G==b){G=e}if(H){G=n.makeBool(G,e)}return G};this.getUnescapedPagesParameter=function(F,E,D){var e=n.getPagesParameter(F,E);if(e==b&&D!=b){e=n.getPagesParameter(D,E)}if(e!=b){e=a.urlDecode(e)}return e};this.getIntParameterMinMax=function(D,E,e,F){return Math.min(F,Math.max(e,n.getIntParameter(D,E)))};this.getIntParameter=function(D,E){var e=parseInt(n.cfg[D.toLowerCase()]);if(isNaN(e)){e=E}return e};this.getStringParameter=function(D,E){var e=n.cfg[D.toLowerCase()];if(e==b){e=E}return e};this.getFloatParameter=function(D,E){var e=parseFloat(n.cfg[D.toLowerCase()]);if(isNaN(e)){e=E}return e};this.getRGBAValue=function(D){var e=new Object();if(D==b){D=""}if(D.charAt(0)=="#"){D=D.substr(1)}if(D.length>8){D=D.substr(0,8)}if(D.length>5){e.webColor="#"+D.substr(0,6);e.red=parseInt(D.substr(0,2),16);e.green=parseInt(D.substr(2,2),16);e.blue=parseInt(D.substr(4,2),16);if(D.length<7){e.alpha=255}else{e.alpha=parseInt(D.substr(6,2),16)}}else{e.alpha=255;e.webColor="#000000";e.red=e.green=e.blue=0}e.webAlpha=e.alpha/255;return e};this.getPagesParameter=function(D,e,E){return n.getPluginParameter("pages",D,e,E)};var j=function(H,D){if(!H||!H.attributes||!H.attributes.length||!D){return false}var E=H.attributes;for(var G=0;G<E.length;G++){var e=E[G];var F=e.nodeName.toLowerCase();D[F]=e.value}return true};this.parsePluginNode=function(E){if(E.nodeType!=1){return}var G=new Object();j(E,G);var F=E.childNodes;for(var e=0;e<F.length;e++){var H=F[e];if(H.nodeType!=1){continue}var D=n.getValueFromXMLNode(H);if(D.value!=b){G[D.name]=D.value;if(D.node!=b){G[D.name+".node"]=D.node}}}this.addPluginFromString(G.src,G)};this.trimString=function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};this.addPluginsFromString=function(E){if(E==b||E.split==b||E.length<1){return}var e=E.split(",");for(var D=0;D<e.length;D++){var F=n.trimString(e[D]);n.addPluginFromString(F)}};this.addPluginFromString=function(D,E){if(D==b||D.length<1){o.error("PLUGIN without src parameter:");return}D=D.toLowerCase();if(E==b){E=new Object()}var e=n.plugins[D]=new Object();e.name=D;if(n.pluginDefaultParameters[D]!=b){e.parameters=new Object();n.cloneParameters(n.pluginDefaultParameters[D],e.parameters);n.cloneParameters(E,e.parameters)}else{e.parameters=E}};this.setConfigParamByValue=function(D,E,e){n.setConfigParam(D,{name:E.toLowerCase(),value:e})};this.setConfigParam=function(D,E){var F=E.name;var e=E.value;if(F==b){return}if(n.cfgAliasNames[F]!=b){F=n.cfgAliasNames[F]}if(D[F]!=b&&(typeof(e)=="string"&&a.BoolTable[e.toLowerCase()]==false)&&a.BoolTable[D[F]]==b){delete D[F]}else{switch(F){case"effects":case"righteffects":case"lefteffects":case"tileeffects":case"sceneeffects":case"naveffects":case"thumbeffects":if(D[F]!=b&&D[F].length>0&&D[F].indexOf(e)==-1){D[F]+=","+e}else{D[F]=e}break;case"plugins":n.addPluginsFromString(e);break;case"fpxpath":D[F]=e;D.fpxsrc=encodeURIComponent(e);break;default:D[F]=e;if(E.node!=b){D[F+".node"]=E.node}}}};var c=function(){n.serverProfile=n.cfg.fpxservertemplate;n.serverProfileDoublePage=n.cfg.fpxservertemplatedoublepage;if(n.serverProfileDoublePage==b){n.serverProfileDoublePage="doublepage"}n.serverBase=n.cfg.fpxserver;if(n.serverBase==b){o.log("Note:",true);o.log("Parameter 'imageserver' undefined, guess from ["+n.locationFSIViewer+"]",true);var D;D=n.locationFSIViewer.indexOf("/users/");if(D!=-1){n.serverBase=n.locationFSIViewer.substring(0,D)+"/server"}else{D=n.locationFSIViewer.indexOf("/viewer/");n.serverBase=n.locationFSIViewer.substring(0,D)+"/server"}o.log("guessed location is: ["+n.serverBase+"]",true)}n.requestBase=n.serverBase;z={};var e=n.cfg.effects;if(e!=b){z.effects=e}e=n.cfg.lefteffects;if(e!=b){z.lefteffects=e}e=n.cfg.righteffects;if(e!=b){z.righteffects=e}e=n.cfg.quality;if(e!=b){z.quality=e}};this.finalCheck=function(){n.elevateToHTTPS();c();if(u.onConfigsReady){u.onConfigsReady()}o.log("Evaluated Configuration:");o.dir(n.cfg)};var C=n.finishURL=function(e){if(!f||e==b){return e}var D;if(q===false){D="cache=0&cachernd="+i;if(e.indexOf("?")==-1){e+="?"+D}else{e+="&"+D}}else{D=q;if(e.indexOf("?")==-1){e+="?"+D}else{e+=D}}return e};this.addURLParameters=function(D,E){if(!D||!E){return D}var e=[];for(var F in E){e.push(encodeURIComponent(F)+"="+encodeURIComponent(E[F]))}if(e.length>0){if(D.indexOf("?")==-1){D+="?"}else{D+="&"}D+=e.join("&")}return D};this.finishRequestParams=function(D){if(f){if(q===false){D.cache=0;D.cachernd=i}else{for(var e in g){D[e]=g[e]}}}};this.addNoCacheParams=function(e){e.cache=0;e.cachernd=i};this.parseQuery=function(D,e){if(e==b||D==b||D.length<1){return}n.queryToObject(D,e);if(e.ignorequeryparameters!=b){delete e.ignorequeryparameters}if(e.enableconfigcachingparameter!=b){delete e.enableconfigcachingparameter}};this.cloneParameters=function(e,D){if(e==b||D==b){o.error("Cloning object failed: "+e+" / "+D)}for(var E in e){D[E]=e[E]}};this.getFSIPath=function(D,E){if(E.indexOf("//")!=-1){return E}if(n.cfg.fsibase!=b){E=n.cfg.fsibase+E}var e=n.getReloadPath(D,E);return e};this.expandFSIPath=function(D){var e=a.urlDecode(D);if(e.indexOf("?")!=-1||e.indexOf(n.strConfigFileExtension)==(e.length-4)){return D}return D+n.strConfigFileExtension};this.getReloadPath=function(F,H){var D,I,e,G;if(F==b){F=n.locationFSIViewer}if(H==b){H=""}var E="/";if(H.indexOf("//")!=-1){return H}D=F;G=D.lastIndexOf("?");if(G==-1){G=D.length}I=D.lastIndexOf("\\",G);e=D.lastIndexOf("/",G);I=Math.max(I,e);if(I==-1){I=D.length-1}D=D.slice(0,I);if(D.length>0&&H.indexOf(E)!=0){D+=E}return D+H};this.cloneValueObject=function(D){var e=new Object();for(var E in D){e[E]=D[E]}return e};this._getXMLConfigValue=function(e){var D;if(!e){return}if(e.childNodes.length>0){D=n._XMLChildNodesToString(e)}else{D=e.getAttribute("value")}return D};this._XMLChildNodesToString=function(F){if(!F||!F.firstChild){return""}var D="";try{if(F.xml!=b){for(var E=0;E<F.childNodes.length;E++){D+=F.childNodes[E].xml}}else{for(var E=0;E<F.childNodes.length;E++){D+=n.XMLSerializer.serializeToString(F.childNodes[E])}}}catch(G){}return D};this._findFirstXMLNode=function(E,F){var D,e;while(E){if(E.nodeName==F){e=E;break}D=E.firstChild;if(!D){D=E.nextSibling}if(!D&&E.parentNode){D=E.parentNode.nextSibling}E=D}return e};this._parseXMLImageList=function(D){var e=n._findFirstXMLNode(D,"images");if(!e){e=n._findFirstXMLNode(D,"images3d")}return parseXMLImageListNode(e)};this._parseXMLImageListNode=function(G){var J={};var e=J.arImages=[];var F="";var H="";var E;if(!G){return J}var D;D=n.getAttributeValue(G,"prefix");if(typeof(D)=="string"){F=D}D=n.getAttributeValue(G,"suffix");if(typeof(D)=="string"){H=D}var G=n._findFirstXMLNode(G,"image");if(!G){return J}while(G){if(G.nodeType==1){E=n._findFirstXMLNode(G,"path");var I=n._getXMLConfigValue(E);if(!I){I=a.urlDecode(n.getAttributeValue(G,"src"))}if(!I){I=a.urlDecode(n.getAttributeValue(G,"file"))}if(I!=b){e.push(F+I+H)}if(J.width==b){E=n._findFirstXMLNode(G,"width");E=n._getXMLConfigValue(E);if(E!=b){J.width=parseInt(E)}E=n._findFirstXMLNode(G,"height");E=n._getXMLConfigValue(E);if(E!=b){J.height=parseInt(E)}}}G=G.nextSibling}return J};this.getImageList=function(){var e;if(n.cfg&&n.cfg.fpxsources!=b){e={};e.oXML=null;e.arImages=n.cfg.fpxsources.split(",");for(var E=0;E<e.arImages.length;E++){e.arImages[E]=a.urlDecode(e.arImages[E])}return e}if(n.arUnrecognizedConfigNodes&&n.arUnrecognizedConfigNodes.length>0){var D=n.arUnrecognizedConfigNodes;for(var E=0;E<D.length;E++){var F=D[E];if(typeof(F.nodeName)=="string"){var G=F.nodeName.toLowerCase();if(G=="images"||G=="images3d"){if(o.on){o.log("Reading image list from XML node: <"+F.nodeName+">")}e=n._parseXMLImageListNode(F);e.oXML=F;break}}}}if(n.cfg&&n.cfg.fpxsrc!=b){e={};e.oXML=null;e.arImages=[];e.arImages.push(a.urlDecode(n.cfg.fpxsrc));return e}return e};this.loadImageList=function(F,G,I,H){if(!n.serverBase||!F){G([],oResponse,H);return false}var E=n.serverBase+"?type=list";if(F.indexOf("tpl")==-1){var D=n.cfg.listtemplate;if(D&&D.length>0&&D.indexOf(".json")==-1&&D.indexOf(".xml")==-1){D+=".json"}E+="&tpl="+D}if(n.cfg.headers&&n.cfg.headers.length>0&&g.headers==b){E+="&headers="+n.cfg.headers}E+="&source="+encodeURIComponent(F);if(I!=b){E+=I}E=C(E);var e=n.loadFile(E,function(J,M){if(typeof(M)=="object"&&typeof(M.images)=="object"){M.images.pop();var N="";if(M&&M.imagesattributes&&M.imagesattributes.dir){N=M.imagesattributes.dir}var K=new Array(M.images.length);for(var L=0;L<M.images.length;L++){K[L]=N+M.images[L].src}G(K,M,H)}else{G([],M,H)}},"application/json",H);return e}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.Rect!=b){return}a.Rect=function(d,f,g,c){var e=this;e.left=(isNaN(d))?0:d;e.top=(isNaN(f))?0:f;e.right=(isNaN(g))?0:g;e.bottom=(isNaN(c))?0:c;this.width=function(){var h=e.right-e.left;return(h<0)?-h:h};this.height=function(){var h=e.bottom-e.top;return(h<0)?-h:h};this.offsetRect=function(i,h){e.left+=i;e.right+=i;e.top+=h;e.bottom+=h};this.inflateRect=function(j,i){var h=j/2;var k=i/2;e.left-=h;e.top-=k;e.right+=h;e.bottom+=k};this.normalizeRect=function(){var h;if(e.left>e.right){h=e.left;e.left=e.right;e.right=h}if(e.top>e.bottom){h=e.top;e.top=e.bottom;e.bottom=h}};this.setRect=function(i,j,k,h){e.left=i;e.top=j;e.right=k;e.bottom=h};this.scaleRect=function(h){if(h==1){return}e.left*=h;e.top*=h;e.right*=h;e.bottom*=h};this.scaleRectXY=function(i,h){e.left*=i;e.top*=h;e.right*=i;e.bottom*=h};this.scaleRectInt=function(h){if(h==1){return}e.left=Math.round(e.left*h);e.top=Math.round(e.top*h);e.right=Math.round(e.right*h);e.bottom=Math.round(e.bottom*h)};this.interSectRect=function(l){e.normalizeRect();l.normalizeRect();var k=Math.max(e.left,l.left);var h=Math.max(e.top,l.top);var i=Math.min(e.right,l.right);var j=Math.min(e.bottom,l.bottom);e.setRect(k,h,i,j)};this.interSectRectValidate=function(h){e.interSectRect(h);if(e.right<e.left){e.left=e.right=0}if(e.bottom<e.top){e.top=e.bottom=0}};this.isInsideRect=function(h){return(e.left>=h.left&&e.top>=h.top&&e.right<=h.right&&e.bottom<=h.bottom)};this.isRectInsideMe=function(h){return(e.left<=h.left&&e.top<=h.top&&e.right>=h.right&&e.bottom>=h.bottom)};this.getBoundingRect=function(m){e.normalizeRect();m.normalizeRect();var l=Math.min(e.left,m.left);var h=Math.min(e.top,m.top);var j=Math.max(e.right,m.right);var k=Math.max(e.bottom,m.bottom);var i=new a.Rect(l,h,j,k);return i};this.equalRect=function(h){if(e.left==h.left&&e.top==h.top&&e.right==h.right&&e.bottom==h.bottom){return true}else{return false}};this.copyRect=function(h){e.setRect(h.left,h.top,h.right,h.bottom)};this.duplicateRect=function(){return new a.Rect(e.left,e.top,e.right,e.bottom)};this.round=function(h){var i=function(k,j){k*=j;k=(k>=0)?Math.floor(k+0.5):Math.ceil(k-0.5);return k/j};if(isNaN(h)){h=1000000}e.left=i(e.left,h);e.top=i(e.top,h);e.right=i(e.right,h);e.bottom=i(e.bottom,h)};this.toString=function(){return e.left+","+e.top+","+e.right+","+e.bottom};this.getRange=function(){var h={};h.left=e.left;h.top=e.top;h.width=e.width();h.height=e.height();return h}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CroppedImage!=b){return}a.CroppedImage=function(){var p=this;var e=new a.Rect(0,0,0,0);var n,d;var i=new a.Rect();var h=new a.Rect(0,0,1,1);var c={width:0,height:0};var k=false;var o=function(t,s){if(typeof(t)!="string"){return s}var q=t.split(",");var r=q.length;while(q.length<4){q.push(s[r]);r++}return q};this.setCropFromConfig=function(q){if(q.cropvalues!=b){p.setCropValuesParam(q.cropvalues)}else{if(q.croprect!=b){p.setCropRectParam(q.croprect)}}};this.setCropRectParam=function(r){var q=o(r,["0","0","1","1"]);p.setCropRect(q[0],q[1],q[2],q[3])};var g=function(s,r){var q;if(isNaN(s)){q=r}else{q=Math.max(0,Math.min(1,s))}return q};var j=function(r,q){return Math.round(r*q)};this.setCropRect=function(s,u,v,q){n={l:s,t:u,r:v,b:q};d=b;s=g(s,0);u=g(u,0);v=g(v,1);q=g(q,1);h.setRect(s,u,1-v,1-q);s=j(s,c.width);u=j(u,c.height);v=c.width-j(v,c.width);q=c.height-j(q,c.height);f(s,u,v,q)};var f=function(s,u,v,q){v=Math.min(c.width-s,v);q=Math.min(c.height-u,q);e.setRect(s,u,v,q);k=(s!=0||u!=0||v!=0||q!=0);i.setRect(s,u,c.width-v,c.height-q)};this.setCropValuesParam=function(r){var q=o(r,["0","0","0","0"]);p.setCropValues(q[0],q[1],q[2],q[3])};var m=function(s,q){var r={};if(s.indexOf("%")!=-1){s=Math.max(0,Math.min(100,parseFloat(s)));r.floatVal=s/100;r.pxVal=Math.round(s*q/100)}else{if(s.indexOf("px")!=-1){s=parseInt(s);r.pxVal=Math.max(0,Math.min(q,s));r.floatVal=r.pxVal/q}else{r.floatVal=Math.max(0,Math.min(1,parseFloat(s)));r.pxVal=Math.round(r.floatVal*q)}}return r};this.setCropValues=function(s,u,v,q){d={l:s,t:u,r:v,b:q};n=b;s=m(s,c.width);v=m(v,c.width);u=m(u,c.height);q=m(q,c.height);h.setRect(s.floatVal,u.floatVal,v.floatVal,q.floatVal);f(s.pxVal,u.pxVal,v.pxVal,q.pxVal)};this.setSourceDimension=function(q,r){c.width=q;c.height=r;l()};this.getSourceDimension=function(){return{width:c.width,height:c.height}};this.isCropped=function(){return k};this.getImageRect=function(){return i.duplicateRect()};this.getFloatValues=function(){return h.duplicateRect()};this.getFloatRect=function(){var q=h.duplicateRect();q.right=1-q.right;q.bottom=1-q.bottom;return q};this.getCropMargins=function(){return e.duplicateRect()};var l=function(){if(n!=b){p.setCropRect(n.l,n.t,n.r,n.b)}else{if(d!=b){p.setCropValues(d.l,d.t,d.r,d.b)}else{f(0,0,0,0);h.setRect(0,0,0,0)}}};this.getOffsettedPixelRangeRect=function(q,v,r,t){var u=i.width();var s=i.height();q=Math.max(0,Math.min(u,q));v=Math.max(0,Math.min(s,v));r=Math.max(0,Math.min(u-q,r));t=Math.max(0,Math.min(s-v,t));q+=i.left;v+=i.top;return new a.Rect(q,v,r,t)};this.getPixelRangeRectByRefWidth=function(q){};this.getPixelRangeRect=function(r,u,z,v,B,s){var q,A;if(r==b&&u==b){r=i.width();u=i.height();A=1}else{if(r!=b){A=i.width()/r;if(u==b){u=i.height()/A}}else{A=i.height()/u;if(r==b){r=i.width()/A}}}if(z==b){z=v=0;B=r;s=u}if(!k){q=new a.Rect(z,v,B,s);q._refWidth=r;q._refHeight=u}else{r*=A;u*=A;var t=new a.Rect(z,v,B,s);t.scaleRect(A);q=p.getOffsettedPixelRangeRect(t.left,t.top,t.right,t.bottom);q.scaleRectInt(1/A);r+=e.left+e.right;u+=e.top+e.bottom;r/=A;u/=A;q._refWidth=Math.round(r);q._refHeight=Math.round(u);q.right=Math.min(q._refWidth-q.left,q.right);q.bottom=Math.min(q._refHeight-q.top,q.bottom)}return q};this.getPixelRangeParameters=function(A,u,q,z,r,t){var s;var v=p.getPixelRangeRect(A,u,q,z,r,t);if(v.left==0&&v.top==0&&v.width()==v._refWidth&&v.height()==v._refHeight){s="&width="+v._refWidth}else{s="&pixelRange="+v.left+","+v.top+","+v.right+","+v.bottom+"&referenceWidth="+v._refWidth+"&referenceHeight="+v._refHeight}return s};this.getPixelRangeParametersByCalculatedResult=function(r){var q;if(r.left==0&&r.top==0&&r.width()==r._refWidth&&r.height()==r._refHeight){q="&width="+r._refWidth}else{q="&pixelRange="+r.left+","+r.top+","+r.right+","+r.bottom+"&referenceWidth="+r._refWidth+"&referenceHeight="+r._refHeight}return q}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.Sprite!=b){return}a.Sprite=function(k,i,t,o,s,m,f){var n=this;var c=0.075;var d;var e=true;var u;var j;var v=1;var l=n.margin={left:0,top:0,right:0,bottom:0};var r={};r.width=i;r.height=t;var p=(s)?"canvas":"div";var d=n.element=document.createElement(p);d.setAttribute("draggable","false");if(f){d.className=f}var g="";switch(m){case"inline":break;default:g+="position:absolute;z-index:"+o}a.setStyleAttr(d,g);if(s){n.canvas=n.element;n.canvas.setAttribute("crossorigin","anonymous");n.canvas.setAttribute("width",r.width);n.canvas.setAttribute("height",r.height);n.ctx=n.canvas.getContext("2d")}k.appendChild(d);this.remove=function(){a.removeChild(k,d)};this.setPos=function(h,w){n.x=h;n.y=w;d.style.marginLeft=h+"px";d.style.marginTop=w+"px"};this.isVisible=function(){return(v>0)?true:false};this.show=function(h,w){if(e==h){return}e=h;if(!w){v=(h)?1:0;d.style.display=(h)?"block":"none"}else{if(j!=b){cancelAnimationFrame(j);j=b}u=(h)?c:-c;if(h){d.style.display="block"}q()}};this.updateMargins=function(){l=n.margin=a.getElementMargins(d)};this.getClientDim=function(){var h=a.getElementClientDim(n.element);return h};this.updateDimension=function(){r=a.getElementClientDim(d)};this.width=function(){return r.width};this.height=function(){return r.height};var q=function(){v+=u;if(u>0){if(v>=1){v=1;j=b}else{j=requestAnimationFrame(q)}}else{if(v<=0){v=0;j=b;d.style.display="none"}else{j=requestAnimationFrame(q)}}d.style.opacity=v};if(!s){this.setSize=function(y,z){r.width=y;r.height=z;if(typeof(y)!="string"){y+="px"}if(typeof(z)!="string"){z+="px"}n.element.style.width=y;n.element.style.height=z};this.clear=function(){}}else{this.setSize=function(y,z){r.width=y;r.height=z;n.canvas.width=y;n.canvas.height=z};this.clear=function(){n.ctx.clearRect(0,0,r.width,r.height)}}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.ToolTip!=b){return}a.ToolTip=function(c){var q=this;var n;var h;var d;var l;var j;var k=false;var e={};var g=false;var i;var p=function(){n=document.createElement("div");a.setStyleAttr(n,"background-color:none;display:block;position:relative;vertical-align:top;clear:none;float:none;margin:0px;padding:0px;z-index:1000;");a.addClass(n,"fsi-ui-tool-tip-container fsi-ui-tool-tip-container-hidden");h=document.createElement("div");a.setStyleAttr(h,"position:relative;left:0px;top:0px;display:inline-block;");a.addClass(h,"fsi-ui-tool-tip");n.appendChild(h);d=document.createElement("div");a.setStyleAttr(d,"position:relative;display:block;margin:0px;top:0px;");a.addClass(d,"fsi-ui-tool-tip-arrow");n.appendChild(d)};var m=this.destroy=function(){q.hide();clearTimeout(j)};this.setContent=function(r){i=r};this.show=function(t,s,r,w,v){if(!i){return}e.strTip=t;e.elSrc=s;e.x=r;e.y=w;e.fnGetToolTipText=v;clearTimeout(l);var u=(k)?100:1000;l=setTimeout(f,u)};var f=function(){clearTimeout(l);var t=e.strTip;var u;if(e.fnGetToolTipText!=b){u=e.fnGetToolTipText(t,i);if(u==b){u=i[t]}}else{u=i[t]}if(u!=b){t=u}else{t="<b>"+t+"</b>"}h.innerHTML=t;c.appendChild(n);d.style.left="0px";n.style.display="inline-block";n.style.width=c.offsetWidth+"px";var w=a.getElementClientPos(h);n.style.display="block";n.style.width=w.width+"px";d.style.left=(n.offsetWidth/2-7.5)+"px";var r=e.x;if(r==b){r=0}var z=e.y;if(z==b){z=0}if(e.elSrc!=b){var v=a.getElementClientPos(c);var s=a.getElementClientPos(e.elSrc);r+=s.left-v.left+(s.right-s.left)/2;z+=s.top-v.top}var w=a.getElementClientPos(n);n.style.left=(r-w.width/2)+"px";n.style.top=(z-w.height-2)+"px";g=true;k=true;clearTimeout(j);j=setTimeout(o,1000);a.removeClass(n,"fsi-ui-tool-tip-container-hidden");a.addClass(n,"fsi-ui-tool-tip-container-visible")};var o=function(){k=false};this.hide=function(){clearTimeout(l);if(g){a.removeClass(n,"fsi-ui-tool-tip-container-visible");a.addClass(n,"fsi-ui-tool-tip-container-hidden");a.removeChild(c,n);g=false}};p()}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.FullScreen!=b){return}a.FullScreen={};a.FullScreen.__initDone=false;a.FullScreen.__init=function(){var d=a.FullScreen;if(d.__initDone){return}d.__initDone=true;var c=0;if(document.exitFullscreen){c=0}else{if(document.msExitFullscreen){c=1}else{if(document.mozCancelFullScreen){c=2}else{if(document.webkitExitFullscreen){c=3}}}}switch(c){case 1:d.requestFullscreen="msRequestFullscreen";d.exitFullscreen="msExitFullscreen";d.fullscreenPsudoClass=":-ms-fullscreen";d.fullscreenChange="MSFullscreenChange";d.fullscreenError="MSFullscreenError";d.fullScreen="msFullscreenElement";d.fullscreenElement="msFullscreenElement";break;case 2:d.requestFullscreen="mozRequestFullScreen";d.exitFullscreen="mozCancelFullScreen";d.fullscreenPsudoClass=":-moz-full-screen";d.fullscreenChange="mozfullscreenchange";d.fullscreenError="mozfullscreenerror";d.fullScreen="mozFullScreen";d.fullscreenElement="mozFullscreenElement";break;case 3:d.requestFullscreen="webkitRequestFullscreen";d.exitFullscreen="webkitExitFullscreen";d.fullscreenPsudoClass=":-webkit-full-screen";d.fullscreenChange="webkitfullscreenchange";d.fullscreenError="webkitfullscreenerror";d.fullScreen="webkitIsFullScreen";d.fullscreenElement="webkitFullscreenElement";break;default:d.requestFullscreen="requestFullscreen";d.exitFullscreen="exitFullscreen";d.fullscreenPsudoClass=":fullscreen";d.fullscreenChange="fullscreenChange";d.fullscreenError="fullscreenError";d.fullScreen="fullScreen";d.fullscreenElement="fullscreenElement"}d.nMode=c};a.FullScreen.start=function(c){a.FullScreen.__init();a.FullScreen.quit();c[a.FullScreen.requestFullscreen]()};a.FullScreen.quit=function(){a.FullScreen.__init();document[a.FullScreen.exitFullscreen]()};a.FullScreen.toggle=function(c){if(a.FullScreen.getEnabled()){a.FullScreen.quit()}else{a.FullScreen.start(c)}};a.FullScreen.getFullscreenPseudoClass=function(){a.FullScreen.__init();return a.FullScreen.fullscreenPsudoClass};a.FullScreen.addChangeEvents=function(d,e,c){if(!d){return}a.FullScreen.__init();if(typeof(e)=="function"){a.addEvent(window,a.FullScreen.fullscreenChange,e)}if(typeof(c)=="function"){a.addEvent(window,a.FullScreen.fullscreenError,c)}};a.FullScreen.removeChangeEvents=function(d,e,c){if(!d){return}a.FullScreen.__init();if(typeof(e)=="function"){a.removeEvent(window,a.FullScreen.fullscreenChange,e)}if(typeof(c)=="function"){a.removeEvent(window,a.FullScreen.fullscreenError,c)}};a.FullScreen.getAvailable=function(d){a.FullScreen.__init();var c=d[a.FullScreen.requestFullscreen];return(!c)?false:true};a.FullScreen.getEnabled=function(){a.FullScreen.__init();var c=a.FullScreen.getElement();return(!c)?false:true};a.FullScreen.getElement=function(){a.FullScreen.__init();return document[a.FullScreen.fullscreenElement]}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.Easing!=b){return}a.Easing={easeInQuad:function(f,g,e,h){return h*(f/=g)*f+e},easeOutQuad:function(f,g,e,h){return -h*(f/=g)*(f-2)+e},easeInOutQuad:function(f,g,e,h){if((f/=g/2)<1){return h/2*f*f+e}return -h/2*((--f)*(f-2)-1)+e},easeInCubic:function(f,g,e,h){return h*(f/=g)*f*f+e},easeOutCubic:function(f,g,e,h){return h*((f=f/g-1)*f*f+1)+e},easeInOutCubic:function(f,g,e,h){if((f/=g/2)<1){return h/2*f*f*f+e}return h/2*((f-=2)*f*f+2)+e},easeInQuart:function(f,g,e,h){return h*(f/=g)*f*f*f+e},easeOutQuart:function(f,g,e,h){return -h*((f=f/g-1)*f*f*f-1)+e},easeInOutQuart:function(f,g,e,h){if((f/=g/2)<1){return h/2*f*f*f*f+e}return -h/2*((f-=2)*f*f*f-2)+e},easeInQuint:function(f,g,e,h){return h*(f/=g)*f*f*f*f+e},easeOutQuint:function(f,g,e,h){return h*((f=f/g-1)*f*f*f*f+1)+e},easeInOutQuint:function(f,g,e,h){if((f/=g/2)<1){return h/2*f*f*f*f*f+e}return h/2*((f-=2)*f*f*f*f+2)+e},easeInSine:function(f,g,e,h){return -h*Math.cos(f/g*(Math.PI/2))+h+e},easeOutSine:function(f,g,e,h){return h*Math.sin(f/g*(Math.PI/2))+e},easeInOutSine:function(f,g,e,h){return -h/2*(Math.cos(Math.PI*f/g)-1)+e},easeInExpo:function(f,g,e,h){return(f==0)?e:h*Math.pow(2,10*(f/g-1))+e},easeOutExpo:function(f,g,e,h){return(f==g)?e+h:h*(-Math.pow(2,-10*f/g)+1)+e},easeInOutExpo:function(f,g,e,h){if(f==0){return e}if(f==g){return e+h}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+e}return h/2*(-Math.pow(2,-10*--f)+2)+e},easeInCirc:function(f,g,e,h){return -h*(Math.sqrt(1-(f/=g)*f)-1)+e},easeOutCirc:function(f,g,e,h){return h*Math.sqrt(1-(f=f/g-1)*f)+e},easeInOutCirc:function(f,g,e,h){if((f/=g/2)<1){return -h/2*(Math.sqrt(1-f*f)-1)+e}return h/2*(Math.sqrt(1-(f-=2)*f)+1)+e},easeInElastic:function(g,j,e,k){var h=1.70158;var i=0;var f=k;if(g==0){return e}if((g/=j)==1){return e+k}if(!i){i=j*0.3}if(f<Math.abs(k)){f=k;var h=i/4}else{var h=i/(2*Math.PI)*Math.asin(k/f)}return -(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e},easeOutElastic:function(g,j,e,k){var h=1.70158;var i=0;var f=k;if(g==0){return e}if((g/=j)==1){return e+k}if(!i){i=j*0.3}if(f<Math.abs(k)){f=k;var h=i/4}else{var h=i/(2*Math.PI)*Math.asin(k/f)}return f*Math.pow(2,-10*g)*Math.sin((g*j-h)*(2*Math.PI)/i)+k+e},easeInOutElastic:function(g,j,e,k){var h=1.70158;var i=0;var f=k;if(g==0){return e}if((g/=j/2)==2){return e+k}if(!i){i=j*(0.3*1.5)}if(f<Math.abs(k)){f=k;var h=i/4}else{var h=i/(2*Math.PI)*Math.asin(k/f)}if(g<1){return -0.5*(f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i))+e}return f*Math.pow(2,-10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)*0.5+k+e},easeInBack:function(f,h,e,i,g){if(g==b){g=1.70158}return i*(f/=h)*f*((g+1)*f-g)+e},easeOutBack:function(f,h,e,i,g){if(g==b){g=1.70158}return i*((f=f/h-1)*f*((g+1)*f+g)+1)+e},easeInOutBack:function(f,h,e,i,g){if(g==b){g=1.70158}if((f/=h/2)<1){return i/2*(f*f*(((g*=(1.525))+1)*f-g))+e}return i/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+e},easeInBounce:function(f,g,e,h){return h-jQuery.easing.easeOutBounce(x,g-f,0,h,g)+e},easeOutBounce:function(f,g,e,h){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+e}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+e}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+e}else{return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+e}}}},easeInOutBounce:function(f,g,e,h){if(f<g/2){return jQuery.easing.easeInBounce(x,f*2,0,h,g)*0.5+e}return jQuery.easing.easeOutBounce(x,f*2-g,0,h,g)*0.5+h*0.5+e}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.TouchHandler!=b){return}a.TouchHandler=function(l,aT,aj,e,aN){var aD=this;var aK=false;var ai=true;var n=false;var aR=false;var aJ=false;var aB,D,i,ab;var aC,X,aH;var g=false;var ac;var p;var aW={};var ap=[];var aa=0;var H=window;var q;var aS;var d;var aV=[];var aP={x:0,y:0};var t={x:0,y:0};var aq=40;var m={};m.enabled=false;m.factor=5;m.fEndDiff=1;var ax={};ax.enabled=false;ax.minFrames=14;ax.factorAmount=23;ax.factorFrames=2.6;ax.offsetFrames=5;var ay;var aG,u,k;var E;var ar={};var W;var aM=false;var y=false;var ak={};ak.name="none";var M;var V;var Y={};if(!aT||typeof(aT)!="object"){aT={}}var am=function(){if(aK){aD.destroy()}aS=z;q=b;if(a.topWindow!=window){q=a.topWindow;try{var a1=a.getWindowOffset(window);if(a1.x!=b&&a1.y!=b){aS=ao}}catch(a0){aS=z;q=b}}else{q=b}E=aT.oPassTrough;if(aT.getPageCoords){p=aE}else{p=L}if(aT.afterTouch){for(var a2 in aT.afterTouch){ax[a2]=aT.afterTouch[a2]}}if(ax.fnStartStopAfterTouch&&typeof(ax.fnStartStopAfterTouch)!="function"){ax.fnStartStopAfterTouch=b}if(ax.fnStartStopAfterTouch){ax.useAnimationFrame=b}if(typeof(ax.modifyTarget)!="function"){ax.modifyTarget=b}if(typeof(ax.fnGetAfterTouchEnabled)=="function"){ay=ax.fnGetAfterTouchEnabled}else{ay=b}if(aT.smoothing){for(var a2 in aT.smoothing){m[a2]=aT.smoothing[a2]}}if(aT.detectClick==true){W=true}if(aT.preventSelection!==false){aT.preventSelection=true}if(!l){return}if(typeof(l.join)!="function"){l=[l]}if(typeof(aj)!="function"){aj=z}if(typeof(e)!="function"){e=z}if(typeof(aN)!="function"){aN=z}if(typeof(aT.onPinchChange)=="function"){M=aT.onPinchChange}else{M=b}aM=aT.detectGestures;aV=[];aw(true,aM);for(var aZ=0;aZ<l.length;aZ++){var aY=l[aZ];if(aY&&typeof(aY.nodeName)!="undefined"){var a2={};a2.element=aY;aV.push(a2);a.addEvent(aY,"mousedown",Q);if(a.isTouch){an(aY,Q);try{if(aY.style!=b){if(a.BrowserSupports.cssTouchAction()){if(ar.cssTouchAction!=b){o(aY,ar.cssTouchAction)}}}}catch(a0){}}}}};var R=this.enable=function(aY){if(ai==aY){return}if(!aY){P();af(false,false)}else{af(ar.captureScrollUser,ar.capturePinchUser)}ai=aY};this.getEnabled=function(){return ai};this.cancel=function(){O();ae();aI();P()};var aI=function(){if(m.enabled){h()}A()};this.cancelAfterTouch=function(){A()};this.getInitialDownEvent=function(){return V};var P=function(){if(!n){return}aI();n=false;V=b;y=false;c();aW={};ap=[];aa=0};this.destroy=function(){aD.cancel();var aY;for(var aZ=0;aZ<aV.length;aZ++){var a0=aV[aZ];aY=a0.element;a.removeEvent(aY,"mousedown",Q);v(aY,Q)}ar={}};var aA=function(aZ){if(!aZ||!aZ.style){return}var aY=aZ.style.touchAction;if(aY==b){aY=aZ.style.msTouchAction}return aY};var o=function(aY,aZ){if(!a.BrowserSupports.cssTouchAction()||!aY||!aY.style){return}aY.style.touchAction=aY.style.msTouchAction=aZ};var al=function(aZ){for(var aY=0;aY<aV.length;aY++){an(aV[aY].element,aZ)}};var F=function(aZ){for(var aY=0;aY<aV.length;aY++){v(aV[aY].element,aZ)}};var an=function(aZ,aY){a.addEvent(aZ,"touchstart",aY);a.addEvent(aZ,"MSPointerDown",aY);a.addEvent(aZ,"pointerdown",aY);a.addEvent(aZ,"MSHoldVisual",a.preventDefaultEvent)};var v=function(aZ,aY){a.removeEvent(aZ,"touchstart",aY);a.removeEvent(aZ,"MSPointerDown",aY);a.removeEvent(aZ,"pointerdown",aY);a.removeEvent(aZ,"MSHoldVisual",a.preventDefaultEvent)};var z=function(){return true};var aO=function(aY){if(aJ){U(aY,aY.pointerId)}else{var aZ=aY.changedTouches;for(var a0=0;a0<aZ.length;a0++){U(aZ[a0],aZ[a0].identifier)}}};var U=function(aY,a0){if(a0==b||aW[a0]!=b){if(aT.debug){if(a0==b){a.console.error("doRegisterPointer: no pointerId")}if(aW[a0]!=b){a.console.error("doRegisterPointer: pointerId already registered: "+a0)}}return}aa++;var aZ=aW[a0]={};aZ.identifier=a0;p(aZ,aY);ap.push(aZ)};var ah=function(aY){var a0=false;if(aJ){a0=J(aY.pointerId)}else{var aZ=aY.changedTouches;if(aZ){for(var a1=0;a1<aZ.length;a1++){a0=J(aZ[a1].identifier)}}}if(a0){ap=new Array(aa);var a3=0;for(var a2 in aW){ap[a3++]=aW[a2]}}};var J=function(aY){if(aY==b||aW[aY]==b){if(aT.debug){if(aY==b){a.console.error("doUnregisterPointer: no pointerId")}if(aW[aY]==b){a.console.error("doUnregisterPointer: pointerId not registered: "+aY)}}return false}delete aW[aY];aa--;return true};var L=function(aZ,aY){aZ.x=aY.clientX;aZ.y=aY.clientY};var aE=function(aZ,aY){aZ.x=aY.pageX;aZ.y=aY.pageY};var r=function(aY){var aZ=aY.changedTouches;if(aZ){for(var a1=0;a1<aZ.length;a1++){var a0=aW[aZ[a1].identifier];if(a0){p(a0,aZ[a1])}}}if(ap.length>0){aP.x=ap[0].x;aP.y=ap[0].y}};var av=function(aY){var aZ=aW[aY.pointerId];if(aZ){p(aZ,aY)}if(ap.length>0){aP.x=ap[0].x;aP.y=ap[0].y;aS(aY,aP)}};var T=function(aY){p(aP,aY);aS(aY,aP)};this.getMousePositionPage=function(aZ){var aY={};aE(aY,aZ);aS(aZ,aY);return aY};this.getMousePositionClient=function(aZ){var aY={};L(aY,aZ);aS(aZ,aY);return aY};var s=function(aY,aZ){if(window!=aY.view){var a0=a.getWindowOffset(window);aZ.x-=a0.x;aZ.y-=a0.y}};var ao=function(aY){try{s(aY);aS=s}catch(aZ){aS=z}};var az=function(aY){if(!ai){return}var a0=aa;if(y&&a0==0){y=false}var a1=aY.type;if(n||ak.started){if(a1!=aB){if(ak.started){O();ae()}else{aY._FSI_Canceled=true;aX(aY,true)}}}aB=a1;d=false;var aZ=true;switch(a1){case"touchstart":aR=true;aJ=false;ac=r;i="touchmove";D="touchend";ab="touchcancel";aG=false;break;case"MSPointerDown":ac=av;aR=true;aJ=true;i="MSPointerDown";D="MSPointerUp";ab="MSPointerCancel";aG=false;d=true;break;case"pointerdown":ac=av;aR=true;aJ=true;i="pointermove";D="pointerup";ab="pointercancel";aG=true;d=true;break;default:aR=false;aJ=false;if(aT.preventSelection){aG=true}else{aG=false}aZ=false;ac=T;i="mousemove";D="mouseup";ab=b;d=true}if(aR&&aZ){aO(aY)}ac(aY);if(aG&&aY.preventDefault){aY.preventDefault()}if(aa>1){Y.bClick=false}u=false;if(aZ&&ag(aY)){if(a0==0){A();C()}return false}return true};var Q=function(aY){if(!az(aY)){return}if(n||aY.which>1){return}f(aY)};this.getCurrentPos=function(){return t};var f=function(aY){aI();if(n){return}ax.evtMove=b;if(m.enabled){t={x:aP.x,y:aP.y}}else{t=aP}Y.x=aP.x;Y.y=aP.y;var aZ=V;V=aY;if(!aj.call(H,aY,t,E)){V=aZ;return false}n=true;if(W&&!y){Y.bClick=true;Y.clickRadiusX=Y.clickRadiusY=0}else{Y.bClick=false}C();if(ax.enabled){ax.x=ax.y=0;ax.lastX=aP.x;ax.lastY=aP.y;if(ax.nInterval){clearInterval(ax.nInterval)}ax.nInterval=setInterval(Z,30)}return true};var c=function(){if(g&&X!=b){g=false;a.removeEvent(window,X,ad);a.removeEvent(window,aC,aX);if(d&&q){try{a.removeEvent(q,X,ad);a.removeEvent(q,aC,aX)}catch(aY){}}if(aH!=b){a.removeEvent(window,aH,at)}X=aC=aH=b}};var C=function(){if(g){c()}g=true;X=i;aC=D;aH=ab;a.addEvent(window,X,ad);a.addEvent(window,aC,aX);if(d&&q){try{a.addEvent(q,X,ad);a.addEvent(q,aC,aX)}catch(aY){}}if(ab!=b){a.addEvent(window,aH,at)}};var ad=function(aY){ac(aY);aY.FSI_start_x=Y.x;aY.FSI_start_y=Y.y;if(ax.enabled&&ax.evtMove==b){ax.evtMove=aY}if(n){if(Y.bClick){Y.clickRadiusX=Math.max(Y.clickRadiusX,Math.abs(aP.x-Y.x));if(Y.clickRadiusX>10){Y.bClick=false}else{Y.clickRadiusY=Math.max(Y.clickRadiusY,Math.abs(aP.y-Y.y));if(Y.clickRadiusY>10){Y.bClick=false}}}if(m.enabled){m.evt=aY;aU()}else{e.call(H,aY,t,E)}}else{if(ak.started){if(ak.nType==1){au(aY)}}}if(u&&!aY.FSI_allowEventDefault){aY.preventDefault()}};var au=function(aY){var aZ=j();if(!M){return}aY._FSI_PinchDeltaStart=ak.nPinchDistance-ak.pinchDistanceStart;aY._FSI_PinchDeltaRelative=ak.nPinchDistance-ak.pinchDistanceLast;aY._FSI_PinchScale=Math.max(aq,ak.pinchDistanceLast)/ak.pinchDistanceStartMaxed;ak.pinchDistanceLast=ak.nPinchDistance;aY._FSI_PinchDistance=aZ;M.call(H,aY,aP,E)};var at=function(aY){if(aR){ah(aY);if(aa<1){if(n){aY._FSI_Canceled=true;aX(aY,true);return}else{P();return}}}ac(aY);ag(aY)};var aX=function(aY,aZ){if(aZ){aY._FSI_Canceled=true}if(aR){ah(aY)}ac(aY);if(!aZ&&ag(aY)){return}aI();if(!aZ){if(!n||aa>0){return}}aY.FSI_start_x=Y.x;aY.FSI_start_y=Y.y;var a0=false;if(!aZ&&ax.enabled){if(ay==b||ay()){a0=S(aY)}}if(a0){P();w(aY)}else{if(W){aY._FSI_Click=Y.bClick}aN.call(H,aY,t,E);P()}if(aY.preventDefault){aY.preventDefault()}};var aL=function(aY){return aa};var G=function(aY){return ap};var aU=function(){if(m.animationFrame!=b){return}aQ()};var h=function(){if(m.animationFrame==b){return}cancelAnimationFrame(m.animationFrame);m.animationFrame=b};var aQ=function(){var aY=Math.abs(t.x-aP.x)+Math.abs(t.y-aP.y);if(aY>m.fEndDiff){t.x+=(aP.x-t.x)/m.factor;t.y+=(aP.y-t.y)/m.factor;m.animationFrame=requestAnimationFrame(aQ)}else{t.x=aP.x;t.y=aP.y;m.animationFrame=b}e.call(H,m.evt,t,E)};var S=function(aY){if(!ax.enabled){return false}if(ax.running){A()}ax.pos=0;var a0=ax.factorAmount;ax.startX=t.x;ax.startY=t.y;var aZ={};aZ.x=ax.startX+a0*ax.x;aZ.y=ax.startY+a0*ax.y;if(ax.roundTargetPos){aZ.x=Math.round(aZ.x);aZ.y=Math.round(aZ.y)}if(ax.modifyTarget){aZ=ax.modifyTarget.call(H,aZ,E)}ax.amountX=aZ.x-ax.startX;ax.amountY=aZ.y-ax.startY;a0=ax.factorFrames/100;ax.frames=ax.offsetFrames+Math.round(a0*Math.abs(ax.amountX)+a0*Math.abs(ax.amountY));if(ax.frames<ax.minFrames){return false}return true};this.isAfterTouchRunning=function(){return ax.running};var w=function(aY){if(typeof(aT.onAfterTouchStart)=="function"){aT.onAfterTouchStart.call(H,aY,t,E)}ax.running=true;ax.evtUp=aY;if(ax.fnStartStopAfterTouch){ax.fnStartStopAfterTouch.call(H,true,ax.evtMove,E)}else{if(ax.useAnimationFrame){ax.animationFrameRun=requestAnimationFrame(I)}else{ax.intervalRun=setInterval(I,16)}}return true};var aF=function(aZ,aY,a1,a0){return a1*((aZ=aZ/a0-1)*aZ*aZ+1)+aY};var I=this.runAfterTouch=function(){var aY=false;ax.pos++;t.x=aF(ax.pos,ax.startX,ax.amountX,ax.frames);t.y=aF(ax.pos,ax.startY,ax.amountY,ax.frames);e.call(H,ax.evtMove,t,E);if(ax.pos==ax.frames){A(true)}else{if(ax.useAnimationFrame){ax.animationFrameRun=requestAnimationFrame(I)}aY=true}return aY};this.enableAfterTouch=function(aY){if(ax.enabled==aY){return}if(!aY){A()}ax.enabled=aY};var A=function(aY){if(!ax.running){return}if(ax.fnStartStopAfterTouch){ax.fnStartStopAfterTouch.call(H,false,ax.evtMove,E)}else{if(ax.useAnimationFrame){if(ax.animationFrameRun){cancelAnimationFrame(ax.animationFrameRun)}}else{if(ax.intervalRun){clearInterval(ax.intervalRun);ax.intervalRun=b}}}if(typeof(ax.onAfterTouchEnd)=="function"){ax.onAfterTouchEnd.call(H,ax.evtMove,E)}ax.evtMove=b;ax.running=false;ax.evtUp._FSI_Canceled=(aY!==true);ax.evtUp._FSI_fromAfterTouch=true;aN.call(H,ax.evtUp,t,E)};var Z=function(){ax.x=(2*ax.x+aP.x-ax.lastX)/5;ax.y=(2*ax.y+aP.y-ax.lastY)/5;ax.lastX=aP.x;ax.lastY=aP.y};var aw=this.setCapture=function(aY,a0){var aZ=af(aY,a0);if(aZ){ar.captureScrollUser=aY;ar.capturePinchUser=a0}return aZ};var af=function(aY,a0){var aZ=0;if(aY){aZ+=2}if(a0){aZ+=4}if(aZ==ar.nCheck){return}ar.nCheck=aZ;ar.captureScroll=aY;ar.capturePinch=a0;if(a.BrowserSupports.cssTouchAction()){N(aY,a0)}return true};var N=function(aY,a2){var a1;switch(ar.nCheck){case 0:a1="auto";break;case 2:a1="pinch-zoom double-tap-zoom ";break;case 4:a1="pan-x pan-y double-tap-zoom";break;default:a1="double-tap-zoom"}ar.cssTouchAction=a1;for(var a0=0;a0<l.length;a0++){var aZ=l[a0];o(aZ,ar.cssTouchAction)}};var j=function(){if(ap.length<1){return 0}var aZ=Math.abs(ap[1].x-ap[0].x);var aY=Math.abs(ap[1].y-ap[0].y);var a0=ak.nPinchDistance=Math.sqrt(aZ*aZ+aY*aY);return a0};var ag=function(aY){u=false;if(!ai){return}var aZ=ap.length;if(!aM){u=(aZ==1&&ar.captureScroll);return}if(ak.pointerCount!=aZ){O(aY);if(aZ>1){ae();ak.nPointers=aZ;switch(aZ){case 2:ak.started=true;ak.name="pinch";ak.nType=1;if(typeof(aT.onPinchStart)=="function"){K(aY);ak.nPinchDistance=0;ak.nPinchDistance=j();ak.pinchDistanceStart=ak.pinchDistanceLast=ak.nPinchDistance;ak.pinchDistanceStartMaxed=Math.max(aq,ak.pinchDistanceStart);aY._FSI_PinchDistance=ak.nPinchDistance;aT.onPinchStart.call(H,aY,aP,E)}break;default:ak.started=true;ak.name="unknown";ak.nType=-1}if(ak.started){y=true;if(n){aI();n=false;aY._FSI_Canceled=true;aN.call(H,aY,t,E)}if(typeof(aT.onGestureStart)=="function"){K(aY);aT.onGestureStart.call(H,aY,aP,E)}}}else{if(aZ<1){ae()}}ak.pointerCount=aZ;u=false;if(aZ==1){if(ar.captureScroll){u=true}}else{if(ar.capturePinch&&ak.nType==1){u=true}}}return ak.started};var ae=function(){if(!ak.timeoutRestartDown){return}clearTimeout(ak.timeoutRestartDown);ak.timeoutRestartDown=b};var B=function(){if(aa!=1){return}f(V);ae()};var K=function(aY){aY._FSI_Gesture=ak.name;aY._FSI_GestureType=ak.nType;aY._FSI_PointerCount=ak.nPointers};var O=function(aY){if(!ak.started){return}ak.started=false;if(!aY){aY={}}if(ak.nType==1&&typeof(aT.onPinchEnd)=="function"){K(aY);aY._FSI_PinchDistance=ak.nPinchDistance;aT.onPinchEnd.call(H,aY,aP,E)}if(typeof(aT.onGestureEnd)=="function"){K(aY);aT.onGestureEnd.call(H,aY,aP,E)}ak.name="none";ak.nType=0;if(aY&&aa==1){ae();ak.timeoutRestartDown=setTimeout(B,20)}};am()}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.LoaderCSSSkin!=b){return}a.LoaderCSSSkin=function(){var k=this;var d=0;var f={};var e=0;var g=new a.CORSLoader();var c=function(m){var l=false;try{if(m.cssRules!=b){l=m.cssRules}else{l=m.rules}}catch(n){console.error(n.message)}return l};var h=function(n,q,p,r){var m=this;var l;this.uniqueID=e++;this.bReleased=false;this.getSkinName=function(){return q.getSkinName()};this.callReadyDelayed=function(s,t,u){l=setTimeout(function(){m.callReady(s,t,u)},1)};this.callReady=function(s,t,u){o();if(this.bReleased){return}p.call(r,s,t,u)};var o=function(){if(l!=b){clearTimeout(l);l=b}};this.remove=function(){o();if(m.bReleased){return}q.removeWaiter(m.uniqueID);this.bReleased=true}};var j=function(l,n){var m=this;this.sheet=n;this.skinName=l;var o;var p=function(){o=m.rulesReg={};var s=c(n);if(typeof(s)!="object"||s.length<1){return}for(var q=0;q<s.length;q++){var r=s[q];if(typeof(r.selectorText)=="string"){o[r.selectorText]=r.style}}};this.getStyle=function(q,t,s){if(o==b){p()}var r=b;if(o[q]!=b){r=o[q][t];if(t=="content"){r=r.replace(/^["']/,"");r=r.replace(/["']$/,"");r=a.trim(r);r=r.replace(/\\"/g,'"')}if(s){r=r.replace(/^[^{]*/g,"");r=r.replace(/[^}]*$/g,"");if(r.length>0){try{r=a.JSON.parse(r)}catch(u){a.console.error("ERROR parsing JSON from CSS selector '"+q+"' property '"+t+"'.");a.console.error(u.message)}}else{r={}}}}if(s&&r==b){r={}}return r}};var i=function(l){var v=false;var m=0;var y={};var s=false;var t=false;var u;var q;var o;var r;o=l.match(/(.*)\/[^/]*$/);o=o[1]+"/";q=l.replace(/\.[^/]*$/,"");q=q.match(/([^/]*)$/);q=q[1].toLowerCase();var n=new j(l);this.removeWaiter=function(z){if(y[z]==b){return}delete y[z];m--};this.addWaiter=function(z){if(z.uniqueID==b){return}if(s){z.callReadyDelayed(t,n,"ALREADY LOADED")}else{if(y[z.uniqueID]==b){y[z.uniqueID]=z;m++;if(!v){w()}}}};this.getSkinName=function(){return q};var p=function(G,B,H,C){var F=false;if(C>299||typeof(B)!="string"){a.console.error("Failed to load Skin CSS (HTTP "+C+"): "+l)}else{F=true;B=B.replace(/\/\*.*\*\//g,"");B=B.replace(/([:|,])\s*url\s*\(\s*['"]*\s*([^)'"]*)[^)]*\)/gi,function(J,L,M){var K=J;if(!M.match(/:\/\//)){K=L+'url("'+o+M+'")'}return K});u=document.createElement("style");u.setAttribute("type","text/css");u.setAttribute("x_generated_by","FSI");u.setAttribute("x_fsi_skin",q);u.appendChild(document.createTextNode(B));var E=document.head;if(!E){E=document.getElementsByTagName("head");if(E&&E.length>0){E=E[0]}}if(E&&E.firstChild){try{var A=E.firstChild;var I=E.getElementsByTagName("style");if(I.length>0){A=I[0]}E.insertBefore(u,A)}catch(D){E.appendChild(u)}}else{E.appendChild(u)}n=new j(q,u.sheet);s=true;t=F}for(var z in y){y[z].callReady(F,n,"onLoaded")}y={};m=0};var w=function(){v=true;if(typeof(l)!="string"||l.length<0){return false}g.load(l,p,"text/css");return true}};this.load=function(l,o,n){var q=false;if(a.versionInternetExplorer<9){q=true}if(q){a.console.error("Unable to load skin: unsupported browser version.");if(n){n.call(o,false)}return false}if(a._FSIViewerLocation==b||typeof(l)!="string"||l.length<1){a.console.error("Unable to load skin:");if(a._FSIViewerLocation==b){a.console.error("FSI Viewer path not known")}else{a.console.error("Invalid skin URL "+l)}if(n){n.call(o,false)}return false}var m=l;if(m.indexOf("http")!=0){m=a._FSIViewerLocation+"/skins/"+m}if(!m.match(/\.css$/)){m+=".css"}var p;if(f[m]==b){d++;p=f[m]=new i(m)}else{p=f[m]}var r=new h(m,p,n,o);p.addWaiter(r);return r}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.LoaderJavascript!=b){return}a.LoaderJavascript=function(){var e={};this.load=function(h,l,n,j,m){var k=e[h];if(n==b){n=window}if(typeof(j)!="function"){return false}if(k==b){k=e[h]={};k.path=h;k.loaded=false;k.failed=false;f(k);if(!g(k)){k.failed=true;k.loaded=true;k.addNodeFailed=true}}else{if(k.oListeners[l]!=b){d(h,l)}}k.nListeners++;var i=k.oListeners[l]={};i.argScope=n;i.argFunction=j;i.oPassThrough=m;if(k.loaded==true){c(k)}return true};var d=this.release=function(h,j){var i=e[h];if(i==b){return}if(i.oListeners[j]!=b){delete i.oListeners[j];i.nListeners--}};var g=function(m){var i=false;try{var j=document.getElementsByTagName("head");if(j&&j.length>0){j=j[0];var k=m.node=document.createElement("script");var l=m.onLoad=function(o){if(o.type=="error"){m.failed=true;c(m)}else{m.failed=false;c(m)}m.loaded=true};a.addEvent(k,"load",l);var h=m.onError=function(o){m.failed=true;c(m);m.loaded=true};a.addEvent(k,"error",l);j.appendChild(k);k.src=m.path;i=true}}catch(n){}return i};var c=function(j){var h=!j.failed;a.removeEvent(j.node,j.onLoad);a.removeEvent(j.node,j.onError);for(var k in j.oListeners){var i=j.oListeners[k];i.argFunction.call(i.argScope,h,j.path,i.oPassThrough)}f(j)};var f=function(h){h.oListeners={};h.nListeners=0}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.AboutWindow!=b){return}a.AboutWindow=function(d,l){var n=this;var e;var g;var h;var f;var i;var j;var m=function(){e=document.createElement("div");a.setStyleAttr(e,"position: absolute;z-index:1000;width:12em;");e.className="fsi-ui-info-window";h=document.createElement("div");h.className="fsi-ui-title";f=document.createElement("div");f.style.display="inline-block";f.innerHTML=l.title;h.appendChild(f);j=document.createElement("div");j.style.display="inline-block";j.style["float"]="right";j.style.cursor="pointer";j.innerHTML="X";h.appendChild(j);e.appendChild(h);g=document.createElement("div");g.className="fsi-ui-content";var p=l.strLongVersion;p="<h3>"+p.replace(/ build/,'</h3><span class="small">build')+"</span>";var o;if(l.strCopyright==b){o="<br/><br/>&copy; 2016 NeptuneLabs GmbH<br/>";o+='<hr/><a style="color:inherit;text-decoration:none" href="//www.neptunelabs.com" target="_blank">www.neptunelabs.com</a><br/><br/><span class="small">FSI Viewer &reg; is a registered trademark of NeptuneLabs GmbH, Germany<br/></span>'}else{l.strCopy=l.strCopyright}p+="<br/>"+o;g.innerHTML=p;e.appendChild(g);d.appendChild(e);a.addEvent(e,"click",k);c()};var c=function(){var p=a.getElementPosition(d);p.width=(p.right-p.left);p.height=(p.bottom-p.top);var o=a.getElementPosition(e);o.width=(o.right-o.left);o.height=(o.bottom-o.top);e.style.left=Math.round(0*p.left+(p.width-o.width)/2)+"px";e.style.top=Math.round(0*p.left+(p.height-o.height)/2)+"px"};var k=this.destroy=function(){if(typeof(l.fnOnDestroy)=="function"){if(!l.fnOnDestroy.call(this)){return}}a.removeEvent(e,"click",k);a.removeChild(e.parentNode,e)};m()}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CustomEventListener!=b){return}a.CustomEventListener=function(k){var m=this;var d=[];var g={};var h={};var i=0;m._strClassName="$FSI.CustomEventListener";var l=function(){if(a.eventFunctionID==b){a.eventFunctionID=0}if(a.eventElementID==b){a.eventElementID=0}};var j=this.destroy=function(){for(var n=0;n<d.length;n++){var o=d[n];f(o.element,o.fn)}d=[];g={};h={};m.onDestroy()};this.fireEvent=function(n,o){if(!n||!n.enabled){return false}if(typeof(o)!="object"){o={}}if(n.paused){o.FSI_paused=true}o.FSI_custom_event=true;o.FSI_type=k;o.FSI_target=n.element;n.fn.call(n.element,o);return true};this.fireEvents=function(o){if(typeof(o)!="object"){o={}}o.FSI_custom_event=true;o.FSI_type=k;for(var p=0;p<d.length;p++){var n=d[p];if(n.enabled){if(n.paused){o.FSI_paused=true}else{if(o.FSI_paused){delete o.FSI_paused}}o.FSI_target=n.element;n.fn.call(n.element,o)}}};var c=this.addListener=function(r,q){if(typeof(r)!="object"||typeof(q)!="function"){a.console.error(m._strClassName+": Invalid parameters for addListener");return}if(r.__FSI==b){r.__FSI={}}if(r.__FSI.eventElementID==b){r.__FSI.eventElementListenerCount=1;r.__FSI.eventElementID=a.eventElementID++}else{r.__FSI.eventElementListenerCount++}if(q.__FSIEventFunctionID==b){q.__FSIEventFunctionListenerCount=1;q.__FSIEventFunctionID=a.eventFunctionID++}else{q.__FSIEventFunctionListenerCount++}var o=r.__FSI.eventElementID;var p=q.__FSIEventFunctionID;if(g[o]==b){var n=g[o]={};n.nFunction=0;n.oFunctions={}}if(g[o].oFunctions[p]==b){g[o].nFunction++;g[o].oFunctions[p]=[]}else{a.console.warn(m._strClassName+": There is already a listener for this exact element and function");a.console.log(r);a.console.log(q)}var s={};s.element=r;s.elementID=o;s.fn=q;s.fnID=p;s.instanceListener=m;s.enabled=true;s.paused=false;s.uniqueID=i++;g[o].oFunctions[p].push(s);d.push(s);h[s.uniqueID]=s;m._onListenerAdd(s);m._onListenerCountChange(d.length);return s};this.setListenerProps=function(q,o,p){var n=h[q];if(!n){return false}if(n.props==b){n.props={}}n.props[o]=p;return true};this.enableListener=function(p,o){var n=h[p];if(n==b||n.enabled==o){return}n.enabled=o};this.pauseListener=function(p,o){var n=h[p];if(n==b||n.paused==o){return}n.paused=o};var f=this.removeListener=function(r,q){if(typeof(r)!="object"||typeof(q)!="function"){a.console.error(m._strClassName+": Invalid parameters for removeListener");return}if(r.__FSI==b||r.__FSI.eventElementID==b||q.__FSIEventFunctionID==b){if(q.__FSIEventFunctionID==b){a.console.error(m._strClassName+": Function not registered for listener in removeListener")}else{a.console.error(m._strClassName+": Element not registered for listener in removeListener")}return}var n=r.__FSI.eventElementID;var p=q.__FSIEventFunctionID;if(!g[n]){a.console.error(m._strClassName+": No registered listener for this element in removeListener");return}var o=g[n].oFunctions[p];if(o==b||typeof(o.pop)!="function"){a.console.error(m._strClassName+": No registered listener for this function in removeListener");return}var s=o.pop();s.fn.__FSIEventFunctionListenerCount--;s.element.__FSI.eventElementListenerCount--;if(s.element.__FSI.eventElementListenerCount==0){delete s.element.__FSI.eventElementListenerCount;delete s.element.__FSI.eventElementID}if(s.fn.__FSIEventFunctionListenerCount==0){delete s.fn.__FSIEventFunctionListenerCount;delete s.fn.__FSIEventFunctionID}if(o.length==0){delete g[n].oFunctions[p];g[n].nFunction--;if(g[n].nFunction==0){delete g[n]}}delete h[s.uniqueID];e();m._onListenerRemove(s);m._onListenerCountChange(d.length);return s};this.getEventListenerByID=function(n){return h[n]};this.getListenerObjectByID=function(n){return h[n]};this.getListenersArray=function(){return d};this.getListenerCount=function(){return d.length};var e=function(){d=[];for(var o in g){var q=g[o].oFunctions;for(var p in q){var n=q[p];d=d.concat(n)}}};this.dump=function(){a.console.dir(g);a.console.dir(d)};this._onListenerCountChange=function(n){};this._onListenerAdd=function(o,n){};this._onListenerRemove=function(o,n){};this.triggerEvent=function(n){};this.triggerEvents=function(){};this.setListenerProps=function(p,n,o){};this.onDestroy=function(){};l()}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CustomEventListenerDocumentZoom!=b){return}a.CustomEventListenerDocumentZoom=a.oCustomEventListenerClasses.FSIDocumentZoomChange=function(){var p=this;var c=false;var g;var h;var o=0;var l=0;var f=false;var e;var n;a.CustomEventListener.prototype.constructor.call(p,"FSIDocumentZoomChange");p._strClassName="$FSI.CustomEventListenerDocumentZoom";var j=function(){if(c){return}c=true;g=a.getDocumentScaleWithPixelRatio();if(a.BrowserSupports.visualViewportAPI()){n=m;a.addEvent(document,"visualviewportchanged",n);h=setInterval(n,250)}else{n=d;e=0;h=setInterval(n,50)}a.addEvent(window,"orientationchange",n)};var i=function(){if(!c){return}c=false;if(a.BrowserSupports.visualViewportAPI()){a.removeEvent(document,"visualviewportchanged",n)}a.removeEvent(window,"orientationchange",n);clearInterval(h);h=b};this.onDestroy=function(){i()};this._onListenerCountChange=function(q){var r=(q>0);if(r!=c){if(r){j()}else{i()}}};var m=function(){var q;var r=a.getDocumentScaleWithPixelRatio();if(g!=r){g=r;k(r);q=true}else{q=false}return q};var d=function(){var q;var r=a.getDocumentScaleWithPixelRatio();if(g!=r){if(f==false){e=0;clearInterval(h);h=setInterval(n,50)}l=0;g=r;k(r);q=true}else{q=false;if(e<3){l++;if(l==20){e=1;clearInterval(h);h=setInterval(n,150)}else{if(l==40){e=2;clearInterval(h);h=setInterval(n,300)}else{if(l==50){e=3;clearInterval(h);h=setInterval(n,600)}}}}}return q};this.triggerEvent=function(s){var q=p.getEventListenerByID(s);if(!q){return}var r={};r.FSI_scale=a.getDocumentScale();r.FSI_scale_with_pixel_ratio=a.getDocumentScaleWithPixelRatio();p.fireEvent(q,r)};this.triggerEvents=function(){k(a.getDocumentScaleWithPixelRatio())};var k=function(r){var q={};q.FSI_scale=a.getDocumentScale();q.FSI_scale_with_pixel_ratio=r;p.fireEvents(q)}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CustomEventListenerViewport!=b){return}a.CustomEventListenerViewport=a.oCustomEventListenerClasses.FSIViewport=function(){var m=this;var d=false;var i=new a.Rect(0,0,0,0);var j=new a.Rect(0,0,0,0);var n=new a.Rect(0,0,0,0);var J=new a.Rect(0,0,0,0);var v={left:0,top:0};var U;var D;var E="";var g=false;var q=b;var A;var k=1;var p=1;var s=10;var H;var u=0;var w;var G;var T=0;var c=100;var p=1;var B=1;var P=32;var z;var r;var I=a.BrowserSupports.visualViewportAPI();try{r=window.frameElement}catch(R){}a.CustomEventListener.prototype.constructor.call(m,"FSIViewport");m._strClassName="$FSI.CustomEventListenerViewport";this.onDestroy=function(){o()};var O=function(){if(d){return}d=true;h(a.addEvent);H=a.addCustomEvent(m,"FSIDocumentZoomChange",K);p=a.getDocumentScale();B=p*a.getDevicePixelRatio()};var o=function(){if(!d){return}d=false;h(a.removeEvent);a.removeCustomEvent(m,"FSIDocumentZoomChange",K);H=b;if(q){clearInterval(q);q=b}t();u=0;if(z!=b){clearTimeout(z);z=b}};var h=function(V){var e=window;V(e.document,"scroll",l,false);V(e,"resize",l,false);if(I){V(e.document,"visualviewportchanged",l,false)}else{if(a.isTouch&&!a.isIETouch&&r){V(e,"touchmove",S,false)}}while(e.frameElement){e=e.parent.window;if(e){V(e.document,"scroll",l,false);if(I){V(e.document,"visualviewportchanged",l,false)}else{if(a.isTouch&&!a.isIETouch&&e.frameElement){V(e,"touchmove",S,false)}}V(e,"resize",l,false)}}V(window,"orientationchange",l,false)};this.setListenerProps=function(X,V,W){if(typeof(V)!="string"){return false}var e=m.getListenerObjectByID(X);if(!e){return false}switch(V){case"treshold":if(e.tresholdEnd!=b){u--;e.tresholdEnd=b}if(W&&W>0){u++;e.tresholdEnd=W}break;case"fireTresholdEventOnly":e.fireTresholdEventOnly=W;break}};this._onListenerRemove=function(e){if(e.tresholdEnd!=b){u--}};this._onListenerCountChange=function(e){var V=(e>0);if(V!=d){if(V){O()}else{o()}}};var K=function(e){p=e.FSI_scale;B=e.FSI_scale_with_pixel_ratio;l()};var l=function(){if(z!=b){return}z=setTimeout(M,P);M()};var M=function(){if(z!=b){clearTimeout(z);z=b}var e=false;var V=N();if(E!=V){E=V;e=true;f()}return e};var L=function(){p=a.getDocumentScale();B=p*a.getDevicePixelRatio();N()};this.triggerEvent=function(W){var e=m.getEventListenerByID(W);if(!e){return}L();var V=Q();m.fireEvent(e,V)};this.triggerEvents=function(){L();f()};var f=this.fireEvents=function(){var V=Q();var W=m.getListenersArray();for(var X=0;X<W.length;X++){var e=W[X];if(!e.fireTresholdEventOnly){m.fireEvent(e,V)}}C()};var Q=function(){var e={};e.FSI_scale=a.getDocumentScale();e.FSI_scale_with_pixel_ratio=e.FSI_scale*a.getDevicePixelRatio();e.FSI_viewport_rect=j;e.FSI_scroll=v;e.FSI_client_rect_body_top=U;e.FSI_viewport_size_top=D;return e};var N=function(){D=a.getViewportSize(a.topWindow);U=a.getBoundingClientRect(a.topWindow.document.documentElement);i.left=a.topWindow.pageXOffset;i.top=a.topWindow.pageYOffset;i.right=i.left+D.width;i.bottom=i.top+D.height;if(r){var e=a.getViewportSize(window);var V=a.getWindowOffset(window);j.left=0;j.top=0;j.right=j.left+e.width;j.bottom=j.top+e.height;v.left=-window.pageXOffset;v.top=-window.pageYOffset;n.copyRect(j);n.left=-V.x+i.left+U.left;n.top=-V.y+i.top+U.top;n.right=n.left+D.width;n.bottom=n.top+D.height;j.interSectRectValidate(n);var W=a.getBoundingClientRect(window.document.body);J.copyRect(j);J.offsetRect(V.x+W.top,V.y+W.left)}else{v.left=U.left;v.top=U.top;J.copyRect(i);j.copyRect(i);j.offsetRect(U.left,U.top)}return p+"_"+J.toString()+" "+D.width+" x "+D.height};var S=function(){A=s;if(q!=b){return}q=setInterval(y,100)};var y=function(){if(!M()){A--}else{A=s}if(A<1){clearInterval(q);q=b}};var t=function(){if(G!=b){clearInterval(G);G=b;w=b}};var C=function(){t();if(u>0){G=setInterval(F,c)}};var F=function(){T+=c;if(w==b){T=c;w=[];var W=m.getListenersArray();for(var X=0;X<W.length;X++){var e=W[X];if(e.tresholdEnd>0){w.push(e)}}}var V;for(var X=w.length-1;X>-1;X--){var e=w[X];if(e.tresholdEnd<=T){if(m.getEventListenerByID(e.uniqueID)!=b){if(V==b){V=Q();V.FSI_after_treshold=true}m.fireEvent(e,V)}w.splice(X,1)}}if(w.length==0){t()}}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CustomEventListenerElementDimension!=b){return}a.CustomEventListenerElementDimension=a.oCustomEventListenerClasses.FSIElementDimension=function(){var m=this;var c=false;var i=25;var f;var d=0;var g={};g[0]=25;g[25]=50;g[50]=100;g[75]=250;var j=76;var e=-1;a.CustomEventListener.prototype.constructor.call(m,"FSIElementDimension");m._strClassName="$FSI.CustomEventListenerElementDimension";this._onListenerCountChange=function(n){if(n<1){clearInterval(f);f=b}else{if(f==b){f=setInterval(l,g[0])}}};this._onListenerAdd=function(n){n.__elementWidth=n.element.offsetWidth;n.__elementHeight=n.element.offsetHeight};this.setListenerProps=function(q,o,p){if(typeof(o)!="string"){return false}var n=m.getListenerObjectByID(q);if(!n){return false}switch(o){case"treshold":if(p&&p>0){n.tresholdEnd=p}break;case"fireTresholdEventOnly":n.fireTresholdEventOnly=p;break}};var l=function(){var o=m.getListenersArray();var r=false;for(var q=0;q<o.length;q++){var n=o[q];if(n.__elementWidth!=n.element.offsetWidth||n.__elementHeight!=n.element.offsetHeight){r=true;if(n.tresholdEnd){n.treshold=i}k(n,false)}else{if(n.treshold>0){n.treshold+=i;if(n.treshold>=n.tresholdEnd){k(n,true);n.treshold=0}}}}if(r){d=0;h(g[0])}else{if(d<j){d++;var p=g[d];if(p!=b){h(p)}}}};var h=function(o){if(o==i||f==b){return}i=o;clearInterval(f);f=setInterval(l,i)};var k=function(n,p){var o={};if(p){o.FSI_after_treshold=n.treshold}o.FSI_target=n.element;o.FSI_dimension_old={width:n.__elementWidth,height:n.__elementHeight};n.__elementWidth=n.element.offsetWidth;n.__elementHeight=n.element.offsetHeight;o.FSI_dimension={width:n.__elementWidth,height:n.__elementHeight};if(p||!n.fireTresholdEventOnly){m.fireEvent(n,o)}};this.triggerEvent=function(o){var n=m.getEventListenerByID(o);if(!n){return}if(n.tresholdEnd){n.treshold=1}k(n)};this.triggerEvents=function(){var n=m.getListenersArray();for(var o=0;o<n.length;o++){if(n[o].tresholdEnd){n[o].treshold=1}k(n[o])}}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.CustomEventListenerMouseWheel!=b){return}a.CustomEventListenerMouseWheel=a.oCustomEventListenerClasses.FSIMouseWheel=function(){var c=this;var f=false;var e=100000;a.CustomEventListener.prototype.constructor.call(c,"FSIMouseWheel");c._strClassName="$FSI.CustomEventListenerMouseWheel";this._onListenerAdd=function(g){g.callback=function(h){d(g,h)};a.addEvent(g.element,"mousewheel",g.callback);a.addEvent(g.element,"DOMMouseScroll",g.callback)};this._onListenerRemove=function(g){a.removeEvent(g.element,"mousewheel",g.callback);a.removeEvent(g.element,"DOMMouseScroll",g.callback)};var d=function(g,h){var i=0;if(h.detail){i=h.detail}else{if(h.wheelDelta){i=-h.wheelDelta}}if(i!=0){e=Math.min(e,Math.abs(i))}h.FSI_delta=-i;h.FSI_weighted_delta=h.FSI_delta/e;c.fireEvent(g,h)}}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.NavigatorWindow!=b){return}a.NavigatorWindow=function(o,B,v,E){var j=this;var ag=o.iViewer;var t;var y;var q={};var ab=0;var m;var n,C;var g;var F,p;var h,e;var R,Q;var u=false;var w=false;var s=o.getRootContainer();var L=o.getElementSpace();var M=o.getinPlaceZoom();var f=ag.getImageIsTransparent();var U=o.getDrawRatio();var r=ag.getSrcDim();var ae=o.getdrawRatioUnZoomed();var G=o.getdrawRatioUnResized();var W=o.viewport;var I;var V;var c={x:2,y:2};var d;var af;var N=false;var Y;var P;var ad={};var H;var A;var J;var aa=function(){u=B.result.autoHideNav;m=[];ab=4;g=16;var ak=l(B.result.navWidth,W.width,120);var ar=l(B.result.navHeight,W.height,120);var ao=Math.min(L.width-2*ab,ak);var ap=Math.min(L.height-2*ab-20,ar);ao=Math.max(60,ao);ap=Math.max(40,ap);var an,ai;an=ao;ai=an/ae.imageWidth*ae.imageHeight;if(ai>ap){ai=ap;an=ai/ae.imageHeight*ae.imageWidth}n=Math.max(10,Math.round(an));C=Math.max(10,Math.round(ai));var aq=n+2*ab;var am=C+2*ab+g;F=aq;p=am;j.sprite=new a.Sprite(s,aq,am,500);a.addClass(j.sprite.element,"fsi-ui-nav-window");j.sprite.element.style.width=j.sprite.element.style.height="auto";if(v){d=v.navFrameBorderColor;af=v.navFrameBackgroundColor}else{d="red";af="rgba(255,255,255,0.5)"}var al=j.sprite.getClientDim();j.canvasSprite=new a.Sprite(j.sprite.element,n,C,2,true,"inline");j.canvasSprite.element.style.clear="both";a.addClass(j.canvasSprite.element,"fsi-ui-nav-window-image");if(B.hasPlugin("zoommeter")){I=document.createElement("div");a.addClass(I,"fsi-ui-nav-window-zoom-text");j.sprite.element.appendChild(I);V=document.createTextNode("100 %");I.appendChild(V);var aj=B.getPluginParameter("zoommeter","color");if(aj){I.style.color="#"+aj}N=B.getPluginParameter("zoommeter","srcrelative",false,true)}j.sprite.updateMargins();j.sprite.updateDimension();var ah={};ah.smoothing={enabled:true,factor:7,fEndDiff:0.03};A=new a.TouchHandler(j.canvasSprite.canvas,ah,S,X,T);P=j.canvasSprite.ctx;K();if(u){j.sprite.show(false)}};var Z=this.destroy=function(){if(A){A.destroy();A=b}a.removeChild(s,j.sprite.element)};var i=this.enable=function(ah){A.enable(ah)};var l=function(ak,ai,aj){var ah=parseInt(ak);if(typeof(ak)=="string"&&ak.indexOf("%")!=-1){ah=Math.max(0,Math.min(100,ah));ah=Math.round(ah*ai/100)}else{ah=parseInt(ak)}if(isNaN(ah)){ah=aj}return ah};this.isDragging=function(){return w};var S=function(ai,al){var aj=a.getElementPosition(j.canvasSprite.element);h=-aj.left;e=-aj.top;var ah=al.x+h;var ak=al.y+e;if(ah<0||ak<0||ah>n||ak>C){return false}w=true;o.stopDesktopAnimation();o.stopAfterTouch();z(al,true);o.autoShowHideHotSpots(false);return true};var X=function(ah,ai){z(ai,true)};var T=function(ah,ai){w=false;z(ai,false);o.onAfterinPlaceZoomChanged();o.autoShowHideHotSpots(true)};var z=function(ak,ai){var ah=ak.x+h-n/2;var aj=ak.y+e-C/2;M.panPos.left=J*-ah;M.panPos.top=J*-aj;o.updateInPlaceZoom(ai)};var O=function(ay,aw,ak,am,an){var ap,al,ah,aj,au,ax,ar,ao;ar=aw;ao=ak;aw=Math.max(1,Math.round(aw/2));if(aw<am){aw=am}ak=Math.max(1,Math.round(ak/2));if(ak<an){ak=an}al=aj=document.createElement("canvas");aj.setAttribute("crossorigin","anonymous");aj.width=aw;aj.height=ak;au=aj.getContext("2d");au.drawImage(ay,0,0,ar,ao,0,0,aw,ak);var ai=document.createElement("canvas");ai.setAttribute("crossorigin","anonymous");var at=ai.getContext("2d");var aq=false;while(aw>am||ak>an){ap=al;ar=aw;ao=ak;if(aq){al=aj;ah=au;aq=false}else{al=ai;ah=at;aq=true}aw=Math.round(aw/2);if(aw<am){aw=am}ak=Math.round(ak/2);if(ak<an){ak=an}al.width=aw;al.height=ak;ah.drawImage(ap,0,0,ar,ao,0,0,aw,ak)}var az;try{az=ah.getImageData(0,0,aw,ak);Y=D}catch(av){az=al;Y=k}return az};var D=function(ai,ah,aj){P.putImageData(ai,ah,aj)};var k=function(ai,ah,aj){P.drawImage(ai,ah,aj)};var K=function(){switch(c.x){case 1:R=(L.width-j.sprite.width())/2;break;case 2:R=L.width-j.sprite.width()-j.sprite.margin.right;break;default:R=j.sprite.margin.left;break}switch(c.y){case 1:Q=(L.height-j.sprite.height())/2;break;case 2:Q=L.height-j.sprite.height()-j.sprite.margin.bottom-ag.getMenuHeight("navWindow");break;default:Q=j.sprite.margin.top;break}j.sprite.setPos(R,Q)};this.setContainerSize=function(ah,ak,aj){var ai=j.sprite.element.style.display;j.sprite.element.style.display="block";j.sprite.updateDimension();U=ak;ae=aj;L=ah;K();j.sprite.element.style.display=ai};var ac=this.autoShowHide=function(ah){if(!u){return}if(M.scale<1.05){j.sprite.show(false,ah)}else{j.sprite.show(true,ah)}};this.setPreviewImageSize=function(ah,ai){if(ah==b){H=b}else{ad.width=ah;ad.height=ai;H=ad}};this.update=function(aB,am){ac(true);if(!j.sprite.isVisible()){return}J=U.imageWidth/n;var ar=P;if(m[aB]==b){var av=o.getPreviewImage(aB);var ax=(H)?H:av;m[aB]=O(av,ax.width,ax.height,n,C)}ar.lineWidth=0;var ao=0;var an=0;if(I&&t!=am){t=am;var aw,ah;if(N){aw=am*G.imageWidth/r.width}else{aw=U.imageWidth/ae.imageWidth}aw=Math.round(100*10*aw)/10;ah=""+aw;if(ah.indexOf(".")==-1){ah+=".0"}ah+=" %";V.nodeValue=ah}Y(m[aB],ao,an);var aA=M.scale;if(aA>1.05){var aq=n/G.imageWidth/aA;var ak=aq*W.width;var at=aq*W.height;var ay=n/U.imageWidth;var ap=(n-ak)/2-M.panPos.left*ay;var az=(C-at)/2-M.panPos.top*ay;var aj=ao+ap;var ai=an+az;var al=ao;var au=an;if(ak<4||at<4){aj+=ak/2;ai+=at/2;ar.strokeStyle=d;ar.strokeRect(aj,ai-3,1,7);ar.strokeRect(aj-3,ai,7,1)}else{ar.save();ar.fillStyle=af;ar.beginPath();ar.rect(al,au,n,ai-au);ar.rect(al,ai,aj-al,at);ar.rect(aj+ak,ai,n-ap-ak,at);ar.rect(al,ai+at,n,C-az-at);ar.closePath();ar.clip();ar.fillRect(ao,an,n,C);ar.restore();ar.save();ar.strokeStyle=d;ar.beginPath();ar.rect(ao,an,n,C);ar.clip();ar.strokeRect(aj,ai,ak,at);ar.restore()}}};this.reverseImageSequence=function(){m.reverse();m.unshift(m.pop())};aa()}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.MenuBar!=b){return}a.MenuBar=function(r,n,j){var u=this;var g=this.myViewer=r.iViewer;var v=r.getRootContainer();var J=r.getElementSpace();var m;var z;var A;var c=r.getToolTipObject();var e=0;var h=this.nIconWidth=32;var G=this.nIconHeight=32;var p=[];var w=b;this.bEnabled=b;var E=this.oButtonOffset={x:0,y:0};var o=false;var q={};var l={};var t=0;var D=0;var s="";var d="fsi-ui-button-icon";var B=function(){u.btnID=0;u.sprite=new a.Sprite(v,J.width,t,450,b,b,"fsi-ui-menu-bar");u.sprite.element.style.width="100%";u.iconClassNamesNormal=d;u.iconClassNamesHover=d+" "+d+"-hover";u.iconClassNamesActive=d+" "+d+"-active";u.iconClassNamesDisabled=d+" "+d+"-disabled";w=setTimeout(y,0)};var y=function(){if(u.sprite.element.offsetHeight!=0||e++>200){w=b;C()}else{w=setTimeout(y,25)}};var C=function(){var L=u.sprite.getClientDim();t=Math.round(L.height);u.sprite.setSize("100%",t);u.setEnabled(false);i();if(typeof(n.urlLogo)=="string"&&n.urlLogo.length>0){m=document.createElement("div");a.addClass(m,"fsi-ui-viewer-logo");a.setStyleAttr(m,"position:absolute");var K=document.createElement("img");K.src=n.urlLogo;m.appendChild(K);u.sprite.element.appendChild(m);a.addEvent(m,"click",g.showAboutWindow)}a.addEvent(u.sprite.element,"mouseup",I);a.addEvent(u.sprite.element,"contextmenu",H);if(o){u.sprite.show(false,false)}j()};var F=this.destroy=function(){if(w!=b){clearTimeout(w);w=b}if(m){a.removeEvent(m,"click",g.showAboutWindow)}a.removeEvent(u.sprite.element,"mouseup",I);a.removeEvent(u.sprite.element,"contextmenu",H);for(var K=0;K<p.length;K++){p[K].destroy()}a.removeChild(v,u.sprite.element)};var I=function(K){if(K.which&&K.which==3){D=new Date().getTime()}};var H=function(L){if(D){var K=new Date().getTime()-D;if(K<300){return}}L.preventDefault&&L.preventDefault()};this.getHeight=function(){return t};var k=function(K,M){var N;if(!K||!M){return N}if(K.indexOf("_")!=-1){var L=K.split("_");switch(L[0]){case"MouseMode":N="";if(M.Mode){N+="<b>"+M.Mode+"</b>"}if(M["Mode"+L[1]]){N+=" "+M["Mode"+L[1]]}break}}return N};this.showButtonToolTip=function(K){if(!c){return}u.showToolTip(K.getCMD(),K.elButton)};this.showToolTip=function(M,L,K,N){if(!c){return}c.show(M,L,K,N,k)};this.hideToolTip=function(){if(!c){return}c.hide()};this.setEnabled=function(K,L){if(u.bEnabled==K){return}u.bEnabled=K;if(L){return}if(K){a.removeClass(u.sprite.element,"fsi-ui-menu-bar-disabled")}else{a.addClass(u.sprite.element,"fsi-ui-menu-bar-disabled")}};this.getButtonEnabled=function(L){var K=l[L];if(K==b){return}return K.bEnabled};this.enableButton=function(M,K){var L=l[M];if(L==b){return false}return L.setEnabled(K)};this.getButtonPressed=function(L){var K=l[L];if(K==b){return false}return K.getPressed()};this.setButtonPressed=function(M,K){var L=l[M];if(L==b){return false}L.setPressed(K);return true};var f=function(L,M){var K;if(q[M]==b){K=q[M]={};K.arButtons=[]}else{K=q[M]}K.arButtons.push(L);L.oGroup=K;L.makeRadioButton()};this.removeButtons=function(K){p=[];q={};l={};i()};this.addButtons=function(M){var L;var Q=t-6;var K,P;var O;if(A){A.remove()}A=new a.Sprite(u.sprite.element,J.width,t,2);a.setStyleAttr(A.element,"position:relative");a.addClass(A.element,"fsi-ui-button-container");for(var N=0;N<M.length;N++){L=M[N];if(L.cmd){if(L.width==b){K=Q}else{K=L.width}if(L.height==b){P=Q}else{P=L.height}O=new a.MenuBarButton(u,A.element,L.cmd,L.bCheckButton);l[L.cmd]=O;p.push(O);if(L.groupID!=b){f(O,L.groupID)}}if(L.enabled===false){u.enableButton(L.cmd,false)}}for(var R in q){q[R].arButtons[0].setPressed(true)}i()};var i=function(){var L=0;var K=J.height-t;u.sprite.setPos(L,K)};this.setContainerSize=function(K){var L=u.sprite.element.style.display;u.sprite.element.style.display="block";var M=a.getElementClientDim(u.sprite.element);t=M.height;u.sprite.updateDimension();J=K;u.sprite.setSize("100%",t);i();u.sprite.element.style.display=L;u.sprite.show(true)};B()};a.MenuBarButton=function(r,f,s,g){var p=this;var h=r;var w;this.bEnabled=true;var i;var m;this.id=h.btnID++;var d={};var k=false;var v;var c;var j="";var t=function(){v=p.elButton=document.createElement("div");a.addClass(v,"fsi-ui-button");c=document.createElement("div");a.addClass(c,h.iconClassNamesNormal);v.appendChild(c);f.appendChild(v);if(s.length>0){j=s.toLowerCase()}else{j==""}if(!a.isMobileDevice){a.addEvent(v,"mousedown",p.onMouseDown);a.addEvent(v,"mouseup",p.onMouseUp);a.addEvent(v,"mouseout",p.onMouseOut);a.addEvent(v,"mouseover",p.onMouseOver)}if(a.isTouch){a.addEvent(v,"touchstart",p.onTouchDown);a.addEvent(v,"touchcancel",p.onTouchUp);a.addEvent(v,"touchend",p.onTouchUp)}q(1)};this.destroy=function(){if(!a.isMobileDevice){a.removeEvent(v,"mousedown",p.onMouseDown);a.removeEvent(v,"mouseup",p.onMouseUp);a.removeEvent(v,"mouseout",p.onMouseOut);a.removeEvent(v,"mouseover",p.onMouseOver)}if(a.isTouch){a.removeEvent(v,"touchstart",p.onTouchDown);a.removeEvent(v,"touchcancel",p.onTouchUp);a.removeEvent(v,"touchend",p.onTouchUp)}};this.getCMD=function(){return s};this.makeCheckButton=function(){g=true};this.makeRadioButton=function(){g=true;k=true};this.getState=function(){return w};var q=this.setState=function(y){if(w==y){return}n(y)};var n=this.setState=function(B){w=B;var A;var C="fsi-ui-button "+j+" ";if(!p.bEnabled){C+="fsi-ui-button-disabled ";A=h.iconClassNamesDisabled}else{A=h.iconClassNamesNormal}switch(w){case 2:C+="fsi-ui-button-hover";A=h.iconClassNamesHover;break;case 3:C+="fsi-ui-button-active";A=h.iconClassNamesActive;break;case 4:C+="fsi-ui-button-active";A=h.iconClassNamesActive;if(p.oGroup!=b){for(var z=0;z<p.oGroup.arButtons.length;z++){var y=p.oGroup.arButtons[z];if(y.id!=p.id){y.setPressed(false)}}}break;default:break}v.className=C;c.className=A};this.onMouseOver=function(y){h.showButtonToolTip(p);if(!p.bEnabled||!h.bEnabled){return}if(w==1){q(2)}};this.onMouseOut=function(y){h.hideToolTip();if(!p.bEnabled||!h.bEnabled){return}if(w==3){p.onMouseUpOutside()}if(w!=1&&w!=4){q(1)}};this.onMouseDown=function(y){if(y.type=="mousedown"){if(y.which!=1){return true}y.cancelBubble=true;if(y.stopPropagation){y.stopPropagation()}if(y.preventDefault){y.preventDefault()}}h.hideToolTip();if(!p.bEnabled||!h.bEnabled){return}if(g){if(w==4){if(!k){q(3)}}else{q(4)}}else{q(3)}o(y)};this.onTouchDown=function(y){p.onMouseDown(y);if(y.preventDefault){y.preventDefault()}};this.onTouchUp=function(y){p.onMouseUp(y);if(y.preventDefault){y.preventDefault()}};this.onMouseUp=function(z){if(!p.bEnabled||!h.bEnabled){return}var y=(z.type=="touchend")?1:2;if(g){if(w==3){q(y)}}else{q(y)}l()};this.onMouseUpOutside=function(y){if(!g){q(1)}l()};this.setEnabled=function(y){if(p.bEnabled==y){return}if(!y&&(w==1||!g)){p.setState(1)}if(y){a.removeClass(v,"fsi-ui-button-disabled")}else{a.addClass(v,"fsi-ui-button-disabled")}p.bEnabled=y;return true};var u=this.getPressed=function(){return(w>2)};var e=this.setPressed=function(y){if(!g){return}if(y){q(4)}else{q(1)}};var o=function(y){h.myViewer.onMenuButtonPress(s,y)};var l=function(){h.myViewer.onMenuButtonRelease(s)};t()}}(window.$FSI=window.$FSI||{}));(function(a,b){if(a.Viewer!=b){return}a.Viewer=function(fB,dM){var ch=new a.ClassDef(this,"FSI Viewer","2016","16.06.9");var aX=ch.instance;a.guessFSIViewerLocation("fsiviewer.js",3);var dl=a.getViewerInstanceID();var f2;var ai;var l;var fI;var Q;var c6;var f0={};var z;var en;var bh;var cR=false;var E;var c9=0;var av={};var eg=8;var gu=1;var aa;var cT;var d=false;var ge;var fn;var bN;var bd;var cD;var eu;var gl,cv;var et;var bi=true;var fN=100;var bJ=true;var d5;var by;var at;var cA;var gd;var c3;var ec;var q;var a9;var dj=false;var eL=new a.CroppedImage();var eK=new a.Rect();var aA=a.Easing.easeOutCubic;var ej;var ek={width:0,height:0};var bp;var R;var ao={};var f1;var bg;var aI={};var cg=10000;var gp=cg;var es;var bb;var O;var cO;var aP={x:0,y:0,z:0};var fU;var Z;var aR=new a.Rect(0,0,-1,-1);var df=new a.Rect(0,0,-1,-1);var eR=new a.Rect(0,0,-1,-1);var e6=new a.Rect(0,0,-1,-1);var fl=new a.Rect(0,0,-1,-1);var aD=new a.Rect(0,0,0,0);var fR=new a.Rect(0,0,0,0);var ar=false;var P=true;var D;var dy=false;var bo=false;var br=false;var cC=true;var dg=false;var y;var eD=false;var gi;var cL=false;var fP=true;var gc=false;var fg=false;var eM;var bG=new a.Rect(0,0,0,0);var d0=0;var cU;var cn=0;var bj=0;var ab=0;var aK,cX;var dR=0;var dF=0;var b9=0;var c8={x:0,y:0};var U={};var aZ={};var t={};var d2="auto";var d4;var eN=1;var am;var a7;var fJ=true;var aM={};aM.cursors={};var ck;var eW=b;var f;var cG;var gs=false;var d7=false;var dq=true;var cQ=true;var fD=false;var b0=false;var ex=false;var eZ;var bM;var f5;var bc=false;var fS;var d3;var a0;var eA={};var b6;var cS;var fu;var b7;var ds;var W;var dC;var dO;var c1;var go;var e=[];var ga=[];var da;var dh={};var cb={};var fx;var dB=false;var gn;var dk;var K;var dc;var T;var gf={};var ae;var aY=f0.viewport={};var c7=a.SVGNameSpaceURL;var fb="1.1";var bf;var gb;var ak;var bR=1;var co;var ay;var bT;var cm=0;var ev;var eQ=0;var er=1;var aj=2;var fp=eQ;var fA;var h=false;var I;var bx;var ff;var gj;var aB=false;var e4=false;var fC;var ee=1;var bH={};var C=false;var a2;var fq;var fK;var eV;var cu={width:0,height:0};var bI=false;var bY=/((\?)|&)(width|height)=[^&]*/ig;var az=false;var dA;var bU="&limit=0,360";var eo;var cZ=true;var f3=false;var u;var eb=b;var gg;var eO=false;var bC;var b2="&effects=Matte(FFFFFF)";var c;var ew;var ap;var a8=true;var fs;var cs;var e9;var de;var bZ;var fX;var bl=0;var ca=0;var bm={};var cp=false;var em=true;var F;var eH={};var ah=0;var aO={};var cq={};var dD={};var c4=new a.EmptyDebugger();var gk=function(gv,o){if(o&&!c4.on&&gv.on){fx.stopPendingRequests();aX.destroy();aX.init(K,dD,true);aX.start();return true}c4=gv;if(c4.on){c4.setPrefix(ch.strClassName+" ["+K+"]")}};this.init=function(gv,gz,o){if(typeof(gv)=="object"){if(typeof(gv.id)=="string"){K=gv.id}}else{if(typeof(gv)=="string"){K=gv}}if(!K){K="fsi.viewer #"+dl}if(aX._fsi_parameters){gz=aX._fsi_parameters;delete aX._fsi_parameters;aX._fsi_parameters=b}if(a.isMobileDevice){fA=5000000}else{fA=8000000}if(fD){aX.destroy()}var gx;if(typeof(gv)=="object"&&gv.tagName!=b){gx=gv}else{gx=document.getElementById(gv)}if(typeof(gz)=="object"&&typeof(window[gz.oninit])=="function"){var gw=window[gz.oninit](aX,K,gz)}dD=(gz&&typeof(gz)=="object")?a.cloneParameters(gz):{};var gA={};gA.onConfigsReady=dv;gA.onDebuggerChange=gk;fx=new a.Config(null,gA);var gy=dD;if(o){gy=a.cloneObject(dD);gy.debug=true}fx.init(gy);if(c4.on){c4.log(aX.getVersion())}w();if(!gx){c4.error("A DOM element with the id '"+gv+"' could not be found. Aborting.");return}bf="1.5px";if(a.isSmallMobileDevice){c4.log("Small mobile Device detected.");bI="fsi-ui-hotspot-mobile fsi-ui-hotspot-mobile-small";bf="4px"}else{if(a.isMobileDevice){c4.log("Mobile Device detected.");bI="fsi-ui-hotspot-mobile"}}if(gx.firstChild!=b){gx.innerHTML=""}ai=gx;if(ai.tagName.toLowerCase()!="fsi-viewer"){a.addClass(ai,"fsi-viewer")}ai.setAttribute("x-fsi-id",K);ev=(a.isMobileDevice)?0.2:0.1;if(!f2){f2=document.createElement("div");f2.className="fsi-viewer-root";a.setStyleAttr(f2,"position:relative;left:0px;top:0px;padding:0px;margin:0px;border:0px none;z-index:0;width:100%;height:100%;text-align:left;vertical-align:top;");gx.appendChild(f2)}ad();if(c4.on){c4.log("Container element: "+ae.width+" x "+ae.height+" ("+gx.nodeName+")")}fD=true;a9=a.getCSSTransformStyleName();if(a9=="msTransform"||(!isNaN(a.versionInternetExplorer)&&a.versionInternetExplorer<11)){d5=false;bJ=false}else{if(a.mobileOS=="ios"){d5=false}else{d5=true}}d5=false};this.getInitDone=function(){return fD};var ad=function(){ae=a.getElementDimension(f2);var o=(fI&&fI.minInstanceSize>1)?fI.minInstanceSize:60;if(ae.width<o||ae.height-ca<o){ae.visible=false;ae.width=o;ae.height=o+ca}else{ae.visible=true}aY.width=ae.width;aY.height=ae.height-ca};var bB=function(o){if(bC==o){return}bC=o;gj.style.cursor=aM.cursors[o]};var e0=function(gB,gA,gD,gz,o){var gx=aY.width*ao.scale;var gv=aY.height*ao.scale;if(gB==b){gB=gx/2}if(gA==b){gA=gv/2}var gw;if(gD!=b){gw=Math.max(1,Math.min(bH.maxScale,bH.scale+gD))}else{gw=bH.defaultZoom}var gC=gw/bH.scale;var gB=gC*(bH.panPos.left-(gB-gx/2));var gA=gC*(bH.panPos.top-(gA-gv/2));var gy=(gz)?0:o;ef(gB,gA,gw,gy)};var fE=function(o,gy,gw,gv){if(!bH.enabled){return}if(bH.panPos.left==0&&bH.panPos.top==0&&(gb<=1||(O&&bH.targetZoom==1))){return}var gx=(gw)?0:gv;ef(0,0,1,gx)};var d8=function(o){if(ao.scale>1){o.scaleRect(1/ao.scale)}var gE=o.width();var gz=o.height();if(gE<1||gz<1){return}var gA=gE/gz;var gy=aY.width/aY.height;if(gA>gy){gz=gE*aY.height/aY.width;o.inflateRect(0,gz-o.height())}else{if(gA<gy){gE=gz*aY.width/aY.height;o.inflateRect(gE-o.width(),0)}}var gv=gb*aY.width/gE;gv=Math.max(1,Math.min(bH.maxScale,gv));var gD=gv/gb;var gx=o.left+o.width()/2;var gw=o.top+o.height()/2;var gC=(bH.panPos.left-gx+aY.width/2)*gD;var gB=(bH.panPos.top-gw+aY.height/2)*gD;ef(gC*ao.scale,gB*ao.scale,gv)};var ef=function(o,gy,gx,gv){gx=Math.max(1,Math.min(bH.maxScale,gx));dY();bH.pos=0;bH.frames=(gv!=b)?gv:28;if(bH.frames<1){bH.frames=1}bH.sourceZoom=bH.scale;bH.sourceX=bH.panPos.left;bH.sourceY=bH.panPos.top;if(o==b){o=bH.sourceX}if(gy==b){gy=bH.sourceY}var gw=f9(o,gy,gx);bH.targetX=gw.x;bH.targetY=gw.y;bH.targetZoom=gx;bH.dX=gw.x-bH.sourceX;bH.dY=gw.y-bH.sourceY;bH.dZoom=gx-bH.sourceZoom;a1()};var v=f0.stopAfterTouch=function(){if(F){F.cancelAfterTouch()}};var aF=f0.autoShowHideHotSpots=function(o){if(cQ==o){return}cQ=o;if(!d7||!a.isMobileDevice){return}dq=o;fo(o);dd();if(o){gh()}};var a1=function(){if(O){return}bH.lockPanAnimation=false;C=true;aF(false);O=true;gh()};var dY=f0.stopDesktopAnimation=function(){if(O){aF(true);C=false;O=false;bH.pos=bH.frames=0;bH.targetZoom=b;bF();dm();fa();cx()}};var bQ=function(){if(O||gs){return}if(typeof aX.onAnimationComplete=="function"){aX.onAnimationComplete(aX)}};var eT=function(){bH.pos++;fm(aA(bH.pos,bH.frames,bH.sourceZoom,bH.dZoom,3));if(!bH.lockPanAnimation){bH.panPos.left=aA(bH.pos,bH.frames,bH.sourceX,bH.dX,3);bH.panPos.top=aA(bH.pos,bH.frames,bH.sourceY,bH.dY,3)}bF();if(bH.pos==bH.frames){dY();bQ();return false}return true};var ei=f0.onAfterinPlaceZoomChanged=function(){bF();dm();fa()};this.getMouseMode=function(){return d2};var ez=this.setMouseMode=function(o){var gv=d2;d2=o;switch(o){case"auto":if(u){o=(bH.bZoomedIn)?1:0}else{o=(bH.bAutoMouseModePan)?1:2}break;case 0:case 1:break;case 2:if(u){o=(bH.bZoomedIn)?1:0}else{o=2}break}cl(o)};var cl=function(o){if(F){F.cancel()}d4=o;switch(d4){case 0:bB("zoom");break;case 1:bB("pan");break;case 2:if(aO.nSceneSets>1){bB("rotate3d")}else{bB("rotate")}break}if(cs){cs.setButtonPressed("MouseMode_"+d4,true)}};var fa=function(){if(!bH.enabled||d2!="auto"){return}var o=(gb>1);if(bH.bZoomedIn==o){return}bH.bZoomedIn=o;if(o){bH.bAutoMouseModePan=true;if(u){cl(1)}else{cl(1)}}else{bH.bAutoMouseModePan=false;if(u){cl(0)}else{cl(2)}}};var f9=function(o,gB,gA){var gy={x:o,y:gB};var gz=Math.round(aZ.imageWidth*gA);var gw=Math.round(aZ.imageHeight*gA);var gx=Math.max(0,(gz-U.maxPanReferenceWidth)/2);var gv=Math.max(0,(gw-U.maxPanReferenceHeight)/2);gy.x=Math.max(-gx,Math.min(gx,o));gy.y=Math.max(-gv,Math.min(gv,gB));return gy};this.getZoom=function(){var o=gb/bH.maxScale*100;return o};this.setZoom=function(gw,o,gv){if(!b0||!bH.enabled){return false}au(true);dY();var gw=gw*bH.maxScale/100;if(gv){ef(b,b,gw);return}else{fm(gw)}bF(o);if(!o){dm();fa()}return true};var ci=function(gx){if(typeof(gx)!="string"){gx=""}var o=[1,1,0,0,1,1,0];var gw;gx=gx.split(",");for(var gv=gx.length;gv<7;gv++){gx.push(o[gv])}return gx.join(",")};var b8=this.getViewString=function(){var gx=[];var gB=aO.nCurrent+1;var gy=1+Math.round(d0/(dR/bj));if(isNaN(gy)){gy=1}var gz=U.imageWidth;var gw=gz/ap.width*ap.height;var gC=1/gb;var gA=0.5-bH.panPos.left/gz-gC/2;var gv=0.5-bH.panPos.top/gw-gC/2;var o=new a.Rect(gA,gv,gA+gC,gv+gC);o.round();gx.push(gB);gx.push(gy);gx.push(o.toString());gx.push(0);return gx.join(",")};var ea=function(gv){var o=parseFloat(gv);if(isNaN(o)){o=def}return o};var dU=function(gA){var gz={SceneSet:0,scene:0};if(gA==b||typeof(gA)!="string"||gA.length<3){return gz}var gB=gA.split(",");if(gB.length<2){return gz}if(aO.nSceneSets<2){gz.SceneSet=0}else{gz.SceneSet=parseInt(gB[0])-1;if(isNaN(gz.SceneSet)){gz.SceneSet=b}}gz.scene=parseInt(gB[1]);if(isNaN(gz.scene)){gz.scene=1}gz.scene=gz.scene%bj-1;if(gz.scene<0){gz.scene+=bj}gz.frame=gz.scene*dR/bj;if(gB.length>5){var gE=ea(gB[2]);var gw=ea(gB[3]);var gD=ea(gB[4]);var gx=ea(gB[5]);var gv=gz.rc=new a.Rect(gE,gw,gD,gx);gv.normalizeRect();var gy=gv.width();var gF=gv.height();var gG=1/Math.max(gy,gF);gz.zoom=gG=Math.max(1,Math.min(bH.maxScale,gG));var gC=aZ.imageWidth;var gH=aZ.imageWidth/ap.width*ap.height;gz.x=-gC*gG*((gv.left+gv.width()/2)-0.5);gz.y=-gH*gG*((gv.top+gv.height()/2)-0.5)}return gz};var f6=this.gotoViewString=function(gw,gx){if(!b0){return false}var o=(gx)?30:0;var gv=dU(gw);if(gv.scene==b){return false}var gy=dU(b8());if(gv.scene==gy.scene&&Math.abs(gv.x-gy.x)<1&&Math.abs(gv.y-gy.y)<1&&Math.abs(gv.zoom-gy.zoom)<0.000001){return true}aX.spinToTarget(gv.frame,gv.SceneSet,o);if(bH.enabled&&gv.rc!=b){ef(gv.x,gv.y,gv.zoom,o)}return true};this.changeImage=function(o,gv){fx.makeObjectPropertiesLowerCase(o);if(!ex){eZ=arguments;return}fx.stopPendingRequests();var gw=false;if(o!=b){if(o.fpxsrc!=b||o.imagepath!=b){gw=true}if(o.dir!=b){gw=true}}if(!gw){return aX.gotoViewString(gv,true)}fx.setData(ew);if(o.imagepath!=b){o.fpxsrc=o.imagepath;o.imagepath=b}fx.cfg.fpxsrc=b;fx.cfg.imagepath=b;fx.cfg.imagewidth=b;fx.cfg.imageheight=b;fx.cfg.transparency=b;fx.setCfgValues(o);w();c=gv;ba();e2();return true};var bX=function(){var gv={};var o=aZ.imageWidth/ap.width*ap.height;gv.x=((aY.width-aZ.imageWidth)/aZ.imageWidth);gv.y=((aY.height-o)/o);return gv};var fr=function(){var o=bp;if(gb<=1){eu=1;o=ay;return o}var gw=gb*t.imageWidth;var gy=Math.round(ap.width/ek.width*gw);var gx;for(var gv=0;gv<bd.length;gv++){if(bd[gv]>=gy){gx=R=bd[gv];break}}if(!gx){if(bd.length>0){gx=bd[bd.length-1]}if(gx<=1.1*t.imageWidth){gx=b}}if(gx){o=Math.round(gx*eL.getImageRect().width()/ap.width)}eu=o/ay;return o};var fm=function(o){o=Math.max(1,Math.min(bH.maxScale,o));bH.scale=o;gb=bH.scale*ao.scale;ak=Math.min(bH.maxScaleInitial,bR*bH.scale);cD=bH.scale*bR};var e5=function(){var o=Math.min(bH.maxScaleInitial,bR);if(o*bH.scale>bH.maxScaleInitial){bH.scale=bH.maxScaleInitial/o}ak=Math.min(bH.maxScaleInitial,bR*bH.scale);return o};var X=function(o){ao.scale=o;gb=ao.scale*bH.scale;ak=Math.min(bH.maxScaleInitial,bR*bH.scale);bH.scale=Math.max(1,ak/bR);cD=bR*bH.scale};var bF=f0.updateInPlaceZoom=function(gv){if(O){gv=true}var gw=false;if(gv){if(bH.nLastScalePreliminary!=gb){bH.nLastScalePreliminary=gb;gw=true}}else{if(bH.nLastScaleFinal!=gb){bH.nLastScaleFinal=gb;gw=true}}if(gw){if(gv&&cS&&gb-cS.renderScale<-1){eJ()}U.imageWidth=gf.testWidth=Math.round(t.imageWidth*gb);U.imageHeight=Math.round(t.imageHeight*gb);U.imageX=Math.round(aZ.imageX-(U.imageWidth-aZ.imageWidth)/2);U.imageY=Math.round(aZ.imageY-(U.imageHeight-aZ.imageHeight)/2);U.maxImageOffsetX=Math.max(0,(U.imageWidth-U.maxPanReferenceWidth)/2);U.maxImageOffsetY=Math.max(0,(U.imageHeight-U.maxPanReferenceHeight)/2);if(f5){U.videoWidth=Math.round(t.videoWidth*gb);U.videoHeight=Math.round(t.videoHeight*gb);U.videoX=aZ.videoX-(U.videoWidth-aZ.videoWidth)/2;U.videoY=aZ.videoY-(U.videoHeight-aZ.videoHeight)/2}if(!gv){var o;if(cs||aX.onEnableMenuButton){o=(bH.scale>1);cc("ZoomOut",o);if(fp<aj){cc("MouseMode_1",o)}o=(bH.scale<bH.maxScale);cc("ZoomIn",o);cc("MaxZoom",ek.width!=U.imageWidth)}bp=fr()}if(aX.onZoomChange!=b){var gx=gb*100/bH.maxScale;aX.onZoomChange(gx)}}if(!O){bH.panPos.left=Math.max(-U.maxImageOffsetX,Math.min(U.maxImageOffsetX,bH.panPos.left));bH.panPos.top=Math.max(-U.maxImageOffsetY,Math.min(U.maxImageOffsetY,bH.panPos.top))}if(!gv){bH.panPos.left=Math.round(bH.panPos.left);bH.panPos.top=Math.round(bH.panPos.top)}gc=true;dd();y=true;gh()};var dm=function(){if(!cG&&!gs){eE()}};var bS=function(){var o=a.getElementClientPos(et);aR.copyRect(bG);fl.copyRect(o);aR.interSectRectValidate(fl);aR.offsetRect(-fl.left,-fl.top);var gv=(aR.width()>0&&aR.height()>0);var gw=(gv!=ao.visible);ao.visible=gv;return gw};var bW=function(o){e6.copyRect(o);e6.offsetRect(-t.imageX,-t.imageY);if(bi&&e6.width()>0&&e6.height()>0){e6.inflateRect(fN/gb,fN/gb)}e6.scaleRect(eu)};var j=function(){var gv;var o;var gw=cD;gv=(aR.left+aR.width()/2)-ao.widthUnScaled/2;if(ao.leftLast!=gv){ao.leftLast=gv;if(gv<0){gv=0}if(gv>ao.maxLeft){gv=ao.maxLeft}ao.left=gv}ao.drawOffsetX=ao.scale*(-gv-ao.left+gv);o=(aR.top+aR.height()/2)-ao.heightUnScaled/2;if(ao.topLast!=o){ao.topLast=o;if(o<0){o=0}if(o>ao.maxTop){o=ao.maxTop}ao.top=o}ao.drawOffsetY=ao.scale*(-o-ao.top+o);if(dy){dh.renderer.setSize(ao.totalWidth,ao.totalHeight);gc=true;dd()}};var r=function(gv){var gC=bR;if(!h){k(U.widthForRatio,U.heightForRatio,true);gh();return}var gy=false;var gw=e5();cD=bH.scale*bR;var gz=bS();if(gz){gv=true;if(ao.visible){}else{}}else{if(!ao.visible){return}}if(!gv&&cS){if((gz&&!ao.visible)||(ao.widthUnScaled<aR.width()||ao.heightUnScaled<aR.height())||(Math.abs(gw-ao.scale)>1)){if(gw>1){gC=gw=1;gv=true}}}if(!gv){var gx=ao.left;var gG=ao.top;j();cO=(ao.left!=gx||gG!=ao.top);y=true;gh();return}if(ao.lastScale!=gw){ao.lastScale=gw;X(gw);var gA=Math.round(aY.width*gw);var o=Math.round(aY.height*gw);var gF,gE;var gD=0;if(bi){gD=fN}ao.maxWidth=Math.round((window.innerWidth*bR+gD)*gw/gC);ao.maxHeight=Math.round((window.innerHeight*bR+gD)*gw/gC);if(gA>ao.maxWidth){gF=ao.maxWidth}else{gF=gA}if(o>ao.maxHeight){gE=ao.maxHeight}else{gE=o}ao.width=gF;ao.height=gE;ao.widthUnScaled=Math.ceil(gF/gw);ao.heightUnScaled=Math.ceil(gE/gw);ao.totalWidth=gA;ao.totalHeight=o;gy=(fu.width!=gF||fu.height!=gE)}ao.maxLeft=(ao.totalWidth-ao.width)/ao.scale;ao.maxTop=(ao.totalHeight-ao.height)/ao.scale;if(d5){if(ao.scale!=1){var gB=1/ao.scale;if(bJ){ao.strTransformScale=" scale3d("+gB+","+gB+","+gB+")"}else{ao.strTransformScale=" scale("+gB+","+gB+")"}}else{ao.strTransformScale=""}}else{ao.strTransformScale=""}j();if(gy){if(bJ){g(fu,"translate3d("+ao.left+"px,"+ao.top+"px,0px)"+ao.strTransformScale)}else{g(fu,"translate("+ao.left+"px,"+ao.top+"px)"+ao.strTransformScale)}if(!d5){fu.style.width=gF/gw+"px";fu.style.height=gE/gw+"px"}fu.width=gF;fu.height=gE;b7=fu.getContext("2d");gl=gA;cv=o;k(U.widthForRatio,U.heightForRatio,true);bp=fr();if(bH.enabled){cB();bF()}}else{if(bJ){g(fu,"translate3d("+ao.left+"px,"+ao.top+"px,0px)"+ao.strTransformScale)}else{g(fu,"translate("+ao.left+"px,"+ao.top+"px)"+ao.strTransformScale)}if(!d5){fu.style.width=fu.width/gw+"px";fu.style.height=fu.height/gw+"px"}}if(!bM){eE();y=true;gh()}else{cj()}};var g=function(o,gv){o.style[a9]=gv};this.showAboutWindow=function(){if(l){l.destroy();l=b;return}var o={};o.title="About FSI Viewer";o.fnOnDestroy=gr;o.strLongVersion=aX.getVersion();l=new a.AboutWindow(f2,o)};var gr=function(){l=b;return true};this.changeConfig=function(o,gv){if(F){F.cancel()}fx.stopPendingRequests();fV();fx.cfg.dir=b;fx.cfg.fpxsrc=b;fx.cfg.fpxpath=b;fx.cfg.fpxsources=b;fz();if(gv!=b){dD=a.cloneParameters(gv)}if(o!=b){dD.cfg=o}fx.init(dD);aX.start()};var eB=function(o,gv){if(!o){return}if(!gv){if(o.FSI_prevDisplayState==b){o.FSI_prevDisplayState=o.style.display}o.style.display="none"}else{if(o.FSI_prevDisplayState!=b){o.style.display=o.FSI_prevDisplayState}o.FSI_prevDisplayState=b}};var dt=function(o){if(o==cZ){return}cZ=o;eB(et,o);eB(gj,o);fo(o)};var fo=function(o){if(!cR){o=false}eB(T,o)};var dL=function(gv,gw,o){if(gv==b){return}gv.style.width=(typeof(gw)!="string")?gw+"px":gw;gv.style.height=(typeof(gw)!="string")?o+"px":o};var db=function(gv,o){dL(et,gv,o);dL(gj,gv,o)};var aS=function(o){if(!es){es=true;gm();bb=b8();if(F){F.cancel()}dt(false);eB(et,true);fu.style.width=fu.style.height="100%";if(e9){e9.hide()}}et.style.display="none";var gx=a.getElementDimension(f2);et.style.display="block";var gw=gx.width;var gy=gx.height-ca;var gv;if(gw/gy>aY.width/aY.height){gv=gy*aY.width/aY.height;et.style.marginLeft=(gw-gv)/2+"px";et.style.marginTop="0px";gw=gv}else{gv=gw*aY.height/aY.width;et.style.marginLeft="0px";et.style.marginTop=(gy-gv)/2+"px";gy=gv}et.style.width=gw+"px";et.style.height=gy+"px";if(cs){cs.setContainerSize(gx)}if(fs){fs.setContainerSize(gx,U,aZ)}if(o.FSI_after_treshold!=b){bA()}};var bA=this.updateSize=function(){r();dW();ad();db(aY.width,aY.height);dt(true);es=false;if(fu==b||aY.width<1||aY.height<1){return}var o=cA;eY();fu.style.width=fu.style.height="";et.style.marginLeft=et.style.marginTop="";if(fu!=b){gl=fu.width=ao.widthUnScaled=aY.width;cv=fu.height=ao.heightUnScaled=aY.height}k(U.widthForRatio,U.heightForRatio);if(dy){dh.renderer.setSize(aY.width,aY.height);bP();dd();y=true;gc=true}ec=cA=b;eJ();aC();if(fs){fs.setContainerSize(ae,U,aZ)}if(cs){cs.setContainerSize(ae)}f6(bb);ey();bF();eh(o)};var fz=function(o){gm();av={};du();aI={};ew=b;c4=new a.EmptyDebugger();w();if(fx){fx.reset();fx.init(dD)}fI={}};var fV=function(){if(ej&&bx){ej.lockImageSourceDimension(bx,false);ej.lockImage(bx,false);ej.removeImages(bx,false)}};var cB=function(){bH.nLastScalePreliminary=b;bH.nLastScaleFinal=b};var aC=function(){cB();bp=R=b;eM=b};var fO=function(){gf={}};var dW=function(){ao={};X(1);var o,gv;if(fu){o=fu.width;gv=fu.height}ao.leftLast=ao.topLast=b;ao.width=ao.widthUnScaled=ao.totalWidth=o;ao.height=ao.heightUnScaled=ao.totalHeight=gv;ao.left=ao.top=0;ao.drawOffsetX=ao.drawOffsetY=0};var w=function(){gm();c9=0;fP=true;bk();if(F){F.cancel()}au();bv();dY();M();eJ();af();dN();bH.panPos={left:0,top:0};bH.maxScale=bH.maxScaleInitial=1;bH.scaleToSourceImage=1;bH.scale=1;bH.pos=bH.frames=0;bH.sourceX=bH.sourceY=0;bH.targetX=bH.targetY=0;bH.sourceZoom=bH.targetZoom=1;bH.dX=bH.dY=bH.dZoom=0;bH.lockPanAnimation=false;dW();fm(1);bR=ee=1;fO();bg=b;ek={width:0,height:0};ah++;aC();dq=true;fo(false);at=b;cA=b;ec=b;gs=false;cC=true;br=false;if(cs){cs.setEnabled(false,true)}bc=false;c=b;b0=false;if(!h&&bx){a.removeEvent(bx,"load",cY)}cu={width:0,height:0};fV();gp=cg;fa();if(fq){clearTimeout(fq);fq=b}if(dA){clearTimeout(dA);dA=b}dP("image",true);if(ds){ds=b}e=new Array();if(d7){for(var o=0;o<fI.hotspots.points.length;o++){var gv=fI.hotspots.points[o];if(gv&&gv.tooltip){if(gv.interactive){a.removeEvent(gv.tooltip,"mouseover",eF);a.removeEvent(gv.tooltip,"mouseout",eF)}a.removeChild(gv.tooltip.parentNode,gv.tooltip);a.removeChild(gv.marker.parentNode,gv.marker)}}}bM=false;d7=false;dR=b;a0="";da=0;I=b;ga=[];dN();if(b6){b6=b}eA={};dC=b};var dN=function(){if(dk){eX(dk);if(dk.parentNode){a.removeChild(dk.parentNode,dk)}dk=b}};var eX=function(gw){try{if(gw&&gw.FSIEvents){for(var gy in gw.FSIEvents){var gv=gw.FSIEvents[gy];a.removeEvent(gw,gy,gv.fn,gv.phase)}}}catch(gx){}};var dQ=function(o,gv){if(o.touches){if(o.touches.length>0){gv.x=o.touches[0].clientX;gv.y=o.touches[0].clientY}}else{gv.x=o.clientX;gv.y=o.clientY}};var dT=function(o,gx,gw){if(!b0){return false}cK("mousedown");au();gm();bv();if(bH.enabled){var gv=(O)?bH.targetZoom:bH.scale;em=(gv<=1);dY()}cG=true;if(ej&&d4==2&&!u){ej.lockImageSourceDimension(bx,true);ej.lockImage(bx,true)}fu.lastOffsetX=gx.x;fu.lastOffsetY=gx.y;b9=dF;c8.x=gx.x;c8.y=gx.y;switch(d4){case 0:if(bH.enabled){aD.clientOffset=a.getElementPosition(gj);aD.setRect(gx.x,gx.y,gx.x,gx.y);fg=true;gh()}break;case 2:c8.SceneSetStart=c8.SceneSetLast=aO.nCurrent;aD.clientOffset=a.getElementPosition(gj);bD("mouseDown");break}return true};var S=function(gB,gA,gC){var gv=fu.lastOffsetX-gA.x;var o=fu.lastOffsetY-gA.y;switch(d4){case 0:if(bH.enabled){aD.setRect(aD.left,aD.top,gA.x,gA.y);gh()}break;case 2:if(aO.nSceneSets<2){if(Math.abs(o)>3*Math.abs(gv)){gB.FSI_allowEventDefault=true}}else{var gD=gA.y-c8.y;var gz=c8.SceneSetStart-Math.round(gD*aO.nSceneSets/aY.height);gz=V(gz);if(gz!=c8.SceneSetLast){e8(gz);c8.SceneSetLast=gz}}f8(b9-(gA.x-gB.FSI_start_x)/eN);da=(gv<0)?-1:1;break;default:var gw=false;if(bH.enabled){var gy=bH.panPos.left;var gx=bH.panPos.top;bH.panPos.left-=gv*ao.scale;bH.panPos.top-=o*ao.scale;bF();gw=(gy!=bH.panPos.left||gx!=bH.panPos.top);if(!gw){aF(true);gB.FSI_allowEventDefault=true}else{aF(false);gh()}}else{gB.FSI_allowEventDefault=true}}fu.lastOffsetX=gA.x;fu.lastOffsetY=gA.y};var e3=function(gv,gA,gz){if(!eH.bActive){aF(true)}var o=gv._FSI_Canceled;var gx=gv._FSI_Click;cG=false;fg=false;cK("mouseup");if(o){if(d4==2){fy("pointer up - canceled")}return}switch(d4){case 0:if(bH.enabled){fG();if(!gx&&bH.maxScale>1){d8(fR)}gh()}break;case 1:if(fp==aj&&gb<=1){fE(0,0)}break;case 2:var gw=false;if(!gv._FSI_fromAfterTouch){d9(b,false)}else{var gy=cP(dF,false);dI(gy,gy,1,1);fy("pointer up")}break}fa();if(gx){bz(gv,gA,gz)}};var a3=function(){return(d4==2||(d4==1&&gb>1))};var L=function(gB){if(d4==2){var gw=dR/bj;var gv=gB.x-c8.x;var o=-gv/eN+b9;var gA=Math.round(o/gw)*gw;var gz=-(gA-b9)*eN;gB.x=gz+c8.x;var gy=gB.x-c8.x;var gx=-(gB.x-c8.x)/eN+b9}return gB};var bz=function(gv,gz,gx){if(fC&&cK("click")){return}if(!em){fE(0,0)}else{if(bH.maxScale>1){var gw=a.getElementPosition(gj);var o=gz.x-gw.left;var gy=gz.y-gw.top;e0(o*ao.scale,gy*ao.scale)}}};var cK=function(gv){var gw=F.getInitialDownEvent();if(!gw||!gw.target){return false}var o=gw.target;if(o.FSIHotspot){fc(gv,o);return true}};var fv=function(gw,gv,gz,gx){for(var gy in gz){gv[gy]=gw.getFloatParameter(gx+gy,gz[gy])}};var dK=function(gw,gv,gz,gx){for(var gy in gz){gv[gy]=gw.getIntParameter(gx+gy,gz[gy])}};var cV=function(gx,gw,gv,gy){for(var gz in gv){gw[gz]=gx.getStringParameter(gy+gz,gv[gz])}},s=function(gw,gv,gy,gx){for(var gz in gy){gv[gz]=gw.makeBool(gw.getStringParameter(gx+gz),gy[gz])}};var cI=function(gv,o,gx,gw){var gy;if(gx&&gx.length>0){if(o[gx]==b){o[gx]={}}gw=gw[gx];gy=o[gx]}else{gy=o}if(gw.strings){cV(gv,gy,gw.strings,gx)}if(gw.booleans){s(gv,gy,gw.booleans,gx)}if(gw.floats){fv(gv,gy,gw.floats,gx)}if(gw.integers){dK(gv,gy,gw.integers,gx)}};var b3=function(gv){var gw={strings:{dir:"",skin:"black",language:"english",backgroundColor:"#FFF",hotspotLineColor1:"#000000",hotspotLineColor2:"#FFFFFF",hotspotDotColor1:"#58a8ff",hotspotDotColor2:"#FFFFFF",hotspotCallbackFunction:b,headers:"cors",fpxservertemplate:b,imagemattecolor:"FFFFFF",initialview:"",initialMouseMode:"auto",navWidth:"120",navHeight:"120",panLimits:"strict",inPlaceZoom:"auto",documentZoom:"auto",hideUI:"false",spinDirectionImage:"right"},booleans:{useDevicePixelRatio:true,adaptiveUISize:true,drawCube:false,drawTable:false,drawGroundPlate:false,pellets:true,enableHotspots:true,decodeHTMLEntitiesInHotSpotTexts:false,enableZoom:true,noCanvas:false,useMaskedJPEGs:true,noNav:false,autoHideNav:true,autoDisablePointerActions:true,loadExactPreviewImagesAfterResize:false,preventImageTransparency:false,noSetLoop:false,noSceneLoop:false,initialViewPersistent:false,showPreviewWhileLoading:true,spinPreviewWhileLoading:true,showProgressbar:true,reverseSceneSets:false,autoDestroy:true},floats:{pelletsOpacity:0.15,fMouseSensitivity:1,desktopClickZoomScale:3,autoSpinSpeed:0,tableDiameter:950,maxZoom:100},integers:{hotspotDotRadius:4,zoomPrecision:1,minInstanceSize:60,quality:-1,},video:{strings:{skin:"black",base:"videos/",source:"",spinDirection:"right",sceneSet:0},integers:{captureFrames:120,frameOffset:0},floats:{captureOffsetStart:0,captureOffsetEnd:0,widthCorrectionFactor:1,heightCorrectionFactor:1,xCorrectionFactor:0,yCorrectionFactor:0}},camera:{strings:{position:"",targetPosition:"",armJointPosition:""},floats:{digitalCropFactor:1,focalLength:50,distanceToTableCenter:1500,heightAboveTable:500,heightTable:b,heightCamera:b,targetHeightOffset:0,targetWidthOffset:0,shiftX:0,armLength:0,armAngleMeasureSetup:0,armAngleStart:0,armAngleEnd:0}},virtualSpace:{strings:{position:""},floats:{cubeSizeX:100,cubeSizeY:100,cubeSizeZ:100,cubeLineWidth:1,baseRotationX:0,rotationXRange:180,baseRotationY:0,rotationYRange:360,baseRotationZ:0,shiftX:0,shiftZ:0,shiftY:0}}};if(gv==b){gv={}}gv.serverBase=fx.serverBase;cI(fx,gv,"",gw);cI(fx,gv,"camera",gw);cI(fx,gv,"virtualSpace",gw);cI(fx,gv,"video",gw);if(fI.enableHotspots){var o=fx.getUnrecognizedConfigNode("hotspots3d");cH(o)}b2="&effects=Matte("+encodeURIComponent(fI.imagemattecolor)+")"};var cH=function(gx){var gF={strings:{normalClass:"",hoverClass:"",activeClass:"",text:"",actionParameter:b,url:b,urlTarget:"_self",cssStyle:"",cssClass:""},booleans:{interactive:false},floats:{perimeterZoom:1,perimeterImageWidth:0,perimeterAngle:b,perimeterAngleRange:30,perimeterAngleFadeOut:10,perimeterAngleX:b,perimeterAngleXRange:30,perimeterAngleXFadeOut:10,perimeterAngleY:b,perimeterAngleYRange:30,perimeterAngleYFadeOut:10,verticalMarkerSize:100,horizontalMarkerSize:30,markerAngle:45,horizontalMarkerPosition:0,verticalMarkerPosition:0.5,perimeterDistance:b,perimeterTerminator:b,x:0,y:0,z:0}};var gz=[];var gy;var gD=new a.Config();if(fx.cfg.hotspots!=b&&fx.cfg.hotspots.length>0&&typeof(fx.cfg.hotspots.join)=="function"){c4.log("Using HotSpots from JS parameters");fI.hotspots={};fI.hotspots.defaults={};fI.hotspots.points=new Array(fx.cfg.hotspots.length);var gw=fx.cfg.hotspotsdefaults;if(gw==b){gw=fx.cfg.hotspotdefaults}if(gw!=b){gD.makeObjectPropertiesLowerCase(gw);gD.cfg=gw;gy={};cI(gD,gy,"",gF);for(var gv in gF){var gC=gF[gv];for(var gG in gC){if(gy[gG]!=b){gC[gG]=gy[gG]}}}var gw=gy;gy={};for(var gv in gw){if(gw[gv]!=b){gy[gv]=gw[gv]}}fI.hotspots.defaults=gy}for(var gB=0;gB<fx.cfg.hotspots.length;gB++){var gE=fx.cfg.hotspots[gB];gD.makeObjectPropertiesLowerCase(gE);gD.cfg=gE;var gE={};cI(gD,gE,"",gF);fI.hotspots.points[gB]=gE}}else{if(!gx){return}gx=gx.firstChild;while(gx){if(gx.nodeType!=1){gx=gx.nextSibling;continue}var gA=gx.nodeName.toLowerCase();switch(gA){case"hotspot":gz.push(gx);break;case"defaults":gy=d1(gD,gx,gF);break}gx=gx.nextSibling}if(gy!=b){for(var gv in gF){var gC=gF[gv];for(var gG in gC){if(gy[gG]!=b){gC[gG]=gy[gG]}}}var gw=gy;gy={};for(var gv in gw){if(gw[gv]!=b){gy[gv]=gw[gv]}}}if(gz.length>0){for(var gB=0;gB<gz.length;gB++){gz[gB]=d1(gD,gz[gB],gF)}fI.hotspots={};fI.hotspots.points=gz;fI.hotspots.defaults=gy}}if(fI.hotspots&&fI.hotspots.points){c4.log("HotSpots parsed: "+fI.hotspots.points.length);d7=(fI.hotspots.points.length>0)}else{d7=false}};var d1=function(gv,gy,gx){var o={};gy=gy.firstChild;while(gy){if(gy.nodeType!=1){gy=gy.nextSibling;continue}var gw=gv.getValueFromXMLNode(gy,"");o[gw.name]=gw.value;gy=gy.nextSibling}gv.cfg=o;var gz={};cI(gv,gz,"",gx);return gz};var fk=function(o){var gv=fI[o];if(gv==b){return}if(gv.indexOf("r")==-1&&gv.indexOf("#")!=0){fI[o]="#"+gv}};var dx=function(){b3(fI);fx.result=fI;var o=Math.PI/180;fI.virtualSpace.baseRotationXRad=fI.virtualSpace.baseRotationX*o;fI.virtualSpace.baseRotationYRad=fI.virtualSpace.baseRotationY*o;fI.virtualSpace.baseRotationZRad=fI.virtualSpace.baseRotationZ*o};var fQ=function(o,gE){c4.log("Video Dimension: "+o+" x "+gE+"px");var gA=eL.isCropped();var gB=false;var gv=eL.getCropMargins();var gy=ap.width;var gD=gy/o;var gC=gE*gD;var gz=Math.round((ap.height-gC)/2);if(gz>gv.top){gB=true;gv.top=gz}if(gz>gv.bottom){gB=true;gv.bottom=gz}if(gB){c4.log("Cropping images to match video dimension ("+gz+"px)");eL.setCropValues(gv.left+"px",gv.top+"px",gv.right+"px",gv.bottom+"px");n()}if(gA){gv=eL.getCropMargins();gv.scaleRectInt(1/gD);gz=Math.round(gz/gD);eK.left=gv.left;eK.right=gv.right;eK.top=gv.top-gz;eK.bottom=gv.bottom-gz}else{eK.setRect(0,0,0,0)}bg=b;bs();var gw=o-eK.left-eK.right;var gx=gE-eK.top-eK.bottom;cu={width:o,height:gE,croppedWidth:gw,croppedHeight:gx};k(gw,gx);dn();gq();if(b7&&fI.pellets&&fI.pelletsOpacity>0){b5()}};var k=function(gE,gT,gH){if(!fI||!fI.video||!fI.video.widthCorrectionFactor){return}var gF=0;var gD=0;var gG,gQ,gM,gy;if(!h){gM=aY.width;gy=aY.height}else{gM=gl;gy=cv}var gU=gE/gT;var gC=gM/gy;var gB,o;if(gU>gC){gB=gM}else{o=gy}bs();var gL=eL.getFloatRect();var gI=gL.getRange();var gK=a.getFSIServerImageDim(ap.width,ap.height,gB,o,gI,true);gG=gK.width;gQ=gK.height;if(gG>ek.width||gQ>ek.height){gG=ek.width;gQ=ek.height}bp=Math.min(gp,Math.round(gG));gF=Math.round((gM-gG)/2);gD=Math.round((gy-gQ)/2);U.widthForRatio=gE;U.heightForRatio=gT;U.imageWidth=gG;U.imageHeight=gQ;U.imageX=gF;U.imageY=gD;U.videoWidth=gG*fI.video.widthCorrectionFactor;U.videoHeight=gQ*fI.video.heightCorrectionFactor;U.videoX=gF+gG*fI.video.xCorrectionFactor-(gG*fI.video.widthCorrectionFactor-gG)/2;U.videoY=gD+gQ*fI.video.yCorrectionFactor-(gQ*fI.video.heightCorrectionFactor-gQ)/2;if(!gH){ay=bp;dZ(t)}dZ(aZ);if(!gH){var gL=eL.getImageRect();var gN;if(gL.width()>0){gN=ap.width/gL.width()}else{gN=0}var gz=Math.ceil(gN*t.imageWidth);if(ap.__levelsCalculatedFor!=gz){ap.__levelsCalculatedFor=gz;c4.log("Calculating image levels for image base width: "+gz+" px");c4.log("Source image dimension: "+ap.width+" x "+ap.height);var gJ=Math.ceil(1.1*gz);bd=new Array();if(gz>0){if(ap.levels&&ap.levels.length>0){var gS=new Array();for(var gO=0;gO<ap.levels.length;gO++){var gx=parseInt(ap.levels[gO].width);if(!isNaN(gx)){if(gx>gJ){gS.push(gx)}else{break}}}if(c4.on){c4.log("Matching server side image levels: "+gS.join(", "))}if(gS.length>0){gS.push(gz);var gw=gS[0];bd.push(gw);for(var gO=1;gO<gS.length;gO++){var gP=gS[gO];var gA=gw/gP;while(gA>2.5){gw/=2;gA=gw/gP;if(gw>gJ){bd.push(Math.round(gw))}}bd.push(gP);gw=gP}bd.pop();gS.pop();bd.reverse()}if(c4.on){var gR=(bd.length-gS.length);if(gR==0){c4.log("Using server side image levels only.")}else{c4.log("Using "+gR+" additional virtual image levels.")}}}else{c4.log("No image level information from server. Using virtual image levels.");var gv=ap.width;var gV=ap.height;if(gJ>0){while(gv>gJ&&gV>0){bd.push(gv);gv=Math.round(gv/2);gV=Math.round(gV/2)}}bd.reverse()}}if(c4.on){c4.log("Using image levels: "+bd.join(", "))}}a4()}switch(fp){case eQ:U.maxPanReferenceWidth=aY.width*ao.scale;U.maxPanReferenceHeight=aY.height*ao.scale;break;case aj:U.maxPanReferenceWidth=0;U.maxPanReferenceHeight=0;break;default:U.maxPanReferenceWidth=aZ.imageWidth;U.maxPanReferenceHeight=aZ.imageHeight;break}};var dZ=function(gv){for(var gw in U){gv[gw]=U[gw]}};var al=function(){var o=fI.video.source;if(o&&o.indexOf("[static]")==0&&fI.serverBase!=b){var gv=fI.serverBase;gv=gv.split("/");gv.pop();gv=gv.join("/");o=o.replace(/\[static\]\/*/,gv+"/static/")}return o};this.start=function(){dJ();if(cs){cs.destroy();cs=b}if(!fD){return}dX()};var dX=function(o){fI={};fx.loadConfigs()};var dv=function(){if(a.oSupportedViewers[ch.strClassName]==b){var gw=false;try{var gy=f2.getBoundingClientRect();gw=(!a.isInternetExplorer||a.versionInternetExplorer>8)}catch(gA){}a.oSupportedViewers[ch.strClassName]=gw}dx();ad();if(fx.hasPlugin("fullscreen")&&!fx.hasPlugin("resize")){fx.addPluginFromString("resize")}var gz=fI.enableZoom;h=(a.BrowserSupports.canvas());bH.enabled=false;q=false;if(gz&&a.BrowserSupports.canvas()){var gv=""+fI.inPlaceZoom;switch(gv.toLowerCase()){case"auto":bH.enabled=(!a.isMobileDevice);break;default:bH.enabled=fx.makeBool(gv,true);break}gv=""+fI.documentZoom;switch(gv.toLowerCase()){case"auto":q=(a.isTouch);break;default:q=fx.makeBool(gv,true);break}}d=false;var gv=""+fI.hideUI;gv=gv.toLowerCase();if((a.isMobileDevice&&gv=="onmobiledevices")||(!bH.enabled&&gv=="ifnoinplacezoom")||fx.makeBool(fI.hideUI)==true){d=true}a8=(!fI.noNav&&!d&&bH.enabled);if(h){ej=b}else{ej=a._FSITouchZoomInstance}if(h&&fx.hasPlugin("resize")){if(!f3){var o=a.addCustomEvent(f2,"FSIElementDimension",aS);a.setCustomEventListenerProperty(o,"treshold",250);f3=true}}else{if(f3){a.removeCustomEvent(f2,"FSIElementDimension",aS);f3=false}}if(fI.noCanvas){h=false}var gx=fI.skin;c4.log("Loading skin: "+gx+".css");if(fS){fS.remove()}if(a.oSupportedViewers[ch.strClassName]==true){fS=a.loadSkinCSS(gx,aX,cF);aM.name=fS.getSkinName();aM.className="fsi-skin-"+aM.name;f2.className="fsi-viewer-root "+aM.className}else{cF(false)}};var cF=function(gv,o){if(gv){c4.log("Skin loaded successfully. ")}else{c4.error("Failed to load skin.")}if(gv){ct(o)}dG()};this.getMenuHeight=function(gv){var o=bl;if(gv!=b){switch(gv){case"navWindow":if(d3.bFloatingNavWindow){o=0}break}}return o};var eP=function(o){if(typeof(o)!="string"){return o}if(o.indexOf("url(")!=0){return o}o=o.replace(/^url\(["'\s]*/,"");o=o.replace(/["'\s]*\)$/,"");if(o.indexOf("//")==-1){o=o.replace(/^\/*/,"");o=a._FSIViewerLocation+"/skins/"+o}return o};var ct=function(gx){if(aM._nameParsedLast!=aM.name){aM._nameParsedLast=aM.name;var gB="."+aM.className+" .";var gv=function(gG,gF,gE,gD){var gC=gx.getStyle(gB+gG,gF,gD);if(gC==b){gC=gE}return gC};d3=gv("fsi-ui-info","content",b,true);d3.bFloatingMenuBar=fx.makeBool(d3.floatingMenuBar);d3.bFloatingNavWindow=fx.makeBool(d3.floatingNavWindow);d3.hMenuBar=gv("fsi-ui-menu-bar","height");aM.cursors={};var gA=a._FSIViewerLocation+"/skins/resources/"+aM.name+"/";var gw=function(gD,gC){var gE=gv("fsi-ui-cursor-"+gD,"content");if(typeof(gE)!="string"){return gC}if(gE.indexOf(".")!=-1&&gE.indexOf("//")==-1){gE=gE.replace(/^[\/]*/,"");gE="url('"+gA+gE+"'),"+gC}return gE};aM.cursors.wait=gw("wait","progress");if(bH.enabled){aM.cursors.zoom=gw("zoom","crosshair")}else{aM.cursors.zoom="default"}aM.cursors.pan=gw("pan","move");aM.cursors.rotate=gw("rotate","ew-resize");aM.cursors.rotate3d=gw("rotate-3d","move");aM.navFrameBorderColor=gv("fsi-ui-nav-frame","border-color","red");aM.navFrameBackgroundColor=gv("fsi-ui-nav-frame","background-color","rgba(255,255,255,0.5)");am=gv("fsi-ui-select-frame","border-color","red");a7=gv("fsi-ui-select-frame","background-color","rgba(255,255,255,0.25)");aM.oProgressBarStyle={};aM.oProgressBarStyle.color=gv("fsi-ui-progressbar","color","#CCC");aM.oProgressBarStyle.background=gv("fsi-ui-progressbar","background-color","#FFF");aM.oProgressBarStyle.border=gv("fsi-ui-progressbar","border-color","#CCC");aM.oProgressBarStyle.text=gv("fsi-ui-progressbar-text","color","#555");aM.urlLogo=eP(gv("fsi-ui-logo-url","background-image"));var gz=16;var o=8;if(d3){if(!isNaN(d3.baseSize)&&d3.baseSize>0){gz=d3.baseSize}if(!isNaN(d3.baseEnlargement)&&d3.baseEnlargement>0){o=d3.baseEnlargement}}else{d3={}}var gy=1;if(fI.adaptiveUISize==true){gy=a.getDevicePixelRatio()}Z=Math.round(gz+o*gy);d3._baseSkinSize=Z}f2.style.fontSize=Z+"px"};var dG=function(){if(typeof(d3.hMenuBar)!="string"||d3.hMenuBar.length<1||isNaN(parseFloat(d3.hMenuBar))){cp=false}else{cp=(a.oSupportedViewers[ch.strClassName]==true&&d!=true)}if(cp){i()}else{bl=ca=0;dw()}};var dw=function(){if(cs){bl=cs.getHeight()}if(d3&&d3.bFloatingMenuBar){ca=0}else{ca=bl}ad();ba()};var i=function(){if(e9==b){if(a._FSIViewerLocation!=b){e9=new a.ToolTip(f2)}}e2();if(cs){cs.destroy()}cs=new a.MenuBar(f0,aM,dw)};var e2=function(){if(e9!=b){var gv=fI.language;var gw=gv+".xml";var o=a._FSIViewerLocation+"/languages/"+gw;if(o!=fX){bZ=o;c4.log("Loading language file: "+o);fx.loadFile(o,e7,"application/xml")}}};var ed=function(){if(!cs){return}var gx;var gv=[];gv.push({cmd:"Reset"});if(bH.enabled==true){gv.push({cmd:"ZoomOut",enabled:false});gv.push({cmd:"ZoomIn"})}if(fx.hasPlugin("mousemodes")||fx.hasPlugin("mousemodeselect")){var gA=fx.getPluginParameter("mousemodes","sequence","0,1,3,2");gA=gA.split(",");var gy=[];for(var gw=0;gw<4;gw++){gy[gw]=fx.getPluginParameter("mousemodes","mode"+gw,true,true)}if(!bH.enabled){gy[0]=gy[1]=false}var gz=function(gB){if(isNaN(gB)||gB<0||gB>2){return}if(!gy[gB]){return}if(gB==2&&ga.length<2){return}var gC=true;if(gB==1){gC=(fp>er)}gv.push({cmd:"MouseMode_"+gB,groupID:"MouseMode",enabled:gC})};for(var gw=0;gw<gA.length;gw++){gz(parseInt(gA[gw]))}}if(fx.hasPlugin("maxzoom")&&bH.enabled){gv.push({cmd:"MaxZoom"})}if(d7){if(!fx.hasPlugin("hotspots")){fx.addPluginFromString("hotspots")}if(fx.getPluginParameter("hotspots","button","true",true)){gv.push({cmd:"Hotspots",bCheckButton:true})}cR=fx.getPluginParameter("hotspots","visible","true",true)}if(a.FullScreen.getAvailable(f2)&&fx.hasPlugin("fullscreen")){if(a.bFullScreenFSIViewerCSSAdded!=true){a.bFullScreenFSIViewerCSSAdded=true;var o=".fsi-viewer-root"+a.FullScreen.getFullscreenPseudoClass();a.addCSSRule(o,"position:absolute!important;left:0px!important;top:0px!important;width:100%!important;height:100%!important;",0)}gv.push({cmd:"FullScreen",bCheckButton:1})}cs.addButtons(gv);if(d7&&cR){cs.setButtonPressed("Hotspots",true)}};var eY=function(){var o;if(!q){o=Math.round(Math.max(1,gu)*Math.max(aY.width,aY.height))}else{o=Math.round(Math.max(1,gu)*Math.max(screen.width,screen.height))}eV=Math.min(1024,Math.max(2,Math.ceil(o/3/128))*128)};var ba=function(){var gx=fx.parsePositionParameter(fI.virtualSpace.position);if(gx!=b){fI.virtualSpace.shiftX=gx.x;fI.virtualSpace.shiftY=gx.y;fI.virtualSpace.shiftZ=gx.z}if(fx.cfg.cameraarmanglestart!=b){fI.virtualSpace.baseRotationX=fI.camera.armAngleStart;if(fx.cfg.cameraarmangleend!=b){fI.virtualSpace.rotationXRange=fI.camera.armAngleEnd-fI.camera.armAngleStart}}if(fI.useDevicePixelRatio){gu=a.getDevicePixelRatio()}else{gu=1}eY();eL=new a.CroppedImage();eL.setCropFromConfig(fx.cfg);switch(fI.panLimits){case"loose":fp=aj;break;case"medium":fp=er;break;default:fp=eQ;break}m();ex=true;if(fI.noSceneLoop){gn=aQ}else{gn=ep}E=fI.virtualSpace.rotationYRange*-Math.PI/180;aO.rotXRange=fI.virtualSpace.rotationXRange;aO.rotXGradPerSet=(aO.rotXRange/(aO.nSceneSets-1))*Math.PI/180;if(eZ!=b){var gw=eZ;eZ=b;aX.changeImage.apply(aX,gw);return}var gv=fI.dir;if(!gv||gv.length==0){var o=fx.getImageList();if(o){bt(o.arImages,o.oXML,o)}else{return cJ()}}else{var o=fx.loadImageList(gv,bt,bU);if(c4.on&&typeof(o._url)=="string"){c4.log("Loading image list: "+o._url)}}};var bt=function(o,gw){if(!o||o.length<1){c4.error("Failed to load image list.");return cJ()}du();ga=o;bj=ab=o.length;aO=fx.parseSceneSets(ga.length,false);c4.log("Image list ready ("+ga.length+" images)");if(ga.length>0){var gv=fx.getImageInfoURL(ga[0]);fx.loadFile(gv,bw)}else{be()}};var el=function(){if(!dy||aO.nSceneSets<1){return}if(aO.bSetCameraPosition){return}aO.bSetCameraPosition=true;var gB=new THREE.Vector3();var gv=new THREE.Vector3();var gG=new THREE.Vector3();var gE=new THREE.Object3D();var gw=new THREE.Object3D();gE.add(gw);var gH=new THREE.Object3D();gw.add(gH);var gA=180/Math.PI;var gK;var gL;var gM=dh.targetObj.position;gw.rotation.set(0,0,0);gG.set(0,gM.y,gM.z);if(fx.cfg.cameraarmlength==b){gL=dh.camera.position.distanceTo(gM)}else{gL=fI.camera.armLength}var gD=fx.parsePositionParameter(fI.camera.armJointPosition);if(gD==b){gw.position.set(gM.x,gM.y,gM.z)}else{gw.position.set(gD.x,gD.y,gD.z)}gw.rotation.x=fI.camera.armAngleMeasureSetup/gA;gE.rotation.set(0,0,0);gH.rotation.set(0,0,0);gH.position.set(0,0,gL);gE.updateMatrixWorld();gv.getPositionFromMatrix(gH.matrixWorld);var gJ=fI.virtualSpace.baseRotationX;var gC=fI.virtualSpace.rotationXRange/(aO.nSceneSets-1);if(fI.reverseSceneSets){gJ+=fI.virtualSpace.rotationXRange;gC=-gC}c4.log("Calculated Camera Positions:");c4.log("----------------------------");var o=180/Math.PI;for(var gF=0;gF<aO.nSceneSets;gF++){var gx=aO.arSets[gF];gx.cameraArmAngle=gJ;gw.rotation.x=gJ/gA;gE.updateMatrixWorld();gB.getPositionFromMatrix(gH.matrixWorld);gx.posCamera=new THREE.Vector3(dh.camera.position.x+gB.x-gv.x,dh.camera.position.y+gB.y-gv.y,dh.camera.position.z+gB.z-gv.z);gB.x=0;gx.xAngleToTarget=gG.angleTo(gB)-Math.PI/2;gx.xAngleToTargetDeg=gx.xAngleToTarget*o;if(c4.on){c4.log("SceneSet "+(gF+1)+", arm angle "+gJ+"Â°, angle to target: "+gx.xAngleToTargetDeg+"Â°, position (x,y,z): "+gx.posCamera.x+", "+gx.posCamera.y+", "+gx.posCamera.z)}if(d7){gx.visibleHotSpots={};for(var gI=0;gI<fI.hotspots.points.length;gI++){var gy=fI.hotspots.points[gI];var gz=1;if(gy.perimeterAngleX!=b){var gN=Math.abs(gy.perimeterAngleX-gx.xAngleToTargetDeg);if(gN>180){gN=Math.abs(360-gN)}if(gN<gy.perimeterAngleXRange){if(gN>gy.perimeterAngleXRange-gy.perimeterAngleXFadeOut){gz=(gy.perimeterAngleXRange-gN)/gy.perimeterAngleXFadeOut}}else{gz=0}gx.visibleHotSpots[gy.FSIHotspotID]=gz}}}gJ+=gC}};var di=function(){if(aO.bDefault){return}var gy=100000000;var gD=0;var gF;if(c4.on){gF=a.cloneObject(aO.arSets)}var gE={};for(var gz=0;gz<aO.arSets.length;gz++){var gC=aO.arSets[gz].arScenes;for(var gx=0;gx<gC.length;gx++){var gA=gC[gx]=gC[gx]-1;gE[gA]=ga[gA]}}var gB=[];var gw=e.length;for(var gv in gE){gB.push(gE[gv]);gE[gv]=gw;gw++}for(var gz=0;gz<aO.arSets.length;gz++){var gC=aO.arSets[gz].arScenes;for(var gx=0;gx<gC.length;gx++){gC[gx]=gE[gC[gx]]}gy=Math.min(gy,gC.length);gD=Math.max(gD,gC.length)}if(aO.arSets[0].arScenes.length>0){aO.quantizeMin=gy;aO.quantizeMax=aO.quantizeMaxImages=gD;if(c4.on){c4.log('Using SceneSets Parameter: "'+fx.cfg.scenesets+'"');c4.log("Parsed SceneSets:");for(var gz=0;gz<gF.length;gz++){c4.log("Scene "+(gz+1)+": "+gF[gz].arScenes.join(", "))}}ga=gB;if(aO.arSets.length>1){if(gy!=gD){aO.bQuantize=true}if(c9!=b&&c9>0){aO.quantizeMax=Math.max(aO.quantizeMax,c9);if(gD!=aO.quantizeMax){aO.bQuantize=true}}}}else{aO.bDefault=true;aO.bHasMultipleSets=false;c4.error('Invalid SecenSet definition: "'+fx.cfg.scenesets+'"')}};var aV=function(){var gx=100000000;var o=0;for(var gw=0;gw<aO.arSets.length;gw++){var gv=aO.arSets[gw].arScenes;gx=Math.min(gx,gv.length);o=Math.max(o,gv.length)}return{min:gx,max:o}};var fh=function(){var gD=aO.quantizeMax;for(var gy=0;gy<aO.arSets.length;gy++){if(gy==aO.nVideoSet){continue}var gC=aO.arSets[gy].arScenes;if(gC.length<gD){var gB=gC.length;var gv=gD-gB;var gA=aO.arSets[gy].oSpinPositions={};for(var gx=0;gx<gB;gx++){var gz=gC[gx];gA[gz]=Math.round(gx*gD/gB)}aO.arSets[gy].fQuantizeFactor=gD/gB;var o=gB-1;var gw=new Array(gD);for(var gx=0;gx<gD;gx++){var gz=(gx*o/(gD-1));gw[gx]=gC[Math.round(gz)]}aO.arSets[gy].arScenes=gw}else{aO.arSets[gy].oSpinPositions=false}}};var cJ=function(){bB("default");if(cs){cs.setEnabled(false)}};var bw=function(gv,o){ap=o;ap.transparency=fx.makeBool(ap.alpha);ap.width=parseInt(ap.width);ap.height=parseInt(ap.height);if(fI.fpxservertemplate!=b){eA.renderer=fI.fpxservertemplate}if(fI.headers!=b){eA.headers=fI.headers}dj=(ap.transparency&&!fI.preventImageTransparency);if(dj){if(h){bc=fI.useMaskedJPEGs}else{var gw=fx.cfg.fpxservertemplate;if((fI.video==b||!fI.video.source.length)&&(gw==b||gw=="jpeg")){eA.renderer="png"}}}gi=(!dj||!bc);if(typeof(ap.levels)=="object"&&typeof(ap.levels.sort)=="function"){ap.levels.sort(aE)}else{ap.levels=b}eL.setSourceDimension(ap.width,ap.height);n();k(ek.width,ek.height);dn();be()};var aE=function(gv,o){return o.width-gv.width};var dn=function(){if(eL.isCropped()){var gv=eL.getImageRect();var o=gv.width()/U.imageWidth;aI.cropScaleX=ap.width/gv.width();aI.cropScaleY=ap.height/gv.height();aI.x=(gv.left+gv.width()/2-ap.width/2)/o;aI.y=(gv.top+gv.height()/2-ap.height/2)/o}else{aI.cropScaleX=1;aI.cropScaleY=1;aI.x=0;aI.y=0}};var n=function(){var o;if(eL.isCropped()){o=eL.getPixelRangeRect();ek.width=o.right;ek.height=o.bottom}else{ek.width=ap.width;ek.height=ap.height;o=new a.Rect(0,0,ek.width,ek.height)}};var be=function(){fO();dy=false;bo=false;var o=true;if(a.BrowserSupports.canvas()){if(fI.drawCube||fI.drawGroundPlate||fI.drawTable){bo=dy=true}if(!dy&&fI.enableHotspots){if(fI.hotspots&&fI.hotspots.points&&fI.hotspots.points.length>0){dy=true}}var gv="js/three_custom_min.js";if(a._FSIViewerLocation!=b){gv=a._FSIViewerLocation+"/applications/viewer/"+gv}o=false;if(dy){if(typeof(window.THREE)=="object"){o=true}else{if(!a.loadJavascript(gv,dl,aX,eq)){o=true;dy=false}}}else{a.releaseLoadJavascript(gv,dl);o=true}}if(!dy){bo=false}if(o){c5()}};var eq=function(o,gw,gv){if(typeof(window.THREE)!="object"){dy=false}if(!dy){bo=false}c5()};var c5=function(){if(fI.video.spinDirection&&fI.video.spinDirection.toLowerCase()=="left"){fI._reverseVideoDirection=true}if(fI.spinDirectionImage!=b){if(fI.spinDirectionImage.toLowerCase()=="left"){fI._reverseImageDirection=true}}else{fI._reverseImageDirection=fI._reverseVideoDirection}if(!aO.bDefault){if(fI._reverseImageDirection){for(var o=0;o<aO.arSets.length;o++){aO.arSets[o].arScenes.reverse()}fI._reverseImageDirection=false}if(fI.reverseSceneSets){aO.arSets.reverse()}}if(fI._reverseImageDirection){ga.reverse();ga.unshift(ga.pop())}f=al();cw();ed();if(d7){fo(true)}else{fo(false)}if(fu){fd()}};var e7=function(o,gx){fX=bZ;if(gx){de={};var gw=fx.findXMLNode(gx,"data");if(gw){gw=fx.findXMLNode(gw,"tip")}while(gw){if(gw.nodeType==1){var gy=gw.getAttribute("id");var gv=fx.XMLChildNodesToString(gw);de[gy]=gv}gw=gw.nextSibling}e9.setContent(de)}};var cd=function(){if(cs&&d4!=b){cs.setButtonPressed("MouseMode_"+d4,true)}if(a8){cy()}};var cw=function(){if(ek.width){gp=Math.min(cg,ek.width)}else{gp=cg}a4()};var a4=function(){bH.scaleToSourceImage=Math.max(1,ek.width/aZ.imageWidth);bH.maxScale=bH.maxScaleInitial=fI.maxZoom/100*bH.scaleToSourceImage;bH.defaultZoom=Math.min(fI.desktopClickZoomScale,bH.maxScale)};this.destroyOnDetach=function(){if(fI&&fI.autoDestroy!=false){fj()}};var fj=this.destroy=function(){ai.removeAttribute("x-fsi-id");a.removeClass(ai,"fsi-viewer");if(l){l.destroy()}if(fS){fS.remove();fS=b}if(bh!=b){a.removeCustomEvent(f2,"FSIMouseWheel",e1);bh=b}if(z!=b){a.removeCustomEvent(gj,"FSIDocumentZoomChange",dr);z=b}if(en!=b){a.removeCustomEvent(et,"FSIViewport",aW);en=b}if(f3){a.removeCustomEvent(f2,"FSIElementDimension",aS);f3=false}if(dA){clearTimeout(dA);dA=b}M();if(e9){e9.destroy();e9=b}if(cs){cs.destroy();cs=b}dJ();if(F){F.destroy();F=b}fD=false;fz();if(f2){if(fu){a.removeChild(et,fu);a.removeChild(f2,et);fu=b}if(f2.parentNode==ai){a.removeChild(ai,f2)}f2=b}if(T){a.removeChild(T.parentNode,T);T=b}if(gj){if(!a.isMobileDevice){a.removeEvent(gj,"keydown",cz);a.removeEvent(gj,"keyup",bV)}a.removeChild(gj.parentNode,gj);gj=b}cZ=true};var m=function(){if(!aY||aY.width<10||aY.height<10){return false}if(gj==b){gj=document.createElement("div");gj.className="fsi-event-overlay";var gv=";-webkit-user-drag: none; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;";if(a.isInternetExplorer){a.setStyleAttr(gj,"position:absolute;z-index:300;background-color:rgba(0,0,0,0)"+gv)}else{a.setStyleAttr(gj,"position:absolute;z-index:300"+gv)}bB("wait");if(!a.isMobileDevice){gj.setAttribute("tabIndex","0")}f2.appendChild(gj);if(!F){var gw={};gw.detectGestures=true;gw.afterTouch={enabled:true};gw.afterTouch.modifyTarget=L;gw.afterTouch.fnGetAfterTouchEnabled=a3;gw.afterTouch.fnStartStopAfterTouch=G;if(bH.enabled){gw.detectClick=true;gw.onPinchStart=p;gw.onPinchChange=dp;gw.onPinchEnd=fZ}F=new a.TouchHandler(gj,gw,dT,S,e3)}if(!a.isMobileDevice){a.addEvent(gj,"keydown",cz);a.addEvent(gj,"keyup",bV)}if(bH.enabled){bh=a.addCustomEvent(f2,"FSIMouseWheel",e1)}else{if(bh!=b){a.removeCustomEvent(f2,"FSIMouseWheel",e1);bh=b}}if(bH.enabled){if(z==b){z=a.addCustomEvent(gj,"FSIDocumentZoomChange",dr);a.triggerCustomEvent(z)}}else{if(z){a.removeCustomEvent(gj,"FSIDocumentZoomChange",dr);z=b}if(F){F.enable(true)}}}if(T==b&&d7){T=document.createElement("div");a.setStyleAttr(T,"position:absolute;z-index:4;");gj.appendChild(T)}if(T){eB(T,false)}if(fu==b||fu.FSIisCanvas!=h){if(fu!=b&&fu.FSIisCanvas!=h){a.removeChild(f2,fu);ff=fu=bx=b}et=document.createElement("div");et.setAttribute("draggable","false");a.setStyleAttr(et,"position:absolute;overflow:hidden;width:100%;height:100%;overflow:hidden");if(h){fu=document.createElement("canvas")}else{fu=document.createElement("div")}et.appendChild(fu);f2.appendChild(et);var o="z-index:1;position:absolute;transform-origin:0px 0px;	-webkit-transform-origin:0px 0px;	-ms-transform-origin:0px 0px;";o+="backface-visibility: hidden;-webkit-backface-visibility: hidden;";a.setStyleAttr(fu,o);if(h){b7=fu.getContext("2d");c6=b7.webkitBackingStorePixelRatio||b7.mozBackingStorePixelRatio||b7.msBackingStorePixelRatio||b7.oBackingStorePixelRatio||b7.backingStorePixelRatio||1;if(!d5){fu.style.width=fu.style.height=""}}else{fu.style.textAlign="left"}fu.FSIisCanvas=h}if(typeof(fI.backgroundColor)=="string"&&fI.backgroundColor.toLowerCase()=="none"){fI.backgroundColor="transparent"}f2.style.backgroundColor=fI.backgroundColor;if(!h){if(ff==b){ff=bx;bx=b}if(bx!=b){a.removeChild(bx.parentNode,bx)}bx=document.createElement("img");if(ff!=b){bx.style.display="none"}fu.appendChild(bx)}if(h){if(en==b){en=a.addCustomEvent(et,"FSIViewport",aW);a.setCustomEventListenerProperty(en,"treshold",350)}}else{if(en!=b){a.removeCustomEvent(et,"FSIViewport",aW);en=b}aR.setRect(0,0,aY.width,aY.height)}gl=fu.width=aY.width*ao.scale;cv=fu.height=aY.height*ao.scale;fu.lastOffsetX=fu.lastOffsetY=0;if((a.BrowserSupports.documentZoom()&&!a.isMobileDevice)||(a.isMobileDevice&&!h)){e4=true}db(aY.width,aY.height);dW();return true};this.onVisibilityChanged=function(){if(en){a.triggerCustomEvent(en)}};var p=function(o,gx,gw){if(bH.maxScale<=1){eH.bActive=false;return}eH.bActive=true;eH.lastX=gx.x;eH.lastY=gx.y;eH.distanceStart=o._FSI_PinchDistance;var gv=a.getElementPosition(gj);eH.offsetX=-gv.left-aY.width/2;eH.offsetY=-gv.top-aY.height/2;eH.startZoom=bH.scale;aF(false)};var dp=function(gB,gz,gC){if(!eH.bActive){return}var gx=gB._FSI_PinchDistance;var gw=gz.x-eH.lastX;var o=gz.y-eH.lastY;eH.lastX=gz.x;eH.lastY=gz.y;var gE=eH.startZoom*gB._FSI_PinchScale;gE=Math.max(1,Math.min(bH.maxScale,gE));var gD=gE*100/bH.maxScale;var gA=gz.x+eH.offsetX;var gy=gz.y+eH.offsetY;var gv=gE/bH.scale;bH.panPos.left-=gA;bH.panPos.top-=gy;bH.panPos.left*=gv;bH.panPos.top*=gv;bH.panPos.left+=gA;bH.panPos.top+=gy;bH.panPos.left+=gw;bH.panPos.top+=o;aX.setZoom(gD,true,false)};var fZ=function(o,gx,gw){if(!eH.bActive){return}eH.bActive=false;aF(true);var gv=bH.scale*100/bH.maxScale;aX.setZoom(gv,false,false)};var H=function(gw){var gv=gw;var o=a.getDevicePixelRatio();if(o<1||fI.useDevicePixelRatio){gw=o*gw}if(eM!=gw){eM=gw;bH.maxScale=Math.max(1,bH.maxScaleInitial/gw);dd();bR=gw;if(d7){if(ee!=bR){ee=bR;dg=true}if(!bM){gh()}}}};var aW=function(o){bG=o.FSI_viewport_rect;H(o.FSI_scale);if(!b0){return}r(o.FSI_after_treshold)};var dr=function(o){ey()};var ey=function(){if(fI.autoDisablePointerActions){var o=(aX.getInFullScreenMode()||(ae.width<=window.innerWidth&&ae.height<=window.innerHeight));if(o!=fJ){fJ=o;F.enable(o);if(fs){fs.enable(o)}}}};var aH=function(){return(cG&&(!F||!F.isAfterTouchRunning()))};var e1=function(gC){if(gC.preventDefault){gC.preventDefault()}v();bu();var gD=aH();if(bM||gD){return}if(bH.maxScale<=1){return}var gB=gC.FSI_weighted_delta;cb=F.getMousePositionClient(gC);var gA=a.getElementPosition(gj);var gw=1+Math.abs(gB)/6;if(gB<0){gw=1/gw}var gE=Math.max(1,Math.min(bH.maxScale,bH.scale*gw));var gz=cb.x*ao.scale-gA.left-aY.width*ao.scale/2;var gy=cb.y*ao.scale-gA.top-aY.height*ao.scale/2;var o=gE/bH.scale;var gx=bH.panPos.left-gz;var gv=bH.panPos.top-gy;gx*=o;gv*=o;gx+=gz;gv+=gy;ef(gx,gv,gE,13);if(fs&&fs.isDragging()){bH.lockPanAnimation=true}gC.cancelBubble=true};var G=function(o){fU=o;if(o){gh()}};var d6=function(){if(!fI.showProgressbar){return}if(ga.length<2){ds=b;ar=false;return}if(!h){return}var gv=aY.width/3;var o=(aY.width-gv)/2;var gw=aY.height-26;ds=new a.CanvasProgressBar(b7,o,gw,gv,14,aM.oProgressBarStyle);cj()};var cj=function(){if(!ds){return}var gv=aY.width/3*ao.scale;var o=(bR*aY.width-gv)/2;var gw=bR*aY.height-26;ds.setPos(o,gw)};var fd=function(){ck=(typeof(aX.onProgress)=="function");ce(0);var gz=false;az=(!a.isMobileDevice&&(a.isOpera||a.isInternetExplorer));d6();bB("wait");var gB="";if(f.indexOf("//")==-1){gB=fI.video.base}if(!h||a.isMobileDevice||!f){c4.log("Using image sequence w/o video.");return cN()}var gF=fI.video.captureOffsetStart;if(gF==b||isNaN(gF)){gF=0}var gx=fI.video.captureOffsetEnd;if(gx==b||isNaN(gx)){gx=0}var gA;var gH=fI.video.captureFrames;if(gH==b||isNaN(gH)){fI.video.captureFrames=120}if(aO.nSceneSets>1){var gC=aV();fI.video.captureFrames=Math.max(fI.video.captureFrames,gC.max)}else{fI.video.captureFrames-=fI.video.captureFrames%ga.length;fI.video.captureFrames=Math.max(fI.video.captureFrames,ga.length)}var gG=document.createElement("canvas");gG.setAttribute("webkit-playsinline","");var gD=gG.getContext("2d");if(!c1){c1=document.createElement("canvas");go=c1.getContext("2d")}var gH=gB+f;if(a.isInternetExplorer&&a.versionInternetExplorer<10&&a.isCrossDomain(gH)){c4.error("CROSS DOMAIN VIDEO ACCESS not possible with this browser.");c4.log("Falling back to using image sequence.");return cN()}c4.log("Capture "+fI.video.captureFrames+" video frames");dk=document.createElement("video");dk.setAttribute("muted","muted");dk.setAttribute("preload","auto");dk.setAttribute("webkit-playsinline","");dk.setAttribute("crossorigin","anonymous");a.setStyleAttr(dk,"position:absolute;z-index:10000;width:1px;height:1px");dk.style.marginLeft=aY.width/2+"px";dk.style.marginTop=aY.height/2+"px";if(!a.isSafari&&!a.isInternetExplorer){var gw=document.createElement("source");gw.setAttribute("src",gB+f+".webm");dk.appendChild(gw)}var gv=document.createElement("source");gv.setAttribute("src",gB+f+".mp4");dk.appendChild(gv);if(!a.isSafari&&!a.isInternetExplorer){var o=document.createElement("source");o.setAttribute("src",gB+f+".ogv");dk.appendChild(gv)}f2.appendChild(dk);dk.FSIEvents={};var gE=function(gJ,gK,gI){dk.FSIEvents[gJ]={fn:gK,phase:gI};a.addEvent(dk,gJ,gK,gI)};gE("error",function(gI){if(dk.networkState==dk.NETWORK_NO_SOURCE){c4.error('Failed loading the video: "'+f+'"');c4.log("Falling back to using image sequence w/o video.");cN()}},true);gE("loadedmetadata",function(gJ){bM=true;dP("video");var gK=dk.videoWidth;var gI=dk.videoHeight;dk.setAttribute("width",gK);dk.setAttribute("height",gI);gA=(dk.duration-gF-gx)/fI.video.captureFrames;fQ(gK,gI);gG.setAttribute("width",cu.croppedWidth);gG.setAttribute("height",cu.croppedHeight);c1.setAttribute("width",cu.croppedWidth);c1.setAttribute("height",cu.croppedHeight);cd();f7()},true);gE("canplaythrough",function(gI){if(!gz){gz=true;this.currentTime=Math.max(0,gF)}},true);var gy=0;gE("seeked",function(gI){if(!bM){return}var gJ=dk.duration;if(a.isInternetExplorer){gJ-=0.3}if(e.length<fI.video.captureFrames){try{gD.drawImage(gI.target,0,0,cu.width,cu.height,-eK.left,-eK.top,cu.width,cu.height);var gL=gD.getImageData(0,0,gG.width,gG.height);e.push(gL)}catch(gK){c4.error('Failed capturing the video: "'+f+'"');c4.log("REASON: "+gK.message);c4.log("Falling back to using image sequence w/o video.");bM=false;cN();return}ce(100*e.length/fI.video.captureFrames);bO(e.length-1);gh();gy=Math.min(gJ,gA*e.length+gF);if(az){dA=setTimeout(function(gM){dk.currentTime=gy},1)}else{dk.currentTime=gy}}else{cE()}},true)};var au=function(o){if(!eb){return}fy("autoSpin");clearInterval(eb);eb=0;if(o){d9()}};var fe=function(){var o=d0+gg;if(o>=dR){o-=dR}else{if(o<0){o+=dR}}bO(o);gh()};var aJ=function(o){dR=o;eN=160/dR*4/fI.fMouseSensitivity;dc=dR/120};var fF=function(){var o;if(!aO.bDefault&&aO.nSceneSets>1){o=Math.max(1,Math.min(aO.nSceneSets,fI.video.sceneSet))-1;if(fI.reverseSceneSets){o=(-(o+1)+aO.nSceneSets)%aO.nSceneSets}}return o};var cE=function(){if(fI._reverseVideoDirection){e.reverse();e.unshift(e.pop())}bd.unshift(t.imageWidth);if(e.length>0){aO.nVideoSet=fF()}else{aO.nVideoSet=b}if(aO.nVideoSet!=b){var o=f5;cN();f5=o}else{di();bE()}};var bE=function(){ce(100);if(bN!=b){fn=bN}if(aO.bQuantize){fh()}bO(0);ar=false;br=dy;b6=b;if(fI._reverseImageDirection&&fs){fs.reverseImageSequence()}if(ej){gh()}dN();if(ds){ds=b}a5();if(dR>1||aO.nSceneSets>1){u=false;if(a.isIETouch){if(aO.nSceneSets>1){gj.style.msTouchAction="pinch-zoom double-tap-zoom"}else{gj.style.msTouchAction="pan-y pinch-zoom double-tap-zoom"}}if(fI.autoSpinSpeed!=0){bD("autoSpin");if(fI.autoSpinSpeed<0){fI.autoSpinSpeed=-fI.autoSpinSpeed;gg=-1}else{gg=1}var gv=fI.autoSpinSpeed*1000/dR;if(gv==0){gv=1}while(gv<20&&Math.abs(gg)<dR/2){gv*=2;gg*=2}gv=Math.max(20,Math.ceil(gv));eb=setInterval(fe,gv)}}else{u=true;if(a.isIETouch){gj.style.msTouchAction=b}if(!bH.enabled){bB("default")}}var gv=fI.initialMouseMode;if(gv!="auto"){gv=parseInt(gv)}ez(gv);bM=false;var o=b;if(fI.video.frameOffset&&f5){o=d0+fI.video.frameOffset;o=gn(dR+o);bO(o)}bL();b0=true;if(cs){cs.setEnabled(true)}if(c!=b){f6(c,(ga.length>1));c=b}else{if(fI){if(fI.initialview!=b&&fI.initialview.length>0){if(!f6(fI.initialview,false)){fI.initialview=b}else{fI.initialview=ci(fI.initialview)}}else{fI.initialview=b}}}if(typeof aX.onReady=="function"){aX.onReady(aX)}bQ();if(bH.enabled){bF()}if(!bH.enabled){if(u){F.setCapture(false,false)}else{F.setCapture(true,false)}}if(en){a.triggerCustomEvent(en);r(true)}};var cN=function(){gm();c9=e.length;dP("image");f7();di();fI.pellets=false;dN();k(ek.width,ek.height);cd();eI()};var cY=function(){a.removeEvent(bx,"load",cY);if(ff!=b&&ff.parentNode!=b){a.removeChild(ff.parentNode,ff);ff=b}bx.style.display="inline";fu.style.paddingLeft=U.imageX+"px";fu.style.paddingTop=U.imageY+"px"};var eI=function(){bM=true;gq();if(!h){bx.width=U.imageWidth;bx.height=U.imageHeight;a.addEvent(bx,"load",cY,true);if(ff==b){try{fu.style.paddingLeft=fu.style.paddingRight="auto";fu.style.paddingTop=fu.style.paddingRight="auto"}catch(gv){}}}if(c1){c1.setAttribute("width",U.imageWidth);c1.setAttribute("height",U.imageHeight)}var o=eo=new Image();o.FSI_nImage=0;a.addEvent(o,"load",fM);fi(o,fY(o.FSI_nImage).fullURL)};var fi=function(o,gv){if(!bc){o.FSI_image_context=o;a.loadImageCors(o,gv)}else{var gx=gv;gx+=b2;o.FSI_image_context=o;o.FSI_url=gx;var gw=o._FSI_alpha_mask=new Image();gw.FSI_my_img=o;gw.crossOrigin="anonymous";a.addEvent(gw,"load",c0);gv=a.changeRendererInURL(gv,"png.alpha");gw.src=gv}};var c0=function(){a.removeEvent(this,"load",c0);var o=this.FSI_my_img;o.FSI_alpha_channel=this;a.loadImageCors(o,o.FSI_url)};var b4=function(gw){if(!gw){return}if(gw.FSI_alpha_channel){var gv=gw.width;var gy=gw.height;var gx=gw.FSI_image_context=document.createElement("canvas");gx.setAttribute("width",gv);gx.setAttribute("height",gy);gx.setAttribute("crossorigin","anonymous");var o=gx.getContext("2d");o.drawImage(gw.FSI_alpha_channel,0,0,gv,gy);o.globalCompositeOperation="xor";o.drawImage(gw,0,0,gv,gy);gw.FSI_alpha_channel=b}};var ce=function(o){W=o;if(ds){ar=true}if(ck){aX.onProgress(o)}};var fM=function(o){if(!eo){return}b4(eo);if(h){e.push(eo)}else{e.push(eo.src)}ce(100*(e.length-c9)/ga.length);bO(e.length-1);gh();if(++eo.FSI_nImage>=ga.length){af();if(ej){ej.addImage(bx)}bE();return}var gv=eo;if(h){a.removeEvent(eo,"load",fM);var gw=eo.FSI_nImage;gv=eo=new Image();gv.FSI_nImage=gw;a.addEvent(gv,"load",fM)}fi(gv,fY(gv.FSI_nImage).fullURL)};var af=function(){if(eo==b){return}a.removeEvent(eo,"load",fM);eo=b};var f8=function(o){var gv=gn(Math.round(o));if(gv!=gn(d0)){dd();bO(gv);gh()}dF=o};var bD=function(o){if(gs){return}D=P;P=true;gs=true;M();cC=false;M();y=false};var fy=function(o){if(!gs){return}P=D;bO(gn(d0));gs=false;cC=true;y=true;if(!cS||d0!=cS.spinPos){if(cS){eJ()}eE()}else{cx(50)}};var bO=function(o){d0=dF=o;if(!aK){cU=d0}else{cU=aK[d0]}};var b5=function(){dC=document.createElement("canvas");dC.setAttribute("width",cu.croppedWidth);dC.setAttribute("height",cu.croppedHeight);dO=dC.getContext("2d");var gy=dC.width;var gv=dC.height;var gx=dO.createImageData(gy,gv);var gz=gx.data;for(var gA=0;gA<gv;gA++){if(gA%4==0){for(var o=0;o<gy;o++){if(o%4!=0){var gw=gA*gy*4+o*4;gz[gw]=0;gz[gw+1]=0;gz[gw+2]=0;gz[gw+3]=255}}}else{if(gA%4==1||gA%4==2){for(var o=1;o<gy;o+=4){var gw=gA*gy*4+o*4;gz[gw]=0;gz[gw+1]=0;gz[gw+2]=0;gz[gw+3]=255}}}}dO.putImageData(gx,0,0)};var gh=function(o){if(es){return}if(a2!=b){return}a2=requestAnimationFrame(function(){an()})};var gm=function(){if(a2==b){return}cancelAnimationFrame(a2);a2=b};var an=function(){var o=false;a2=b;if(fU){if(F.runAfterTouch()){o=true}}if(!h){if(I!=cU){bx.src=e[cU];I=cU}}else{if(O){if(eT()){o=true}}b7.globalAlpha=1;b7.clearRect(0,0,gl,cv);fn();if(cC&&cS){if(gt()){o=true}}}if(br){if(gc){var gy=gb*aY.width;var gw=gb*aY.height;gc=false;var gx=-ao.drawOffsetX+(gy-aY.width*ao.scale)/2-bH.panPos.left+aI.x*bH.scale;var gv=-ao.drawOffsetY+(gw-aY.height*ao.scale)/2-bH.panPos.top+aI.y*bH.scale;dh.camera.setViewOffset(gy,gw,gx,gv,ao.totalWidth,ao.totalHeight)}if(cL){var gz;if(cq.oSpinPositions){gz=cq.oSpinPositions[cU]/dR}else{gz=d0/dR}eG(0,gz*E,0)}if(bo){dh.renderer.draw(dh.scene,dh.camera)}if(cL){cL=false;if(d7&&dq){if(!bo){dh.renderer.render(dh.scene,dh.camera)}bq()}}}if(fP){fP=false;if(fs){fs.update(cU,ak)}}if(fg){fG();b7.fillStyle=a7;b7.fillRect(fR.left+1,fR.top+1,fR.width()-1,fR.height()-1);b7.fillStyle=am;b7.fillRect(fR.left,fR.top,fR.width(),1);b7.fillRect(fR.left,fR.bottom,fR.width(),1);b7.fillRect(fR.left,fR.top,1,fR.height());b7.fillRect(fR.right,fR.top,1,fR.height())}if(ar){ds.draw(W)}if(cO){if(bJ){g(fu,"translate3d("+ao.left+"px,"+ao.top+"px,0px)"+ao.strTransformScale)}else{g(fu,"translate("+ao.left+"px,"+ao.top+"px)"+ao.strTransformScale)}}if(o){gh()}};var fG=function(){fR.copyRect(aD);fR.offsetRect(-aD.clientOffset.left,-aD.clientOffset.top);fR.normalizeRect();if(ao.scale!=1){fR.scaleRect(ao.scale)}};var dd=function(){cL=fP=true};var dS=function(o){return false};var J=function(o){b7.drawImage(o.img.FSI_image_context,o.x,o.y,o.width,o.height);return false};var fW=function(gv){var o;gv.alpha+=ev;if(gv.alpha>=1){gv.fnDraw=J;gv.alpha=1;o=false}else{o=true}b7.globalAlpha=gv.alpha;J(gv);b7.globalAlpha=1;return o};var gt=function(){var o=false;if(y){f4()}if(cS.nVisibleTiles>0){var gz=ao.drawOffsetX+U.imageX+bH.panPos.left;var gy=ao.drawOffsetY+U.imageY+bH.panPos.top;var gx=U.imageWidth/cS.width;b7.save();b7.translate(gz,gy);b7.scale(gx,gx);var gv=cS.arVisibleTiles;for(var gw=0;gw<cS.nVisibleTiles;gw++){if(gv[gw].fnDraw(gv[gw])){o=true}}b7.restore()}cS.bTilesFading=o;if(P&&!o&&cS.bFilesArePreparedForLoading){if(b6.nTilesLoading==0&&cS.arTilesToLoad.length==0){P=false}}return o};var eS=function(){var o=false;if(y){f4()}if(cS.nVisibleTiles>0){var gz=ao.drawOffsetX+U.imageX+bH.panPos.left;var gy=ao.drawOffsetY+U.imageY+bH.panPos.top;var gx=U.imageWidth/cS.width;var gv=cS.arVisibleTiles;for(var gw=0;gw<cS.nVisibleTiles;gw++){if(gv[gw].fnDraw(gv[gw],gz,gy,gx)){o=true}}}cS.bTilesFading=o;if(P&&!o&&cS.bFilesArePreparedForLoading){if(b6.nTilesLoading==0&&cS.arTilesToLoad.length==0){P=false}}return o};var dP=function(o,gv){eD=(o=="video");if(eD){ec=b;c3=c1;by=f0.getPreviewImage=ax;fn=b1}else{by=f0.getPreviewImage=cf;fn=fH}if(!gv){f5=eD;if(fI){if(ga.length>1){if(!fI.showPreviewWhileLoading){bN=fn;fn=a.fnDoNothing}else{if(!fI.spinPreviewWhileLoading){bN=fn;if(!av.bSetup){av.bStillPreview=true;fn=a.fnDoNothing}else{if(av.imgDraw){fn=fw}else{fn=a.fnDoNothing}}}else{bN=b}}}av.bSetup=true}}};var f7=function(){if(!av.bStillPreview||av.bStillPreviewDone){return}fL()};var fL=function(){av.bStillPreviewDone=true;var gx=b0;b0=true;var gy;var gz=dU(fI.initialview);var o;if(aO.bDefault){gy=gz.scene}else{var gw=aO.arSets[gz.SceneSet];gy=gw.arScenes[gz.scene]-1}bs();var gv=fY(gy).fullURL;av.img=new Image();a.addEvent(av.img,"load",A);fi(av.img,gv);b0=gx;bg=b};var A=function(){b4(this);av.imgDraw=this.FSI_image_context;fn=fw};var fw=function(){aq(av.imgDraw,U.imageX,U.imageY,gb)};var ax=function(o){if(ec==o){return c3}ec=o;go.putImageData(e[o],0,0);c3=c1;return c3};var cf=function(o){if(ec==o){return c3}ec=o;if(!cA){cA=t.imageWidth;if(gi){at=document.createElement("canvas");at.setAttribute("width",t.imageWidth);at.setAttribute("height",t.imageHeight);gd=at.getContext("2d")}}if(!gi){c3=e[o].FSI_image_context}else{gd.drawImage(e[o].FSI_image_context,0,0,t.imageWidth,t.imageHeight);c3=at}return c3};var b1=function(){b7.globalAlpha=1;var o=gb*t.videoWidth/cu.croppedWidth;aq(ax(cU),U.videoX,U.videoY,o);if(P&&fI.pellets&&!C){b7.globalAlpha=fI.pelletsOpacity;b7.globalCompositeOperation="xor";aq(dC,U.videoX,U.videoY,o);b7.globalAlpha=1;b7.globalCompositeOperation="source-over"}};var fH=function(){aq(cf(cU),U.imageX,U.imageY,gb)};var aq=function(gx,gE,gB,gv){var gD,gC;var gy=ao.drawOffsetX+gE+bH.panPos.left;var gw=ao.drawOffsetY+gB+bH.panPos.top;if(gy<0){gD=-gy/gv;gy=0}else{gD=0}if(gw<0){gC=-gw/gv;gw=0}else{gC=0}var gF=gx.width-gD;var gA=gx.height-gC;var gz=gF*gv;var o=gA*gv;b7.drawImage(gx,gD,gC,gF,gA,gy,gw,gz,o)};var cy=function(){if(fs!=b){dJ()}if(bH.enabled&&h){fs=new a.NavigatorWindow(f0,fx,aM)}};var dJ=function(){if(fs==b){return}fs.destroy();fs=b};var bP=function(){if(!dy||!dh.targetObj){return}var gx=aY.width*ao.scale;var gB=aY.height*ao.scale;dh.sceneWidth=aZ.imageWidth*aI.cropScaleX;dh.sceneHeight=aZ.imageHeight*aI.cropScaleY;var gy=dh.sceneWidth;var o=gy/1.5;var gA=o/gB;var gz=fI.camera.digitalCropFactor*fI.camera.focalLength*gA;var gv=2*THREE.Math.radToDeg(Math.atan(24/gz/2));dh.camera=new THREE.PerspectiveCamera(gv,dh.sceneWidth/dh.sceneHeight,0.1,10000);var gw=fx.parsePositionParameter(fI.camera.position);if(gw!=b){aP.x=gw.x;aP.y=gw.y;aP.z=gw.z}else{if(fI.camera.heightTable!=b&&fI.camera.heightCamera!=b){fI.camera.heightAboveTable=fI.camera.heightCamera-fI.camera.heightTable}if(fI.camera.shiftX==b){fI.camera.shiftX=0}aP.x=fI.camera.shiftX;aP.y=fI.camera.heightAboveTable;aP.z=fI.camera.distanceToTableCenter}dh.camera.position.x=aP.x;dh.camera.position.y=aP.y;dh.camera.position.z=aP.z;el();dh.camera.lookAt(dh.targetObj.position);dh.camera.rotation.z=0;eC();dh.camera.setViewOffset(gx,gB,-ao.drawOffsetX+aI.x,-ao.drawOffsetY+aI.y,gx,gB)};var gq=function(){if(!dy){return}var gX;gX=window.THREE;if(a.BrowserSupports.canvas()&&typeof gX!=="undefined"){if(h){dh.renderer=new gX.CanvasRenderer({canvas:fu,clearColor:0,clearAlpha:0,devicePixelRatio:1});dh.renderer.autoClear=false;dh.renderer.setSize(aY.width*ao.scale,aY.height*ao.scale)}else{dh.renderer=new gX.CanvasRenderer({clearColor:0,clearAlpha:0});dh.renderer.autoClear=false;dh.renderer.setSize(aY.width,aY.height)}dh.scene=new gX.Scene();dh.projector=new gX.Projector();dh.objects=new gX.Object3D();var gF=new gX.Object3D();var gW=fx.parsePositionParameter(fI.camera.targetPosition);if(gW==b){gF.position.x=fI.camera.targetWidthOffset;gF.position.y=fI.camera.targetHeightOffset;gF.position.z=0}else{gF.position.x=gW.x;gF.position.y=gW.y;gF.position.z=gW.z}dh.scene.add(gF.position);dh.targetObj=gF;var gE;if(fI.virtualSpace.cubeLineWidth>0&&fI.drawCube){var gU,gw;if(fI.virtualSpace.cubeSizeX){gU=new gX.CubeGeometry(fI.virtualSpace.cubeSizeX,fI.virtualSpace.cubeSizeY,fI.virtualSpace.cubeSizeZ);gE=fI.virtualSpace.cubeSizeY/2}else{gU=new gX.CubeGeometry(fI.virtualSpace.cubeSize,fI.virtualSpace.cubeSize,fI.virtualSpace.cubeSize);gE=fI.virtualSpace.cubeSize/2}gw=new gX.MeshBasicMaterial({color:65280,wireframe:true,wireframeLinewidth:fI.virtualSpace.cubeLineWidth});var gA=new gX.Mesh(gU,gw);if(fI.virtualSpace.shiftY==b){fI.virtualSpace.shiftY=0}gA.position.x=fI.virtualSpace.shiftX;gA.position.y=gE+fI.virtualSpace.shiftY;gA.position.z=fI.virtualSpace.shiftZ;dh.cube=gA;dh.objects.add(gA)}if(fI.drawGroundPlate){var gL=new gX.PlaneGeometry(500,500,10,10);var gG=new gX.MeshLambertMaterial({color:15626314,wireframe:true});var gx=new gX.Mesh(gL,gG);gx.rotation.x=-Math.PI/2;gx.position.y=0;dh.objects.add(gx);dh.plane=gx}if(fI.drawTable){var o=fI.tableDiameter/2;var gQ=50;var gv=new gX.Geometry();var g0;g0=Math.PI*2/360;var gM=0;var gB=function(g4,g3){var g6=0;var g7=0;var hb=0;var g5=0;for(var g8=0;g8<=36;g8++,gM+=4){var g2=Math.sin(g0*g8)*g4;var ha=Math.cos(g0*g8)*g4;var g1=Math.sin(g0*g8)*g3;var g9=Math.cos(g0*g8)*g3;gv.vertices.push(new gX.Vector3(g1,g9,0));gv.vertices.push(new gX.Vector3(hb,g5,0));gv.vertices.push(new gX.Vector3(g6,g7,0));gv.vertices.push(new gX.Vector3(g2,ha,0));gv.faces.push(new gX.Face4(gM,gM+1,gM+2,gM+3));g6=g2;g7=ha;hb=g1;g5=g9}};var gC=0;var gz=0;for(var gV=0;gV<=4;gV++,gM+=3){var gK=Math.sin(g0*gV*90)*gQ;var gJ=Math.cos(g0*gV*90)*gQ;gv.vertices.push(new gX.Vector3(0,0,0));gv.vertices.push(new gX.Vector3(gK,gJ,0));gv.vertices.push(new gX.Vector3(gC,gz,0));gv.faces.push(new gX.Face3(gM,gM+1,gM+2));gC=gK;gz=gJ}g0=Math.PI*2/36;var gP=0;var gO=gQ;while(gO<o){gP+=gQ;gO=gP+gQ;if(gO>o){gO=o}gB(gP,gO)}var gT=new gX.Mesh(gv,new gX.MeshLambertMaterial({color:5810431,wireframe:true}));gT.rotation.x=-Math.PI/2;dh.disk=gT;dh.objects.add(gT)}var gZ=new gX.Vector3(0,1,0);var gN=new gX.Color(16755200);var gI=new gX.Face3(0,1,2,gZ,gN,0);dh.objects.add(gI);if(fI.hotspots&&fI.hotspots.points){aL();fC=fI.hotspotCallbackFunction;if(typeof(fC)=="string"){try{fC=window[fC]}catch(gS){}}else{if(typeof(fC)!="function"){fC=b}}for(var gR=0;gR<fI.hotspots.points.length;gR++){var gD=fI.hotspots.points[gR];gD.FSIHotspotID=gR;if(gD.perimeterAngle!=b&&gD.perimeterAngleY==b){gD.perimeterAngleY=gD.perimeterAngle;gD.perimeterAngleYRange=gD.perimeterAngleRange;gD.perimeterAngleYFadeOut=gD.perimeterAngleFadeOut}if(gD.perimeterAngleY&&gD.perimeterAngleY<0){gD.perimeterAngleY=360+gD.perimeterAngleY}gD.perimeterAngleYFadeOut=Math.min(gD.perimeterAngleYRange,gD.perimeterAngleYFadeOut);if(gD.perimeterAngleX&&gD.perimeterAngleX<0){gD.perimeterAngleX=360+gD.perimeterAngleX}gD.perimeterAngleXFadeOut=Math.min(gD.perimeterAngleXRange,gD.perimeterAngleXFadeOut);var gH=new gX.Object3D();gH.position.x=gD.x+fI.virtualSpace.shiftX;gH.position.y=gD.y+fI.virtualSpace.shiftY;gH.position.z=gD.z+fI.virtualSpace.shiftZ;gD.object=gH;dh.objects.add(gH);if(fI.hotspots.visible){var gY=new gX.Mesh(new gX.SphereGeometry(5,8,4),new gX.MeshLambertMaterial({color:255,wireframe:false}));gY.position.x=gD.x;gY.position.y=gD.y;gY.position.z=gD.z;dh.objects.add(gY)}if(fI.hotspots.defaults){for(var gy in fI.hotspots.defaults){if(gD[gy]==b){gD[gy]=fI.hotspots.defaults[gy]}}}cW(gD)}c4.log(gR+" HotSpots created.")}dh.scene.add(dh.objects);bP()}};var eF=function(o){var gv=o.type;fc(gv,this)};var fc=function(gx,o){var gw=o.FSIHotspot;if(!gw||!gx){return}switch(gx){case"mouseover":a.addClass(o,gw.hoverClass);break;case"mousedown":a.addClass(o,gw.activeClass);break;case"mouseout":a.removeClass(o,gw.hoverClass);break;default:a.removeClass(o,gw.activeClass)}if(gx=="click"&&gw.url!=b){window.open(gw.url,gw.urlTarget)}if(!fC){return}var gy=gw.FSIHotspotID;var gv=gw.tooltip;var gz=gw.actionParameter;fC(gx,aX,K,gy,gv,gz,gw.perimeterAngleY,gw.perimeterAngleX)};var dE=function(){if(!dy){return}dh.objects.remove(dh.cube);dh.objects.remove(dh.plane);dh.objects.remove(dh.disk)};var eG=function(gw,gv,o){dh.objects.rotation.x=gw;dh.objects.rotation.y=gv+fI.virtualSpace.baseRotationYRad;dh.objects.rotation.z=o};var bq=function(){if(dg){dg=false;var gx=1/ee;gf.testWidth=gb*t.imageWidth;T.style.webkitTransform="scale("+gx+")";T.style.transform="scale("+gx+","+gx+")"}var gP=ee*ao.left;var gO=ee*ao.top;var gQ=ee*aY.width/2;var gz=ee*aY.height/2;var gE,gG;var gM=false;var gF,gT;var gS=aY.width*ee;var gR=aY.height*ee;if(gf.spinFrame!=cU){gf.spinFrame=cU;if(gf.arSpotsAtFrame==b){gf.arSpotsAtFrame=new Array(dR)}var gK=gf.hotSpotsAtThisFrame;gf.hotSpotsAtThisFrame=gf.arSpotsAtFrame[cU];if(gf.hotSpotsAtThisFrame==b){var gC=fI.virtualSpace.rotationYRange*gn(d0)/dR;gf.hotSpotsAtThisFrame=gf.arSpotsAtFrame[cU]=new Array();for(var gN=0;gN<fI.hotspots.points.length;gN++){gF=fI.hotspots.points[gN];gG=1;if(gF.perimeterAngleY!=b){var gU=Math.abs(gF.perimeterAngleY-gC);if(gU>180){gU=Math.abs(360-gU)}if(gU<gF.perimeterAngleYRange){if(gU>gF.perimeterAngleYRange-gF.perimeterAngleYFadeOut){gG=(gF.perimeterAngleYRange-gU)/gF.perimeterAngleYFadeOut}}else{gG=0}}if(gG!=0){var gJ={};gJ.index=gN;gJ.hotspot=gF;gJ.op=gG;gf.hotSpotsAtThisFrame.push(gJ);gE=gF.object.matrixWorld.getPosition();gJ.zIndex=Math.round(gE.z)}}}if(gK&&gK.length>0){var gI={};for(var gL=0;gL<gf.hotSpotsAtThisFrame.length;gL++){var gw=gf.hotSpotsAtThisFrame[gL];gF=gw.hotspot;gF.marker.style.zIndex=gF.tooltip.style.zIndex=gw.zIndex;gI[gw.index]=gF.bVisible}for(var gL=0;gL<gK.length;gL++){if(!gI[gK[gL].index]){bn(gK[gL].hotspot,false)}}}}if(gf.scale!=ee){gf.scale=ee;gM=true}var gD=cq.xAngleToTargetDeg;for(var gN=0;gN<gf.hotSpotsAtThisFrame.length;gN++){var gy=gf.hotSpotsAtThisFrame[gN];gF=gy.hotspot;gG=1;if(cq.visibleHotSpots){gG=cq.visibleHotSpots[gF.FSIHotspotID]}gG=gG*gy.op;if(!gM&&gF._opScale!=b){if(gF._opScale==0){gG=0}}else{gF._opScale=1;if(fI.enableZoom&&gF.perimeterZoom!=b){if(gb<gF.perimeterZoom){gG=gF._opScale=0}}if(gG!=0&&gF.perimeterImageWidth!=b){if(gf.testWidth<gF.perimeterImageWidth){gG=gF._opScale=0}}}if(gG!=0){gE=gF.object.matrixWorld.getPosition();var gv=dh.projector.projectVector(gE,dh.camera);var gB=Math.round(gP+gv.x*gQ+gQ);var gA=Math.round(gO+gz-gv.y*gz);if(bH.enabled){if(gB<0||gA<0||gB>gS||gA>gR){gG=0}}}if(gG!=0){bn(gF,true);if(gF._opacity!=gG){gF._opacity=gG;gF.marker.style.opacity=gF.tooltip.style.opacity=gG}var gH=gF.oSvg;gF.tooltip.style.left=gB+gH.endX+(gF.tooltip.offsetWidth*gH.xAlign)+"px";gF.tooltip.style.top=gA+gH.endY+(gF.tooltip.offsetHeight*gH.yAlign)+"px";gF.marker.style.left=gB+gH.startX+"px";gF.marker.style.top=gA+gH.startY+"px"}else{bn(gF,false)}}};var aG=function(gx,gC,gv,gB,o,gA,gy,gw,gz){if(gw==b){gw=bf}if(gz==b){gz=1}var gD=document.createElementNS(c7,"polyline");gD.setAttribute("points",gx+","+gC+" "+gv+","+gB+" "+o+" , "+gA+" "+gv+","+gB+" "+gx+","+gC);gD.setAttribute("stroke",gy);gD.setAttribute("stroke-width",gw);gD.setAttribute("stroke-opacity",gz);gD.setAttribute("stroke-linecap","square");return gD};var aL=function(){var gy=aB=document.createElementNS(c7,"svg");try{if(!gy.style){aB=b;c4.log("ERROR: SVG Gradient not supported");return false}}catch(gA){aB=b;c4.log("ERROR: SVG Gradient not supported");return false}var gF=a.getSVGID();var gz=fI.hotspotDotRadius;var gw=0,gH=0;var gv=1,gE=1;var o=2,gC=2;gy.setAttribute("xmlns",c7);gy.setAttribute("version",fb);gy.setAttribute("baseProfile","tiny");var gx=gy.cloneNode(true);try{var gI=document.createElementNS(c7,"radialGradient");gI.setAttribute("id",gF);gI.setAttribute("cx","0.5");gI.setAttribute("cy","0.5");gI.setAttribute("r","0.5");var gG=document.createElementNS(c7,"stop");gG.setAttribute("stop-color",fI.hotspotDotColor1);gG.setAttribute("offset","0.5");var gD=document.createElementNS(c7,"stop");gD.setAttribute("stop-color",fI.hotspotDotColor2);gD.setAttribute("offset","1");gI.appendChild(gG);gI.appendChild(gD);gx.appendChild(gI);gx.style.position="absolute";T.appendChild(gx)}catch(gA){c4.log("ERROR: SVG Gradient not supported")}var gB=document.createElementNS(c7,"circle");gB.setAttribute("r",gz);gB.setAttribute("stroke",fI.hotspotLineColor2);gB.setAttribute("stroke-width","1px");gB.setAttribute("stroke-opacity","0.85");gB.setAttribute("fill","url(#"+gF+")");gB.setAttribute("fill-opacity","0.5");gy.appendChild(gB);return true};var aT=function(gA){var gF=gA.horizontalMarkerSize;var gK=Math.abs(gA.verticalMarkerSize);var gO;if(!aB){return{width:0,height:0,startX:0,startY:0,endX:0,endY:0,xAlign:0,yAlign:0}}var gC=gA.markerAngle*Math.PI/180;var gL,gy,gJ,gx,gH,gw;var gQ={};var gz=gQ.radius=fI.hotspotDotRadius+1;gO=Math.max(0,Math.min(1,gA.horizontalMarkerPosition));if(gO>0.5){gF=-gF}gQ.xAlign=-gO;gO=Math.max(0,Math.min(1,gA.verticalMarkerPosition));gQ.yAlign=-gO;gL=0;gy=0;gJ=gL+Math.sin(gC)*gK;gx=gy-Math.cos(gC)*gK;gH=gJ+gF;var gM=Math.min(gL-gz,gJ);var o=Math.min(gy-gz,gx);gM=Math.min(gM,gH);var gE=Math.sin(gC);var gG=Math.cos(gC);gL-=gM;gJ-=gM;gH-=gM;gy-=o;gx-=o;gw=gx;gQ.startX=-gL;gQ.startY=-gy;gQ.endX=gQ.startX+gH;gQ.endY=gQ.startY+gw;var gP=Math.max(gL+gz,gJ);gP=Math.max(gP,gH);var gv=Math.max(gy+gz,gx);var gD=gQ.svg=aB.cloneNode(true);var gB=gQ.width=gP;var gI=gQ.height=gv;gD.setAttribute("width",gB);gD.setAttribute("height",gI);gD.setAttribute("viewBox","0 0 "+gB+" "+gI);gD.setAttribute("class","fsi-ui-hotspot-line");var gN=gD.firstChild;gN.setAttribute("cx",gL);gN.setAttribute("cy",gy);gL+=Math.sin(gC)*gz;gy-=Math.cos(gC)*gz;gD.appendChild(aG(gL,gy,gJ,gx,gH,gw,fI.hotspotLineColor1,"5px","0.25"));gD.appendChild(aG(gL,gy,gJ,gx,gH,gw,fI.hotspotLineColor2,"1px"));return gQ};var bn=function(gv,o){if(gv.bVisible==o){return}gv.bVisible=o;if(o){gv._opacity=b;gv.marker.style.display=gv.tooltip.style.display="block"}else{gv.marker.style.display=gv.tooltip.style.display="none";gv._opacity=0;gv.marker.style.opacity=gv.tooltip.style.opacity=0}};var cW=function(gz){var gv=document.createElement("div");var gw="fsi-ui-hotspot";if(bI){gw+=" "+bI}if(gz.cssClass!=b&&gz.cssClass.length>0){gw+=" "+gz.cssClass}if(gz.normalClass.length>0){gz.normalClass=gw+" "+gz.normalClass}else{gz.normalClass=gw}if(gz.hoverClass.length>0){gz.hoverClass="fsi-ui-hotspot-hover "+gz.hoverClass}else{gz.hoverClass="fsi-ui-hotspot-hover"}if(gz.activeClass.length>0){gz.activeClass="fsi-ui-hotspot-active "+gz.activeClass}else{gz.activeClass="fsi-ui-hotspot-active"}gv.className=gz.normalClass;var gx="position:absolute;left:0px;top:0px;-webkit-user-drag: none; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;"+gz.cssStyle;a.setStyleAttr(gv,gx);gv.innerHTML=gz.text;if(fI.decodeHTMLEntitiesInHotSpotTexts){gv.innerHTML=gv.innerText}var gy=aT(gz);var o;if(gy&&gy.svg){o=gy.svg;o.style.position="absolute";T.appendChild(o)}else{o={style:{}}}if(gz.interactive){gv.FSIHotspot=gz;T.appendChild(gv);a.addEvent(gv,"mouseover",eF);a.addEvent(gv,"mouseout",eF)}else{gv.style.zIndex="1";T.appendChild(gv)}gz.bVisible=false;gz.tooltip=gv;gz.marker=o;gz.oSvg=gy;gv.style.display="none";o.style.display="none"};var cz=function(o){au();var gv=true;var gw=(dR&&!cG);eO=o.shiftKey;switch(o.keyCode){case 37:if(gw){bv();da=1;f8(dF+dc)}gv=false;break;case 39:if(gw){bv();da=-1;f8(dF-dc)}gv=false;break;case 32:gv=false;break}if(!gv&&o.preventDefault){o.preventDefault()}return gv};var dV=function(gv){var gw=Math.round(100*gv);var o=""+gw/100;if(gw%100==0){o+=".0"}if(gw%10==0){o+="0"}return o};var bV=function(o){eO=o.shiftKey;if(c4&&c4.on){if(!eO){bB(bC)}}var gv=true;var gw=(dR&&!cG);switch(o.keyCode){case 37:if(gw){d9(d0,true)}gv=false;break;case 39:if(gw){d9(d0,true)}gv=false;break;case 32:aX.resetView();gv=false;break}if(!gv){o.cancelBubble=true;if(o.stopPropagation){o.stopPropagation()}if(o.preventDefault){o.preventDefault()}}return gv};this.resetView=function(){dY();if(fI.initialview&&fI.initialViewPersistent){f6(fI.initialview,true)}else{f6("1,1,0,0,1,1",true)}};this.spinToDegree=function(o){if(!b0){return}var gv=gn(Math.round(o/360*dR));aX.spinToTarget(gv)};this.spinToTarget=function(gx,gA,gy){if(!b0){return}gx=cP(gx);var gD=gn(d0);var gz=gx-gD;var o=(gA!=b&&!isNaN(gA)&&gA!=aO.nCurrent);if(gz==0&&!o){dI(gx,gx,0,0);return true}var gC;if(gz!=0){da=(gz>0)?1:-1;gC=gD;if(!fI.noSceneLoop){if(Math.abs(gz)>dR/2){if(da>0){gx-=dR}else{gC-=dR}da=-da;gz=Math.abs(gx-gC)}}}else{gC=gx}var gv=aO.nCurrent;if(o&&!fI.noSetLoop&&aO.nSceneSets>1){var gB=gA-aO.nCurrent;if(Math.abs(gB)>aO.nSceneSets/2){if(gB>0){gA-=aO.nSceneSets}else{gv-=aO.nSceneSets}}}bv();if(gy==b||isNaN(gy)){gy=4;if(gz!=0){gy=Math.ceil(0.2*360/dR*Math.abs(gz))}if(o){var gB=Math.abs(gA-gv);var gw=Math.ceil(0.1*360/aO.nSceneSets*gB);gy=Math.max(gy,gw)}}dI(gC,gx,0,gy,gv,gA);return true};var V=function(o){if(aO.nSceneSets<2){return 0}if(fI.noSetLoop){o=Math.max(0,Math.min(aO.nSceneSets-1,o))}else{o=o%aO.nSceneSets;if(o<0){o=aO.nSceneSets+o}}return o};var du=function(){cq={};aO.bSetCameraPosition=false;aO.initialScene=aO.initialSceneSet=aO.nCurrent=0;aO.arCurrentSetIndex=false;bj=ab=ga.length;cn=(e.length>0)?e.length:bj;aJ(cn);aK=false};var a5=function(){if(aO.bHasMultipleSets){aJ(aO.quantizeMax);ab=aO.quantizeMax;aO.nCurrent=b;e8(0)}else{du()}};var e8=function(gw){gw=V(gw);if(gw==aO.nCurrent){return}aO.nCurrent=gw;cq=aO.arSets[gw];var gv=aO.arCurrentSetIndex=aO.arSets[gw].arScenes;aK=gv;bj=aO.quantizeMaxImages;cn=bj;if(aO.nVideoSet!=b){if(aO.nVideoSet==gw){ab=bj=gv.length;cn=c9;if(fs){fs.setPreviewImageSize(cu.croppedWidth,cu.croppedHeight)}if(!eD){dP("video",true)}aK=b}else{if(fs){fs.setPreviewImageSize()}ab=aO.quantizeMax;if(eD){dP("image",true)}}}eC();dd();var o=d0;ec=d0=b;if(cS){cS.spinPos=b}bO(o);gh();return gw};var eC=function(){if(!aO.bSetCameraPosition||!cq.posCamera){return}var o=cq.posCamera;dh.camera.position.set(o.x,o.y,o.z);dh.camera.lookAt(dh.targetObj.position);dh.camera.rotation.z=0};var aQ=function(o){o=Math.max(0,Math.min(dR-1,o));return o};var ep=function(o){o%=dR;if(o<0){o=dR+o}return o};var cP=function(gv,gy){if(!f5){return gv}var gx;var o=dR/bj;var gw=Math.round(gv/o)*o;if(!gy||gv==gw){gx=gw}else{if(da==1){gx=Math.round(gw+o)}else{gx=Math.round(gw-o)}}gx=gn(gx);return gx};var d9=function(o,gx){var gv=(o!=b)?o:d0;var gw=cP(gv,gx);aX.spinToTarget(gw)};var dI=function(o,gy,gz,gx,gw,gv){o=Math.round(o);gy=Math.round(gy);bv();if(gv!=b&&!isNaN(gv)&&gv!=aO.nCurrent){if(gw==b){gw=aO.nCurrent}}else{gw=b}if(a6(o,gy,gz,gx,gw,gv)){bD("spinToFrame")}};var bv=function(){if(eW==b){return}cancelAnimationFrame(eW);eW=b;fy("cancelSpinToFrame")};var a6=function(gy,gE,gD,gz,gv,gB){var gC=gE-gy;var gA;if(gC==0){gA=gE}else{gA=aA(gD,gz,gy,gC)}var gx;if(gv!=b){var gw=gB-gv;gx=Math.round(aA(gD,gz,gv,gw))}if(gD!=gz){if(ej){ej.lockImageSourceDimension(bx,true);ej.lockImage(bx,true)}var o=Math.round(gA);if(o<0){o=dR+o}else{if(o==dR){o=0}}eW=requestAnimationFrame(function(){if(gv!=b){e8(gx)}if(o!=d0){dd();bO(o);gh()}a6(gy,gE,++gD,gz,gv,gB)});return true}else{eW=b;if(ej){ej.lockImage(bx,false)}bO(gn(gE));if(gB!=b){e8(gB)}bL();bQ();fy("doSpinToFrame")}};var bL=function(){bO(gn(d0));gh();if(h){eE()}};var fY=function(gv){var o={};o.baseURL=fx.getImageURL(ga[gv],eA);o.fullURL=o.baseURL+f1;return o};var eJ=function(){if(!cS){return}bT=b;cS=b;a0=b;P=true;M()};var bs=function(){if(bg==bp){return}bg=bp;var o=eL.getPixelRangeRect(bp);f1=eL.getPixelRangeParametersByCalculatedResult(o)};var aw=function(o){if(o==b){o=Math.round(d0/(dR/ab))}if(isNaN(o)||o<0||o>=ab){c4.error("invalid image index in loadHDImage "+o);return}if(aO.arCurrentSetIndex){o=aO.arCurrentSetIndex[o]}o-=c9;return o};var eE=function(gI){if(h&&!eD&&gb<=1){eJ();return}if(es||bT==bp){return}bT=bp;gI=aw(gI);bs();var gv=fY(gI);if(a0==gv.fullURL){return}if(cS&&gv.fullURL==cS.src){return}b6={};b6.img=new Image();b6.nImage=gI;b6.renderScale=gb;var gw=dR/bj;b6.spinPos=cP(gI*gw);b6.img.crossOrigin="anonymous";b6.img.FSI_ImageObject=b6;a0=b6.src=gv.fullURL;if(h){P=true;b6.bTilesFading=false;b6.bFillsViewport=false;var gD=ek.width;var gC=ek.height;var gB=bp;var gz=Math.round(gB/gD*gC);b6.width=gB;b6.height=gz;var o="&referenceWidth="+gB+"&referenceHeight="+gz;var gJ=eV;b6.tiles=[];var gG=0;var gE=0;var gH=gJ;var gF=gJ;gH=Math.min(gH,gB);gF=Math.min(gF,gz);var gy;var gx=false;while(gE<gz){gy={};gy.fnDraw=dS;gy.FSI_ImageObject=b6;gy.x=gG;gy.y=gE;if(gG+gH>=gB){gy.width=gB-gG;gH=Math.min(gJ,gB-gG);gx=true}gy.width=gH;gy.height=gF;var gA=eL.getPixelRangeParameters(gB,gz,gG,gE,gH,gF);gy.url=gv.baseURL+gA;if(gx){gx=false;gE+=gJ;gG=0;gH=gJ;if(gE+gJ>gz){gF=Math.min(gJ,gz-gE)}}else{gG+=gJ}b6.tiles.push(gy)}b6.nTiles=b6.tiles.length;b6.arVisibleTiles=new Array(b6.nTiles);b6.nVisibleTiles=0;b6.nTilesLoading=0;b6.nTilesLoaded=0;b6.nTilesRequested=0;b6.nTileColumns=Math.ceil(gB/gJ);b6.nTileRows=Math.ceil(gz/gJ);y=true;N(null,b6)}};var dH=function(o){o.bLoading=true;o.img=new Image();o.img.oTile=o;a.addEvent(o.img,"load",aU);fi(o.img,o.url)};var aU=function(){a.removeEvent(this,"load",aU);var gv=this.oTile;gv.bLoaded=true;var o=gv.FSI_ImageObject;if(o.nTilesLoaded==o.nTiles){o.bComplete=true;o.bFillsViewport=true}if(o.src!=a0){return}gv.alpha=0;gv.fnDraw=fW;o.nTilesLoading--;o.nTilesLoaded++;N(null,o);b4(this);gh();cx(25)};var bK=function(gv,o){return o.distance-gv.distance};var f4=function(){y=false;if(!cS){return}var gB=cS;var gL,gK,gw,o;var gA;if(bH.enabled){eR.setRect(0,0,aY.width,aY.height);eR.scaleRect(1/bH.scale);eR.offsetRect(-bH.panPos.left/gb,-bH.panPos.top/gb);eR.offsetRect((aY.width-eR.width())/2,(aY.height-eR.height())/2);df.copyRect(aR);df.scaleRect(1/bH.scale);df.offsetRect(eR.left,eR.top);gA=df}else{gA=aR}bW(gA);gL=e6.left;gK=e6.top;gw=e6.right;o=e6.bottom;var gI=Math.max(0,Math.floor(gL/eV));var gx=Math.min(gB.nTileColumns-1,Math.floor(gw/eV));var gH=Math.max(0,Math.floor(gK/eV));var gv=Math.min(gB.nTileRows-1,Math.floor(o/eV));var gy=gx-gI+1;var gD=gv-gH+1;var gE=Math.max(0,gD)*gy;if(gB.nFirstTileXLastGetVisible==gI&&gB.nFirstTileYLastGetVisible==gH&&gB.nTilesLastGetVisible==gE){return}gB.nFirstTileXLastGetVisible=gI;gB.nFirstTileYLastGetVisible=gH;gB.nTilesLastGetVisible=gE;var gN=gB.tiles;var gM=gB.arVisibleTiles;var gF=gH*gB.nTileColumns;var gz=gI;var gG;var gC=P;P=false;for(var gJ=0;gJ<gE;gJ++){gG=gM[gJ]=gN[gF+gz];if(!P&&gG.alpha!=1){P=true}if(++gz>gx){gz=gI;gF+=gB.nTileColumns}}gB.nVisibleTiles=gE;gB.bFilesArePreparedForLoading=false;if(P&&!gC){b7.globalAlpha=1;fn()}cx(50)};var M=function(){if(fK){clearTimeout(fK);fK=b}};var cx=function(o){if(fK!=b){return}if(!cS||cS.bRequestsComplete){return}fK=setTimeout(fT,o)};var fT=function(){M();B()};var B=function(){if(O){return}var gy=cS;if(gy.nTilesLoading>=eg){return}var gB,gw,gv;if(!gy.bFilesArePreparedForLoading){gy.bFilesArePreparedForLoading=true;if(!gy.arTilesToLoad||gy.arTilesToLoad.length!=0){gy.arTilesToLoad=[]}gB=gy.arTilesToLoad;var gz=gy.arVisibleTiles;for(var gx=0;gx<gy.nVisibleTiles;gx++){if(!gz[gx].bLoading){gB.push(gz[gx])}}if(gB.length>1){bH.centerX=e6.left+e6.width()/2;bH.centerY=e6.top+e6.height()/2;for(var gx=0;gx<gB.length;gx++){var gA=gB[gx];gw=gA.x-bH.centerX+gA.width/2;gv=gA.y-bH.centerY+gA.height/2;gA.distance=Math.abs(gw)+Math.abs(gv)}gB.sort(bK)}}var o=0;gB=gy.arTilesToLoad;while(gy.nTilesLoading<eg&&gB.length>0){var gA=gB.pop();dH(gA);o++;gy.nTilesLoading++}gy.nTilesRequested+=o;if(gy.nTilesRequested==gy.nTiles){gy.bRequestsComplete=true}};var N=function(o,gv){if(gv==b){a.removeEvent(this,"load",N);gv=this.FSI_ImageObject;gv.width=this.width;gv.height=this.height}if(gv.src!=a0){return}b4(this);cS=gv;if(gs){return}gh()};this.onMenuButtonPress=function(gv){dY();bu();var o,gw;if(gv.indexOf("_")!=-1){o=gv.split("_");gv=o[0];gw=o[1]}switch(gv){case"Reset":aX.resetView();break;case"ZoomOut":case"ZoomIn":Y(gv,150,10);break;case"MouseMode":ez(parseInt(gw));break;case"MaxZoom":e0(b,b,bH.scaleToSourceImage-gb,false,30);break}};var cc=function(gw,gv){var o=false;if(cs){o=cs.enableButton(gw,gv);if(o){if(typeof(aX.onEnableMenuButton)=="function"){aX.onEnableMenuButton(gw,gv)}}}else{if(typeof(aX.onEnableMenuButton)=="function"){aX.onEnableMenuButton(gw,gv)}}return o};this.onMenuButtonRelease=function(gv){bu();var o,gw;if(typeof(gv)=="string"&&gv.indexOf("_")!=-1){o=gv.split("_");gv=o[0];gw=o[1]}switch(gv){case"FullScreen":if(a.FullScreen.getEnabled()){c2();a.FullScreen.quit()}else{a.FullScreen.start(f2);c2()}break;case"Hotspots":cR=cs.getButtonPressed("Hotspots");fo(cR);break}};var ac=function(gv){if(!bH.enabled){return}var o=gb;fm(gv);bH.panPos.left*=gb/o;bH.panPos.top*=gb/o;bF(true)};var eU=function(gv){if(gv==b){gv=bm.cmd;bm.nRepeatCount++}switch(gv){case"ZoomOut":var o=(bm.nRepeatCount<1)?1.01:1.035;ac(bH.scale/o);break;case"ZoomIn":var o=(bm.nRepeatCount<1)?1.01:1.035;ac(bH.scale*o);break}if(bm.nRepeatCount==1){if(bm.intervalTimeFirst!=bm.intervalTimeRepeat){clearInterval(bm.interval);bm.interval=setInterval(eU,bm.intervalTimeRepeat)}}};var Y=function(gw,o,gv){aF(false);bu();bm={};bm.bRunning=true;if(o==b){o=500}bm.intervalTimeFirst=o;if(gv==b){bm.intervalTimeRepeat=o}else{bm.intervalTimeRepeat=gv}bm.nRepeatCount=0;bm.cmd=gw;eU(gw);bm.interval=setInterval(eU,bm.intervalTimeFirst)};var bu=function(){if(!bm.bRunning){return}aF(true);clearInterval(bm.interval);switch(bm.cmd){case"ZoomOut":case"ZoomIn":ei();break}bm={}};var eh=function(o){if(Q!=b){if(Q.width!=aZ.imageWidth){bk()}else{return}}if(f5){return}Q={};Q.previewImageCanvasWidthBeforeResize=o;Q.uniqueInstanceID=ah;Q.nTimeout=setTimeout(dz,50)};var dz=function(){if(!b0){Q.nTimeout=setTimeout(dz,250);return}if(!fI.loadExactPreviewImagesAfterResize){var gv=Q.previewImageCanvasWidthBeforeResize/aZ.imageWidth;if(Math.abs(1-gv)<0.05){bk();return}}Q.nTimeout=b;Q.img=new Image();a.addEvent(Q.img,"load",ag);Q.pos=0;Q.arIndex=new Array(e.length);Q.arIndex[0]=cU;for(var o=0,gw=1;o<e.length;o++){if(o!=cU){Q.arIndex[gw++]=o}}ag()};var ag=function(o){if(o!=b){if(!Q||Q.uniqueInstanceID!=ah){return}a.removeEvent(Q.img,"load",ag);b4(Q.img);e[Q.indexCurrent]=Q.img;if(Q.pos==1){at=b;cA=b;ec=b;by(Q.indexCurrent)}if(Q.indexCurrent==cU){ec=b;gh()}Q.img=new Image();a.addEvent(Q.img,"load",ag)}Q.indexCurrent=Q.arIndex[Q.pos];Q.pos++;if(Q.pos>e.length){bk()}else{var gv=bp;bp=ay;bs();Q.url=fY(Q.indexCurrent).fullURL;bp=gv;bs();Q.nTimeout=setTimeout(cM,50)}};var cM=function(){fi(Q.img,Q.url)};var bk=function(){if(Q==b){return}if(Q.nTimeout){clearTimeout(Q.nTimeout);Q.nTimeout=b}a.removeEvent(Q.img,"load",ag);Q=b};var cr=function(){c2()};var aN=function(){c4.error("ERROR entering FullScreen")};var c2=function(){var o=a.FullScreen.getEnabled();if(cs){cs.setButtonPressed("FullScreen",o)}if(o==dB){return}dB=o;if(o==true){a.FullScreen.addChangeEvents(window,cr,aN)}else{a.FullScreen.removeChangeEvents(window,cr,aN)}};this.getInFullScreenMode=function(){return dB};this.getSpinFrames=function(){return dR};this.getImageIsTransparent=function(){return dj};this.getSrcDim=function(){return ek};var ft=f0;ft.iViewer=aX;ft.getToolTipObject=function(){return e9};ft.getElementSpace=function(){return ae};ft.getDrawRatio=function(){return U};ft.getdrawRatioUnZoomed=function(){return aZ};ft.getdrawRatioUnResized=function(){return t};ft.getinPlaceZoom=function(){return bH};ft.getRootContainer=function(){return f2};if(typeof(dM)!="object"||a.makeBool(dM.autoInit,true)){aX.init(fB,dM)}};(function(){var d="fsi-viewer";var e="display:block;width:300px;height:300px;";var g=a.customTags[d];if(g){return}var c=function(i){var h=a.attributes2parameters(i);if(h.src!=b&&h.imagesrc==b){h.imagesrc=h.src}return h};var f={};f.registerElement=function(){a.addViewerClassCSSRule(d,e);var h=Object.create(HTMLDivElement.prototype);h.createdCallback=function(){a.customTagDimFromAttributes(this);a.Viewer.prototype.constructor.call(this,this,{autoInit:false})};h.attachedCallback=function(){if(this.getInitDone()){return}this.init(this,c(this));this.start()};h.detachedCallback=function(){this.destroyOnDetach()};document.registerElement(d,{prototype:h})};f.replaceTagInit=function(h){a.addViewerClassCSSRule(d,e)};f.replaceTag=function(h){if(!h||(typeof(h.getInitDone)=="function"&&h.getInitDone())){return}a.customTagDimFromAttributes(h);a.Viewer.prototype.constructor.call(h,h,c(h));h.start()};g=a.registerCustomTag(d,f)}())}(window.$FSI=window.$FSI||{}));